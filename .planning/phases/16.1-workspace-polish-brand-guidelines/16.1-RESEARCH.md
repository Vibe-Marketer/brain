# Phase 16.1: Workspace Polish & Brand Guidelines - Research

**Researched:** 2026-02-28
**Domain:** React/motion UI polish, CSS layout architecture, Claude Code skill format
**Confidence:** HIGH — all findings from direct source code inspection

---

<user_constraints>
## User Constraints (from CONTEXT.md)

### Locked Decisions

**Design audit scope:**
- Systematic pass through ALL Phase 16 surfaces: sidebar, org switcher bar, workspace panes, folder management, invite flows, onboarding explorer, breadcrumbs, DnD, calls list, call detail, settings
- High visual standard: anything that catches the eye negatively gets fixed — every pixel matters
- Audit against brand-guidelines-v4.2.md AND instinct — flag things that technically comply but still look off. Update guidelines where findings diverge from what looks right
- Reference app is Linear: clean, fast, dense-but-not-cluttered, spring animations, keyboard-first feel

**Polish approach:**
- The app "feels rough overall" from rapid 8-plan build — needs comprehensive tightening on spacing, alignment, transitions, and visual consistency
- All polish dimensions equally important: navigation feel, visual consistency, and animations/transitions
- Desktop must be perfect; mobile just needs to not be broken (no layout issues, but don't optimize for mobile)

**Quality bar:**
- Customer-ready: "I'd show it to a customer" — every surface looks intentional, nothing screams prototype
- Target reference: Linear — clean, fast, dense-but-not-cluttered, keyboard-first, spring animations

**Brand guidelines skill:**
- Primary consumer: Claude Code agents (optimize for machine consumption, keep human-readable)
- Content scope: let the audit reveal what's undocumented or inconsistent — the skill codifies whatever the audit surfaces
- No specific UI pattern categories pre-decided — audit drives content

**CRITICAL: AppShell Alignment Issue (identified 2026-02-28) — #1 PRIORITY:**
- v1 (CORRECT): Pane 4 slides in and Pane 3 SHRINKS to make room. All panes on the same z-index plane. No overlapping.
- v2 (BROKEN): Pane 4 uses AnimatePresence with initial/exit x:20 and opacity transitions — currently renders as a 4th sibling in the flex row which IS correct plane-wise, but the current DetailPaneOutlet has initial `x: 20` which makes it feel like a drawer, not a pane push.
- FIX: v2 must match v1 — detail panel pushes content, doesn't cover it. Same plane. Width animates from 0 to 360px on the same flex row.
- Architecture note: v2's engine is correct (spring physics via motion/react, Zustand store, TanStack Router). Only the visual/behavioral output needs to change.
- v1 reference: brain/src/components/layout/AppShell.tsx (327 lines, CSS transitions, same-plane panes)
- v2 current: callvault/src/components/layout/AppShell.tsx (225 lines, spring physics, drawer-feel for Pane 4)

**Header:**
- v1 has a specific header size and look
- v2 header (OrgSwitcherBar) is different/wrong — needs to match v1

**Background:**
- Page background, card backgrounds, pane chrome — all need to match v1's visual feel

### Claude's Discretion
- Fix flow: whether to audit-then-fix or audit+fix inline — pick based on issue scope
- Brand guidelines strictness: determine per category what's a hard rule vs preferred pattern
- Brand guidelines location: skill vs doc — pick format that best serves downstream agents
- Brand guidelines versioning: v4.3 increment vs v5.0 — based on how much actually changes
- Dark mode: determine if dark mode polish is worth including based on current implementation state
- Critical flows: identify highest-impact flows to verify based on what the audit surfaces
- Verification method: dev-browser automated vs hybrid — pick based on issue types found

### Deferred Ideas (OUT OF SCOPE)
None — discussion stayed within phase scope
</user_constraints>

---

## Summary

Phase 16.1 is a polish-and-codification phase — no new features, only quality elevation. The primary technical work is two-fold: (1) fix concrete known bugs, especially the AppShell Pane 4 behavior which currently feels drawer-like rather than push-based, and (2) conduct a full visual audit across all Phase 16 surfaces and fix what's found. The phase concludes by codifying findings into a brand guidelines skill that downstream GSD agents will use.

The v2 AppShell architecture is fundamentally sound — motion/react spring physics in a flex row is exactly right for same-plane pane behavior. The issue is that `DetailPaneOutlet` currently animates with `initial={{ width: 0, opacity: 0, x: 20 }}` which produces a slight right-offset feel on entry. The fix is to remove the `x` component from animation and let width alone drive the push. The `OrgSwitcherBar` in v2 sits above the pane container (`flex flex-col`) which is architecturally different from v1 where there was no such bar.

The brand guidelines (v4.2.md at 2914 lines) is comprehensive but was written for v1. Several v2-specific patterns are undocumented: OrgSwitcherBar behavior, the 4-pane motion/react spring system, the workspace/folder sidebar hierarchy, and the new navigation items. The skill should be a `.md` file in `.claude/skills/` or similar location, formatted like the existing marketplace skills (frontmatter + structured sections).

**Primary recommendation:** Fix AppShell Pane 4 push behavior first (it's the #1 priority), then conduct systematic surface-by-surface audit with dev-browser verification after each surface, then write the brand skill from what was discovered.

---

## Standard Stack

### Core (Already Installed — Do Not Re-Install)

| Library | Version | Purpose | Notes |
|---------|---------|---------|-------|
| `motion/react` | Current | Spring animations, AnimatePresence, layout transitions | Import from `motion/react`, NOT `framer-motion` |
| `zustand` | v5 | Panel store, preferences store — layout state | Double-invocation syntax: `create<T>()(...)`  |
| `@remixicon/react` | Current | All icons — mandatory library | Use `-Line` variants; `-Fill` for active states |
| `radix-ui` | Current | Collapsible, DropdownMenu, Dialog primitives | Already used throughout Phase 16 |
| `@tanstack/react-query` | Current | Data fetching, cache management | Already wired in hooks |
| `@tanstack/react-router` | Current | File-based routing, Link, useRouterState | Already wired |
| `sonner` | Current | Toast notifications | `import { toast } from 'sonner'` |

### Motion/React Spring Config (Confirmed in v2 Codebase)

```typescript
// Used in both AppShell and DetailPaneOutlet
const SPRING = { type: 'spring', stiffness: 260, damping: 28 } as const
```

This config produces a spring that approximates 300-400ms settle time with a slight bounce — consistent with Linear's feel. **Do not change the spring config.**

### Tailwind Design Tokens in Use

| Token | Value | Use |
|-------|-------|-----|
| `bg-card` | `#FFFFFF` light / `#202020` dark | All pane backgrounds |
| `bg-viewport` | `#FCFCFC` light / `#161616` dark | Body/gutter background |
| `border-border` | `#E5E5E5` / `#3A3A3A` | Pane borders |
| `border-border/60` | 60% opacity border | Pane border standard |
| `text-muted-foreground` | `#666666` / varies | Secondary text |
| `text-foreground` | `~#171717` / `#FFFFFF` | Primary text |
| `bg-muted` | `hsl(0 0% 95%)` | Hover states, inactive items |
| `bg-brand-400` | `hsl(32 100% 50%)` — vibe orange | Active indicators only |

---

## Architecture Patterns

### Pattern 1: AppShell Pane Composition (v2 — CORRECT Pattern)

**What:** All panes in a flex row. Pane widths animate with motion/react springs. Pane 4 uses AnimatePresence and animates width 0→360px in the same flex row — this pushes Pane 3 left rather than overlaying it.

**The v1 vs v2 Pane 4 difference (CRITICAL):**

```
v1 DetailPaneOutlet (CSS transition approach):
- No AnimatePresence
- Static aside element always in DOM
- CSS transition: `transition-[width,opacity,transform] duration-500`
- Closed: `w-0 opacity-0 translate-x-4 border-0`
- Open: `w-[360px] opacity-100 translate-x-0`
- BEHAVIOR: Pane 3 gets flex-1 space pushed by pane 4 width

v2 DetailPaneOutlet (motion/react approach):
- AnimatePresence with initial/animate/exit
- CURRENT: initial={{ width: 0, opacity: 0, x: 20 }}  ← the `x: 20` is the issue
- CURRENT: animate={{ width: 360, opacity: 1, x: 0 }}
- CURRENT: exit={{ width: 0, opacity: 0, x: 20 }}
- FIX: Remove x from all three — only animate width and opacity
```

**Correct v2 fix for DetailPaneOutlet:**

```tsx
// Source: callvault/src/components/layout/DetailPaneOutlet.tsx
// Remove x: 20 from initial and exit to eliminate drawer-slide feel

<motion.aside
  key="detail-pane"
  initial={{ width: 0, opacity: 0 }}           // NO x offset
  animate={{ width, opacity: 1 }}
  exit={{ width: 0, opacity: 0 }}               // NO x offset
  transition={SPRING}
  className={cn(
    'flex-shrink-0 bg-card rounded-2xl border border-border/60 shadow-sm',
    'flex flex-col h-full z-10 overflow-hidden',
    className,
  )}
>
```

This makes Pane 3 (`flex-1`) naturally shrink as Pane 4 width grows — same-plane push behavior.

### Pattern 2: OrgSwitcherBar — v2 Architecture

The v2 OrgSwitcherBar is a full-width bar ABOVE the pane container (`flex flex-col`):

```tsx
// callvault/src/components/layout/AppShell.tsx (lines 151-222)
<div className="h-full flex flex-col overflow-hidden">
  <OrgSwitcherBar />  {/* Full width above panes */}
  <div className="flex-1 flex gap-3 overflow-hidden p-1 min-h-0">
    {/* Panes 1-4 here */}
  </div>
</div>
```

v1 has no OrgSwitcherBar equivalent — org switching was in the sidebar. This is a deliberate v2 architectural decision. The visual issue is that the bar's styling (`h-10 w-full border-b border-border/40 bg-card/80`) may look disconnected from the panes below. Audit should check if gap between bar and panes looks right.

### Pattern 3: Pane Width Specifications (Locked)

| Pane | Expanded Width | Collapsed Width |
|------|---------------|-----------------|
| Pane 1 (NavRail) | 220px | 72px |
| Pane 2 (Secondary) | 280px | 0px |
| Pane 3 (Main) | `flex-1` fills remaining | — |
| Pane 4 (Detail) | 360px desktop / 320px tablet | 0px |

These are locked in CONTEXT.md and match both the CLAUDE.md and the src/CLAUDE.md. Do not change them.

### Pattern 4: Navigation Active State (Brand Requirement — Partially Unimplemented in v2)

Brand guidelines v4.2 specify 4-layer active state:
1. Background tint: `bg-vibe-orange/10` (or `bg-muted` as simplified version)
2. Icon fill variant: switch from `-Line` to `-Fill`
3. Text semibold weight
4. Pill indicator: `absolute left-0 w-1 h-[80%] rounded-r-full bg-vibe-orange`

**Current v2 SidebarNav active state (simplified — may need upgrading):**
```tsx
// callvault/src/components/layout/SidebarNav.tsx lines 118-120
isActive
  ? 'bg-muted font-medium text-foreground'
  : 'text-muted-foreground',
```

v2 uses `bg-muted` not `bg-vibe-orange/10`, no fill icon variants, no pill indicator. This is intentionally simplified but the audit may want to add the pill indicator and fill icons for Linear-level polish.

### Pattern 5: v2 State Management Architecture

```
usePreferencesStore (preferencesStore.ts)
  - isSidebarExpanded: boolean (persisted to localStorage)
  - isSecondaryOpen: boolean
  - showOnboarding: boolean
  - Cross-tab sync via 'storage' event

usePanelStore (panelStore.ts)
  - isPanelOpen: boolean
  - panelType: PanelType (discriminated union)
  - panelData: PanelData
  - openPanel(type, data) / closePanel()
```

Panel opens when `openPanel()` is called — nothing in v2 currently calls `openPanel()` for the main calls list page. The DetailPaneOutlet renders but shows `PanelPlaceholder` because real panel components haven't been built yet.

### Recommended Surface Audit Order (Priority)

1. **AppShell + Pane 4 fix** — highest priority, structural issue
2. **OrgSwitcherBar** — header alignment, visual feel
3. **SidebarNav** — active states, icon polish
4. **WorkspaceSidebarPane** — workspace/folder hierarchy
5. **Calls list (index.tsx)** — main data surface, most visible
6. **Call detail page** — secondary data surface
7. **Import page** — tab system, source cards
8. **Settings page** — sidebar nav, category content
9. **Workspaces page** — grid cards
10. **Breadcrumb** — spacing, visual weight
11. **Onboarding ModelExplorer** — animation quality
12. **DnD interactions** — drag feel

### Anti-Patterns to Avoid

- **window.prompt() for workspace/folder creation** — found in 2 places. This is a prototype pattern and must be replaced with proper dialogs. Already identified in WorkspaceSidebarPane.tsx:274 and workspaces/index.tsx:73.
- **Import tab active indicator** — currently uses `border-b-2 border-foreground` which is a black underline, not vibe orange. Should match brand standards.
- **brand-400 directly for buttons** — `bg-brand-400 text-white` used in workspaces/index.tsx (Create Workspace button). Should use `Button variant="default"` from ui/button.
- **Inline action menus** — CallActionMenu uses custom dropdown built from scratch. Should use Radix DropdownMenu for consistency and accessibility.

---

## Don't Hand-Roll

| Problem | Don't Build | Use Instead | Why |
|---------|-------------|-------------|-----|
| Dropdown menus | Custom div + useState | Radix `DropdownMenu` | Already used in OrgSwitcherBar; handles keyboard, positioning, a11y |
| Dialog/modal | Custom fixed overlay | Radix `Dialog` | Already used in import page; handles focus trap, Escape key |
| Collapsible sections | Custom height animation | Radix `Collapsible` | Already used in WorkspaceSidebarPane |
| Spring animations | CSS transitions | `motion/react` (`motion.div`, `AnimatePresence`) | Already set up; import from `motion/react` not `framer-motion` |
| Toast notifications | Custom toast component | `sonner` `toast()` | Already configured |
| Input fields with state | Raw `<input>` | Radix Form or shadcn `Input` | Focus ring, validation, accessibility |

**Key insight:** The Phase 16 build already established the correct patterns. Polish work reuses these — it does not re-invent them.

---

## Common Pitfalls

### Pitfall 1: Breaking the Flex Row Plane

**What goes wrong:** Pane 4 gets a higher z-index or `position: absolute` / `position: fixed` and overlays Pane 3 instead of pushing it.
**Why it happens:** Default impulse to make sliding panels is to position them absolutely.
**How to avoid:** Keep all panes as flex children at z-index 10 (`z-10`). Only Pane 4's width should animate — let flexbox handle the layout reflow.
**Warning signs:** Pane 3 doesn't shrink when Pane 4 opens; Pane 4 overlaps content.

### Pitfall 2: Importing from framer-motion Instead of motion/react

**What goes wrong:** `import { motion } from 'framer-motion'` — different package, may have version conflicts.
**Why it happens:** Muscle memory from framer-motion era.
**How to avoid:** Always `import { motion, AnimatePresence } from 'motion/react'`. This is enforced in CLAUDE.md.
**Warning signs:** TypeScript errors, animation not working as expected.

### Pitfall 3: Using window.prompt() for User Input

**What goes wrong:** `window.prompt('Workspace name:')` — blocks the browser, ugly, breaks dev-browser automation.
**Why it happens:** Fast prototype pattern from Phase 16 build.
**How to avoid:** Replace with Radix Dialog components (already used in import page as model).
**Warning signs:** Two known instances: WorkspaceSidebarPane.tsx:274, workspaces/index.tsx:73.

### Pitfall 4: Animation x-Offset on Panel Entry

**What goes wrong:** Pane 4 feels like a drawer sliding from the right instead of a pane pushing from within the flex row.
**Why it happens:** `initial={{ x: 20 }}` offset in DetailPaneOutlet — makes the enter feel like an overlay slide-in.
**How to avoid:** Remove `x` from all animation keyframes. Let `width: 0 → 360` be the only spatial transition.

### Pitfall 5: Brand-orange for Wrong Elements

**What goes wrong:** Using `bg-brand-400` or `text-brand-400` for button backgrounds or large filled areas.
**Why it happens:** Vibe orange looks "active" so it's tempting to use it everywhere.
**How to avoid:** Vibe orange is for active nav indicators (pill, icon color, background tint). Button backgrounds use `Button variant="default"` (slate gradient). See brand guidelines v4.2 "9 Approved Uses."

### Pitfall 6: Incorrect Transition Duration

**What goes wrong:** Using `duration-300` for sidebar — feels abrupt.
**Why it happens:** Default React/Tailwind patterns use 300ms.
**How to avoid:** Sidebar width transitions use `duration-500 ease-in-out` (v1 CSS approach) or the `SPRING` config in v2 motion. Do NOT change spring config.

### Pitfall 7: Skills File Location

**What goes wrong:** Writing the brand skill to the wrong directory.
**How to avoid:** Check where `.claude/skills/` should live relative to project. The marketplace format uses `.claude/plugins/.../skills/SKILL.md`. For a project-level skill, the pattern is likely `callvault/.claude/skills/callvault-design-system/SKILL.md` or in the brain repo at `brain/.claude/skills/`.

---

## Code Examples

### Correct DetailPaneOutlet (Same-Plane Push Fix)

```tsx
// Source: callvault/src/components/layout/DetailPaneOutlet.tsx
// Fix: Remove x offset from initial/exit to eliminate drawer feel

const SPRING = { type: 'spring', stiffness: 260, damping: 28 } as const

<AnimatePresence initial={false}>
  {isPanelOpen && (
    <motion.aside
      key="detail-pane"
      role="complementary"
      initial={{ width: 0, opacity: 0 }}      // x removed
      animate={{ width, opacity: 1 }}
      exit={{ width: 0, opacity: 0 }}           // x removed
      transition={SPRING}
      className={cn(
        'flex-shrink-0 bg-card rounded-2xl border border-border/60 shadow-sm',
        'flex flex-col h-full z-10 overflow-hidden',
      )}
    >
      {/* panel content */}
    </motion.aside>
  )}
</AnimatePresence>
```

### Correct Nav Active State (Linear-Level Polish)

```tsx
// Source: callvault/src/components/layout/SidebarNav.tsx
// Enhancement: Add pill indicator + fill icon variant for active state

<Link
  key={item.id}
  to={item.to}
  className={cn(
    'relative flex items-center gap-3 rounded-lg px-3 py-2',
    'text-sm transition-colors duration-150',
    'hover:bg-muted/70 focus:outline-none focus-visible:ring-2 focus-visible:ring-ring',
    isCollapsed && 'justify-center px-2 py-2',
    isActive
      ? 'bg-vibe-orange/10 font-medium text-vibe-orange'
      : 'text-muted-foreground',
  )}
>
  {/* Pill indicator — brand-required for active state */}
  {isActive && (
    <span
      className="absolute left-0 top-1/2 -translate-y-1/2 w-1 h-[65%] rounded-r-full bg-vibe-orange"
      aria-hidden="true"
    />
  )}
  <Icon
    size={16}
    className={cn(
      'flex-shrink-0',
      isActive ? 'text-vibe-orange' : 'text-muted-foreground',
    )}
    aria-hidden="true"
  />
  {!isCollapsed && <span className="truncate">{item.name}</span>}
</Link>
```

### Replacing window.prompt() with a Proper Dialog

```tsx
// Pattern from callvault/src/components/layout/CreateOrganizationDialog.tsx
// Use Dialog.Root from 'radix-ui' — already installed

import { Dialog } from 'radix-ui'

function CreateWorkspaceDialog({ open, onOpenChange, onSubmit }) {
  const [name, setName] = useState('')

  return (
    <Dialog.Root open={open} onOpenChange={onOpenChange}>
      <Dialog.Portal>
        <Dialog.Overlay className="fixed inset-0 bg-black/50 backdrop-blur-sm z-50
          data-[state=open]:animate-in data-[state=closed]:animate-out
          data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0" />
        <Dialog.Content className={cn(
          'fixed left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 z-50',
          'w-full max-w-sm bg-background border border-border rounded-xl shadow-2xl p-5',
          'data-[state=open]:animate-in data-[state=closed]:animate-out',
          'data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95',
          'focus:outline-none',
        )}>
          <Dialog.Title className="font-montserrat font-extrabold text-base uppercase tracking-wide text-foreground mb-4">
            Create Workspace
          </Dialog.Title>
          <input
            value={name}
            onChange={(e) => setName(e.target.value)}
            placeholder="Workspace name"
            className="w-full rounded-lg border border-border bg-muted/30 px-3 py-2
              text-sm text-foreground placeholder:text-muted-foreground/60
              focus:outline-none focus:ring-2 focus:ring-ring"
          />
          <div className="flex gap-2 mt-4">
            <Dialog.Close asChild>
              <button className="flex-1 rounded-lg border border-border py-2 text-xs font-medium">
                Cancel
              </button>
            </Dialog.Close>
            <button
              onClick={() => { onSubmit(name); onOpenChange(false) }}
              className="flex-1 rounded-lg bg-brand-400 py-2 text-xs font-semibold text-white"
            >
              Create
            </button>
          </div>
        </Dialog.Content>
      </Dialog.Portal>
    </Dialog.Root>
  )
}
```

### Claude Code Skill File Format

Based on the marketplace skill pattern found at `.claude/plugins/marketplaces/claude-code-workflows/plugins/backend-development/skills/api-design-principles/SKILL.md`:

```markdown
---
name: callvault-design-system
description: CallVault v2 design system rules for UI agents. Use when building or modifying
  any UI component, page, or layout in the callvault repo. Enforces brand consistency.
---

# CallVault Design System

[Sections covering: color tokens, pane architecture, nav states, typography, buttons, icons, animations]
```

**Location recommendation:** `.claude/skills/callvault-design-system/SKILL.md` in the brain repo, OR a new `/Users/Naegele/.claude/skills/callvault-design-system.md` for global access. Given the consumer is GSD agents spawned from the brain repo, placing it in the brain repo `.claude/skills/` is most accessible.

---

## Current State Inventory (v2 — As-Built After Phase 16)

### What's Good (Keep As-Is)

| Surface | Status | Notes |
|---------|--------|-------|
| AppShell structure | Good | Flex row pane composition is architecturally correct |
| Spring physics config | Good | stiffness 260, damping 28 — correct Linear feel |
| OrgSwitcherBar functional | Good | Dropdown, org switching, create org dialog all work |
| WorkspaceSidebarPane | Good | Collapsible workspaces + nested folders + DnD targets |
| DetailPaneOutlet structure | Good | AnimatePresence + motion.aside in flex row is right |
| Breadcrumb component | Good | Org > Workspace > Folder > Call hierarchy |
| SidebarToggle | Good | Edge-mounted, stopPropagation, z-index correct |
| Import page tabs | Functional | Visual styling needs brand alignment |
| Icon library | Good | All Remix Icon — consistent throughout |

### What Needs Fixing

| Surface | Issue | Priority |
|---------|-------|----------|
| DetailPaneOutlet | `x: 20` creates drawer feel instead of pane push | CRITICAL |
| SidebarNav active states | Missing pill indicator, no fill icons, uses `bg-muted` not `bg-vibe-orange/10` | HIGH |
| WorkspaceSidebarPane create | Uses `window.prompt()` — must replace with dialog | HIGH |
| Workspaces page create | Uses `window.prompt()` — must replace with dialog | HIGH |
| Import tabs | `border-b-2 border-foreground` (black) not vibe orange underline | MEDIUM |
| Workspaces page button | Direct `bg-brand-400` not `Button variant="default"` | MEDIUM |
| CallActionMenu | Hand-rolled dropdown — should use Radix DropdownMenu | MEDIUM |
| OrgSwitcherBar visual | Needs audit — h-10 bar above panes may look disconnected | MEDIUM |
| All "Coming soon" content | Settings pages mostly empty — needs proper placeholder | LOW |
| Dark mode | Unknown state — needs audit | MEDIUM |

### Known Missing Implementations

- Detail panel content (PanelPlaceholder shown for all panel types)
- Real folder management (rename, archive via UI — only create via prompt)
- Invite flow UI
- Settings category content (most show "Coming soon")
- ModelExplorer onboarding timing/trigger (code exists but needs verification)

---

## State of the Art

| Old Approach (v1) | v2 Approach | Notes |
|-------------------|-------------|-------|
| CSS `transition-all duration-500` for panes | motion/react spring physics | v2 is better — springier, more Linear-like |
| `useState` for sidebar in component | Zustand `usePreferencesStore` | v2 persists to localStorage, cross-tab sync |
| Panel always in DOM, CSS width transition | AnimatePresence removes from DOM on close | v2 is better for accessibility and perf |
| No OrgSwitcherBar | OrgSwitcherBar above panes | v2 structural addition — has no v1 equivalent |
| Panel data: any type | Discriminated union PanelData | v2 is type-safer |
| 300ms panel transitions | Spring physics (no fixed duration) | Spring settles ~350-400ms naturally |

**Current brand guidelines version:** v4.2.1 (February 10, 2026)

**Version increment for phase 16.1:** Based on the docs/CLAUDE.md versioning rules:
- Patch (1-2 sections changed): No file rename, just increment last digit
- Minor (3+ sections): File rename required
- If audit reveals 3+ sections need updating, create `brand-guidelines-v4.3.md`
- If audit reveals <3 sections, update in-place as `v4.2.2`

---

## Open Questions

1. **Dark mode implementation state**
   - What we know: CSS variables are defined for dark mode in globals.css; `.dark` class is required
   - What's unclear: Is dark mode actually tested and working in v2? What's the toggle mechanism?
   - Recommendation: Audit discovers dark mode state; if broken, fix core tokens but defer per-surface dark mode polish

2. **ModelExplorer trigger timing**
   - What we know: `showOnboarding` flag exists in `usePreferencesStore`; `SidebarNav` has "How it works" button that sets `setShowOnboarding(true)`
   - What's unclear: Where is ModelExplorer rendered? Is there a first-login trigger?
   - Recommendation: Search for `ModelExplorer` render location; verify it shows on first login

3. **Brand skill location**
   - What we know: No existing `.claude/skills/` directory found at `~/.claude/skills/`; marketplace pattern uses `SKILL.md` with frontmatter
   - What's unclear: Whether skill should live in brain repo or global `.claude/`
   - Recommendation: Place in brain repo at `.claude/skills/callvault-design-system.md` for GSD agent access

4. **Import tab indicator color**
   - What we know: Current active tab uses `border-b-2 border-foreground` (near-black in light mode)
   - What's unclear: Should it be vibe orange? Brand says vibe orange for active tab underlines (one of the 9 approved uses)
   - Recommendation: Change to `border-vibe-orange` to match brand guidelines v4.2

5. **DetailPaneOutlet close button positioning**
   - What we know: Close button uses `className="absolute top-3 right-3"` but parent has `overflow-hidden` — button may clip
   - What's unclear: Does `absolute` positioning work correctly inside `overflow-hidden` motion.aside?
   - Recommendation: Verify visually; may need `relative` wrapper inside the aside for the button

---

## Sources

### Primary (HIGH confidence)

- `/Users/Naegele/dev/callvault/src/components/layout/AppShell.tsx` — v2 AppShell full source
- `/Users/Naegele/dev/brain/src/components/layout/AppShell.tsx` — v1 AppShell full source (reference)
- `/Users/Naegele/dev/callvault/src/components/layout/DetailPaneOutlet.tsx` — Pane 4 implementation
- `/Users/Naegele/dev/brain/src/components/layout/DetailPaneOutlet.tsx` — v1 Pane 4 (CSS transition approach)
- `/Users/Naegele/dev/callvault/src/stores/panelStore.ts` — Panel state management
- `/Users/Naegele/dev/callvault/src/stores/preferencesStore.ts` — Layout state persistence
- `/Users/Naegele/dev/callvault/src/globals.css` — Full color system (lines 1-300)
- `/Users/Naegele/dev/brain/docs/design/brand-guidelines-v4.2.md` — Brand guidelines (2914 lines, sampled key sections)
- `/Users/Naegele/dev/brain/src/CLAUDE.md` — Frontend CLAUDE instructions
- All route files under `/Users/Naegele/dev/callvault/src/routes/_authenticated/`
- All layout components under `/Users/Naegele/dev/callvault/src/components/layout/`

### Secondary (MEDIUM confidence)

- `/Users/Naegele/.claude/plugins/marketplaces/claude-code-workflows/plugins/backend-development/skills/api-design-principles/SKILL.md` — Skill file format reference (different domain but same format)

---

## Metadata

**Confidence breakdown:**
- AppShell/Pane 4 fix: HIGH — direct code comparison v1 vs v2 confirms the `x: 20` issue
- Surface audit scope: HIGH — all route files and components read directly
- Current issues inventory: HIGH — found by reading actual source code
- Brand guidelines content: HIGH — read directly from v4.2.md
- Skill file format: MEDIUM — inferred from marketplace example, not official Claude docs
- window.prompt() locations: HIGH — confirmed by grep

**Research date:** 2026-02-28
**Valid until:** 2026-03-28 (30 days — stable codebase, no external dependencies to track)
