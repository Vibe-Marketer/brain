---
phase: 16.1-workspace-polish-brand-guidelines
plan: 02
type: execute
wave: 2
depends_on: ["16.1-01"]
files_modified:
  - /Users/Naegele/dev/callvault/src/components/layout/SidebarNav.tsx
  - /Users/Naegele/dev/callvault/src/components/layout/WorkspaceSidebarPane.tsx
  - /Users/Naegele/dev/callvault/src/routes/_authenticated/workspaces/index.tsx
  - /Users/Naegele/dev/callvault/src/components/layout/CreateWorkspaceDialog.tsx
autonomous: true

must_haves:
  truths:
    - "SidebarNav active state has pill indicator, fill icon, and vibe-orange tinting"
    - "Workspace creation uses a proper Radix Dialog, not window.prompt()"
    - "Workspaces page Create Workspace button uses Button component pattern, not raw bg-brand-400"
  artifacts:
    - path: "src/components/layout/SidebarNav.tsx"
      provides: "4-layer active state per brand guidelines"
      contains: "bg-vibe-orange"
    - path: "src/components/layout/CreateWorkspaceDialog.tsx"
      provides: "Dialog replacement for window.prompt"
      contains: "Dialog.Root"
    - path: "src/components/layout/WorkspaceSidebarPane.tsx"
      provides: "Uses CreateWorkspaceDialog instead of window.prompt"
    - path: "src/routes/_authenticated/workspaces/index.tsx"
      provides: "Uses CreateWorkspaceDialog and proper button styling"
  key_links:
    - from: "WorkspaceSidebarPane.tsx"
      to: "CreateWorkspaceDialog.tsx"
      via: "dialog open state"
      pattern: "CreateWorkspaceDialog"
    - from: "workspaces/index.tsx"
      to: "CreateWorkspaceDialog.tsx"
      via: "dialog open state"
      pattern: "CreateWorkspaceDialog"
---

<objective>
Fix the high-priority known issues identified by research: SidebarNav active state polish (pill indicator + fill icons + vibe-orange tinting), replace both window.prompt() calls with proper Radix Dialogs, and fix the workspaces page button styling.

Purpose: These are concrete, known issues that make the app feel like a prototype. The window.prompt() calls block the browser thread and break dev-browser automation. The nav active states are the most frequently seen UI element and set the tone for the whole app. The raw bg-brand-400 button violates brand guidelines (vibe orange is not for button backgrounds).

Output: A polished sidebar nav with Linear-level active states, a reusable CreateWorkspaceDialog component, and consistent button styling on the workspaces page.
</objective>

<execution_context>
@/Users/Naegele/.claude/get-shit-done/workflows/execute-plan.md
@/Users/Naegele/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@/Users/Naegele/dev/brain/.planning/ROADMAP.md
@/Users/Naegele/dev/brain/.planning/phases/16.1-workspace-polish-brand-guidelines/16.1-RESEARCH.md
@/Users/Naegele/dev/brain/docs/design/brand-guidelines-v4.2.md
@/Users/Naegele/dev/callvault/src/components/layout/SidebarNav.tsx
@/Users/Naegele/dev/callvault/src/components/layout/WorkspaceSidebarPane.tsx
@/Users/Naegele/dev/callvault/src/components/layout/CreateOrganizationDialog.tsx (pattern reference)
@/Users/Naegele/dev/callvault/src/routes/_authenticated/workspaces/index.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Polish SidebarNav active states to Linear quality</name>
  <files>
    /Users/Naegele/dev/callvault/src/components/layout/SidebarNav.tsx
  </files>
  <action>
Upgrade the SidebarNav active state from the current simplified version to the full brand-required 4-layer active state. Reference: Linear app nav (clean, fast, dense-but-not-cluttered feel).

Current (simplified):
```tsx
isActive ? 'bg-muted font-medium text-foreground' : 'text-muted-foreground'
```

Change to (full brand treatment):

1. **Background tint:** Replace `bg-muted` with `bg-vibe-orange/10` for active items. This gives a warm, subtle tint that signals "active" without being loud.

2. **Text color:** Active items use `text-foreground` (keep) with `font-medium` (keep). Do NOT use `text-vibe-orange` for the label text — vibe orange on text fails WCAG contrast. Keep text as foreground.

3. **Icon variant:** The nav items currently all use `-Line` variants (RiPhoneLine, etc.). For active state, switch to `-Fill` variants. Add fill variants to the navItems config:
   - RiPhoneLine -> RiPhoneFill (active)
   - RiGroup2Line -> RiGroup2Fill (active)
   - RiDownloadLine -> RiDownloadFill (active)
   - RiSettings3Line -> RiSettings3Fill (active)
   Import the fill variants from `@remixicon/react`.
   Use the fill variant when `isActive` is true, line variant when false.
   Active icon color: `text-vibe-orange`. Inactive: `text-muted-foreground`.

4. **Pill indicator:** Add a 4px-wide rounded pill on the left edge of active nav items:
   ```tsx
   {isActive && (
     <span
       className="absolute left-0 top-1/2 -translate-y-1/2 w-1 h-[65%] rounded-r-full bg-vibe-orange"
       aria-hidden="true"
     />
   )}
   ```
   This requires the Link to have `relative` in its className (already has it via the position context). Verify the pill is visible and not clipped by overflow. The pill sits at the very left edge of the nav item, visually extending from the sidebar boundary.

5. **Hover state:** Keep `hover:bg-muted/70` for inactive items. For active items, no additional hover effect needed (they already have the orange tint).

6. **Collapsed state:** In collapsed mode (icon-only), the pill should still show. The fill icon should still be used for active. The orange tint background should still apply. Ensure the collapsed layout (`justify-center px-2 py-2`) doesn't clip the pill.

The overall feel should match Linear's sidebar: clean, the active item is obvious at a glance, subtle color accent, not shouting.
  </action>
  <verify>
1. Open dev-browser at callvault.vercel.app or localhost:8080
2. Navigate between All Calls, Workspaces, Import, Settings
3. Verify: Active nav item has orange tint background, fill icon with orange color, left pill indicator
4. Verify: Inactive items have line icons, muted text, no pill
5. Verify: Collapsed sidebar shows pill and fill icon correctly
6. Verify: Hover states work on inactive items
7. Run `cd /Users/Naegele/dev/callvault && npx tsc --noEmit`
  </verify>
  <done>
SidebarNav has 4-layer active state: bg-vibe-orange/10 tint, fill icon variant with orange color, font-medium text, and left-edge pill indicator. Collapsed state preserves all active indicators. Matches Linear's clean, obvious active state feel.
  </done>
</task>

<task type="auto">
  <name>Task 2: Replace window.prompt() with CreateWorkspaceDialog</name>
  <files>
    /Users/Naegele/dev/callvault/src/components/layout/CreateWorkspaceDialog.tsx
    /Users/Naegele/dev/callvault/src/components/layout/WorkspaceSidebarPane.tsx
    /Users/Naegele/dev/callvault/src/routes/_authenticated/workspaces/index.tsx
  </files>
  <action>
**Create CreateWorkspaceDialog.tsx** (new file) following the exact pattern of CreateOrganizationDialog.tsx which already exists in the codebase. The dialog should:

1. Accept `open: boolean`, `onOpenChange: (open: boolean) => void`, and `orgId: string` props
2. Use Radix `Dialog` primitives (already installed): Dialog.Root, Dialog.Portal, Dialog.Overlay, Dialog.Content, Dialog.Title, Dialog.Close
3. Contain a single text input for workspace name
4. Call `useCreateWorkspace()` mutation on submit
5. Clear input and close dialog on success
6. Show error toast on failure via sonner
7. Auto-focus the input when dialog opens
8. Submit on Enter key press
9. Disable submit button while mutation is pending or input is empty
10. Match the exact visual styling of CreateOrganizationDialog (same overlay blur, same content sizing, same button styles, same Montserrat title)

**Update WorkspaceSidebarPane.tsx:**
- Remove `window.prompt('Workspace name:')` from `handleCreateWorkspace` (line ~274)
- Add `const [dialogOpen, setDialogOpen] = useState(false)` state
- Change the "+" button onClick to `() => setDialogOpen(true)`
- Render `<CreateWorkspaceDialog open={dialogOpen} onOpenChange={setDialogOpen} orgId={activeOrgId!} />` at the end of the component

**Update workspaces/index.tsx:**
- Remove `window.prompt('Workspace name:')` from `handleCreateWorkspace` (line ~73)
- Add `const [dialogOpen, setDialogOpen] = useState(false)` state
- Change both "Create Workspace" buttons' onClick to `() => setDialogOpen(true)`
- Replace the raw `bg-brand-400 text-white` button styling with proper button pattern: use a proper styled button that matches the brand. Per brand guidelines, CTA buttons should use the default Button variant (slate gradient) or at minimum not use raw vibe orange for backgrounds. Replace with a proper button using the ui/button component `Button variant="default"` OR use a neutral style: `bg-foreground text-background` (dark button in light mode, light button in dark mode) which is the standard Linear-style CTA approach.
- Render `<CreateWorkspaceDialog open={dialogOpen} onOpenChange={setDialogOpen} orgId={activeOrgId!} />` at the end

**Fix empty state button too:** The workspaces page empty state has a second "Create Workspace" button (line ~130) also using `bg-brand-400`. Update this to match the header button styling.
  </action>
  <verify>
1. Open dev-browser, navigate to /workspaces
2. Click "Create Workspace" button in header — verify Radix Dialog opens (NOT window.prompt)
3. Type a workspace name, press Enter or click Create — verify workspace is created
4. Verify dialog closes on success and workspace appears in the list
5. Navigate to All Calls page (/), verify WorkspaceSidebarPane "+" button opens the same dialog
6. Verify Cancel button closes dialog without creating
7. Verify empty input state disables the Create button
8. Grep the entire callvault/src directory for `window.prompt` — should return 0 results
9. Run `cd /Users/Naegele/dev/callvault && npx tsc --noEmit`
  </verify>
  <done>
Both window.prompt() calls replaced with a reusable CreateWorkspaceDialog component. Dialog follows the same pattern as CreateOrganizationDialog. Workspaces page buttons use proper styling (no raw bg-brand-400). Zero instances of window.prompt() remain in the codebase.
  </done>
</task>

</tasks>

<verification>
1. SidebarNav active states: pill indicator visible, fill icons for active, orange tint background
2. No window.prompt() calls anywhere in codebase (`grep -r "window.prompt" src/` returns nothing)
3. CreateWorkspaceDialog opens from both WorkspaceSidebarPane and workspaces page
4. Workspace creation works end-to-end through the dialog
5. Workspaces page buttons do not use raw bg-brand-400
6. TypeScript compiles cleanly
</verification>

<success_criteria>
The sidebar navigation matches Linear's polish level with a clear, branded active state. Workspace creation happens through a proper modal dialog, not a browser prompt. All button styling follows brand guidelines. The app no longer has any prototype-quality UI patterns.
</success_criteria>

<output>
After completion, create `.planning/phases/16.1-workspace-polish-brand-guidelines/16.1-02-SUMMARY.md`
</output>
