---
phase: 16.1-workspace-polish-brand-guidelines
plan: 04
type: execute
wave: 4
depends_on: ["16.1-01", "16.1-02", "16.1-03"]
files_modified:
  - /Users/Naegele/dev/brain/.claude/skills/callvault-design-system.md
  - /Users/Naegele/dev/brain/docs/design/brand-guidelines-v4.2.md
autonomous: true

must_haves:
  truths:
    - "A brand guidelines skill exists that Claude Code agents can reference during UI work"
    - "The skill covers: color tokens, pane architecture, nav states, typography, buttons, icons, animations, spacing"
    - "The skill reflects actual v2 patterns discovered during audit, not aspirational rules"
    - "Brand guidelines document is updated to reflect any findings that diverged from v4.2"
  artifacts:
    - path: ".claude/skills/callvault-design-system.md"
      provides: "Machine-readable design system reference for Claude Code agents"
      min_lines: 100
    - path: "docs/design/brand-guidelines-v4.2.md"
      provides: "Updated brand guidelines reflecting Phase 16.1 audit findings"
  key_links:
    - from: ".claude/skills/callvault-design-system.md"
      to: "docs/design/brand-guidelines-v4.2.md"
      via: "references canonical brand doc for full details"
      pattern: "brand-guidelines"
---

<objective>
Create the definitive brand guidelines skill for Claude Code agents and update the brand guidelines document to reflect any findings from the Phase 16.1 audit.

Purpose: The brand guidelines skill is the primary consumer-facing output for future phases. Every GSD agent doing UI work will reference this skill to maintain consistency. It codifies the actual patterns used in the v2 codebase (not aspirational rules), making it a practical reference rather than a theoretical document. The brand guidelines document update ensures the canonical reference reflects reality.

Output: A `.claude/skills/callvault-design-system.md` file optimized for machine consumption. An updated brand-guidelines document if audit findings require changes.
</objective>

<execution_context>
@/Users/Naegele/.claude/get-shit-done/workflows/execute-plan.md
@/Users/Naegele/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@/Users/Naegele/dev/brain/.planning/ROADMAP.md
@/Users/Naegele/dev/brain/.planning/phases/16.1-workspace-polish-brand-guidelines/16.1-RESEARCH.md
@/Users/Naegele/dev/brain/.planning/phases/16.1-workspace-polish-brand-guidelines/16.1-01-SUMMARY.md
@/Users/Naegele/dev/brain/.planning/phases/16.1-workspace-polish-brand-guidelines/16.1-02-SUMMARY.md
@/Users/Naegele/dev/brain/.planning/phases/16.1-workspace-polish-brand-guidelines/16.1-03-SUMMARY.md
@/Users/Naegele/dev/brain/docs/design/brand-guidelines-v4.2.md
@/Users/Naegele/dev/brain/src/CLAUDE.md
@/Users/Naegele/dev/callvault/src/globals.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create callvault-design-system skill</name>
  <files>
    /Users/Naegele/dev/brain/.claude/skills/callvault-design-system.md
  </files>
  <action>
Create the brand guidelines skill file at `.claude/skills/callvault-design-system.md` in the brain repo. This is a new file in an existing `.claude/skills/` directory.

The skill should be optimized for Claude Code agents (primary consumer per user decision). Structure it as a practical reference, not a design theory document.

**Format:** Use frontmatter + structured markdown sections. Follow the pattern of existing skills in `.claude/skills/` (if any have a common format) or use this structure:

```markdown
---
name: callvault-design-system
description: >
  CallVault v2 design system rules for UI implementation. Reference when building or modifying
  any UI component, page, or layout in the callvault repo. Enforces brand consistency and
  prevents common visual mistakes.
applies_to:
  - /Users/Naegele/dev/callvault/src/**
  - /Users/Naegele/dev/brain/src/**
---
```

**Required sections (derive content from Plans 01-03 SUMMARY files and brand-guidelines-v4.2.md):**

1. **Quick Reference** — The 10 rules an agent needs most often. Things like: "All pages use AppShell", "Icons from @remixicon/react only", "Vibe orange for 9 uses only", etc.

2. **Color System** — Exact tokens with their CSS variable names and when to use each:
   - bg-viewport, bg-card, bg-muted (when to use each)
   - text-foreground, text-muted-foreground
   - border-border, border-border/60, border-border/40 (semantic meaning of each opacity)
   - Vibe orange: exact 9 approved uses (list them concisely)
   - Brand scale: bg-brand-400 etc. (and where NOT to use them)

3. **Layout Architecture** — AppShell pane system:
   - Pane widths (locked values)
   - Spring config (stiffness 260, damping 28 — do not change)
   - DetailPaneOutlet: width-only animation, no x offset
   - OrgSwitcherBar: position and styling
   - Background hierarchy: viewport > card
   - Gap: gap-3 (12px), padding: p-1

4. **Navigation Active States** — The 4-layer system implemented in Plan 02:
   - bg-vibe-orange/10 tint
   - Fill icon variant (RiXxxFill) with text-vibe-orange color
   - font-medium text
   - Left-edge pill indicator (w-1 rounded-r-full bg-vibe-orange)
   - Include code snippet

5. **Typography** — Heading and body rules:
   - Headings: font-montserrat font-extrabold uppercase tracking-wide
   - Body: text-sm (default), text-xs (secondary)
   - Numbers: tabular-nums
   - Include size hierarchy: text-xl (page titles), text-sm (body), text-xs (metadata), text-[11px] (tiny), text-[10px] (labels)

6. **Button System** — Correct button patterns:
   - Primary CTA: Button variant="default" (slate gradient) — NOT bg-brand-400
   - Secondary: Button variant="hollow" (bordered)
   - Ghost: for icon buttons
   - Dialog action buttons: bg-brand-400 text-white is OK inside dialogs only
   - Never use vibe orange for large button backgrounds outside dialogs

7. **Icon Rules** — Remix Icon only:
   - Default: -Line variants, 16px, text-muted-foreground
   - Active: -Fill variants, text-vibe-orange
   - List of common icons used in codebase

8. **Component Patterns** — Standard patterns:
   - Dialogs: Radix Dialog (reference CreateOrganizationDialog and CreateWorkspaceDialog)
   - Dropdowns: Radix DropdownMenu (reference OrgSwitcherBar, CallActionMenu)
   - Collapsible: Radix Collapsible (reference WorkspaceSidebarPane)
   - Toasts: sonner toast()
   - DO NOT hand-roll any of these

9. **Animation Rules** — Spring physics:
   - Import from motion/react (NOT framer-motion)
   - SPRING config: { type: 'spring', stiffness: 260, damping: 28 }
   - Do not change spring config
   - Use AnimatePresence for enter/exit
   - Width animations only for panel push (no x offset)

10. **Tab Navigation** — Active tab styling:
    - Active: border-b-2 border-vibe-orange, text-foreground
    - Inactive: text-muted-foreground hover:text-foreground
    - Include code snippet

11. **Anti-Patterns** — Things to never do:
    - window.prompt() for user input
    - bg-brand-400 for button backgrounds (outside dialogs)
    - Custom dropdown menus (use Radix)
    - framer-motion imports (use motion/react)
    - Vibe orange for text (fails WCAG)
    - 300ms transitions (use 500ms or spring)
    - Hardcoded wrong pane widths

12. **Dark Mode** — Token mapping:
    - bg-viewport: #FCFCFC -> #161616
    - bg-card: #FFFFFF -> #202020
    - Primary/destructive buttons never change in dark mode
    - Include any findings from Plan 03 dark mode audit

Keep each section concise — code snippets where helpful, tables for reference data, bullet points for rules. Total target: 200-400 lines. The skill should be scannable in 2 minutes by an agent that needs to quickly understand the design system.
  </action>
  <verify>
1. File exists at /Users/Naegele/dev/brain/.claude/skills/callvault-design-system.md
2. File has valid frontmatter with name, description, applies_to
3. File covers all 12 sections listed above
4. File is 200-400 lines (not too short to be useful, not too long to be ignored)
5. Color tokens match actual values in globals.css
6. Pane widths match CONTEXT.md and AppShell.tsx
7. Code snippets are from actual v2 codebase (not hypothetical)
8. Anti-patterns list includes all issues found and fixed in Plans 01-03
  </verify>
  <done>
A comprehensive, machine-optimized design system skill exists at .claude/skills/callvault-design-system.md. It covers color tokens, layout architecture, nav states, typography, buttons, icons, component patterns, animations, tabs, anti-patterns, and dark mode. Content is derived from actual v2 codebase patterns and Phase 16.1 audit findings.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update brand guidelines if audit findings diverge</name>
  <files>
    /Users/Naegele/dev/brain/docs/design/brand-guidelines-v4.2.md
  </files>
  <action>
Review the Phase 16.1 audit findings (from Plans 01-03 SUMMARYs) against brand-guidelines-v4.2.md. Per user decision: "Audit against brand-guidelines-v4.2.md AND instinct — flag things that technically comply but still look off. Update guidelines where findings diverge from what looks right."

**Check for divergences:**

1. **Nav active state:** v4.2 may specify different active state styling than what Plan 02 implemented. If Plan 02's implementation (pill + fill icon + orange tint) works better in practice, update the guidelines to match.

2. **Tab underline:** Verify v4.2's tab navigation section matches the vibe-orange underline used in Plan 03. Update if needed.

3. **Pane architecture:** v4.2 was written for v1. Add a section or update the existing Layout Architecture section to document v2's motion/react spring system, OrgSwitcherBar, and the 4-pane composition.

4. **Button usage in dialogs:** If the audit revealed that bg-brand-400 is acceptable inside dialogs (e.g., Create Workspace dialog action button) but not for page-level buttons, add this nuance to the button system section.

5. **Spring animation:** If v4.2 documents CSS transitions (500ms duration), add spring physics as the v2 equivalent.

**Versioning rules (from docs/CLAUDE.md):**
- If 1-2 sections changed: patch version (v4.2.1 -> v4.2.2). No file rename.
- If 3+ sections changed: minor version (v4.2 -> v4.3). File rename required. Move old to /docs/archive/.
- Update version in 3 places: title line 1, DOCUMENT VERSION section, END OF BRAND GUIDELINES last line.
- Add entry to /docs/brand-guidelines-changelog.md.

Read the existing brand-guidelines-v4.2.md to determine which sections need updating. If fewer than 3 sections need changes, do a patch update in-place. If 3+ sections, create v4.3.

Be conservative — only update what the audit actually revealed. Don't rewrite sections that are still accurate.
  </action>
  <verify>
1. Read updated brand guidelines and verify version was incremented in all 3 places
2. Verify changelog entry was added to /docs/brand-guidelines-changelog.md
3. If minor version bump: verify old file archived to /docs/archive/
4. Verify updates reflect actual Phase 16.1 findings (not hypothetical changes)
5. Verify no existing accurate sections were unnecessarily rewritten
  </verify>
  <done>
Brand guidelines document updated to reflect Phase 16.1 audit findings. Version incremented per docs/CLAUDE.md rules. Changelog entry added. Guidelines now accurately describe both v1 and v2 patterns where they diverge.
  </done>
</task>

</tasks>

<verification>
1. Brand skill file exists at .claude/skills/callvault-design-system.md with all required sections
2. Brand guidelines version incremented correctly
3. Changelog entry added
4. Skill content matches actual codebase patterns (not aspirational)
5. Both files are internally consistent (skill references guidelines, guidelines reflect audit)
</verification>

<success_criteria>
Future GSD agents can reference the brand skill when doing UI work and produce visually consistent output without needing to read the full 2900-line brand guidelines document. The brand guidelines document accurately reflects the v2 design system as it exists after Phase 16.1 polish.
</success_criteria>

<output>
After completion, create `.planning/phases/16.1-workspace-polish-brand-guidelines/16.1-04-SUMMARY.md`
</output>
