---
phase: 16.1-workspace-polish-brand-guidelines
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - /Users/Naegele/dev/callvault/src/components/layout/DetailPaneOutlet.tsx
  - /Users/Naegele/dev/callvault/src/components/layout/AppShell.tsx
  - /Users/Naegele/dev/callvault/src/components/layout/OrgSwitcherBar.tsx
autonomous: true

must_haves:
  truths:
    - "Pane 4 pushes Pane 3 via flex reflow — no drawer offset, no overlay"
    - "All panes operate on the same z-index plane"
    - "OrgSwitcherBar header visually integrates with pane container below"
    - "Page background, pane backgrounds, and pane chrome feel cohesive"
  artifacts:
    - path: "src/components/layout/DetailPaneOutlet.tsx"
      provides: "Same-plane push animation for Pane 4"
      contains: "initial={{ width: 0, opacity: 0 }}"
    - path: "src/components/layout/AppShell.tsx"
      provides: "Cohesive background and gap treatment"
    - path: "src/components/layout/OrgSwitcherBar.tsx"
      provides: "Header that visually connects with panes below"
  key_links:
    - from: "DetailPaneOutlet.tsx"
      to: "AppShell flex row"
      via: "flex-shrink-0 in same flex parent"
      pattern: "width.*0.*360"
---

<objective>
Fix the #1 priority AppShell alignment issue: DetailPaneOutlet Pane 4 must push/shrink Pane 3 on the same plane (no drawer/overlay feel), and the header + background must feel cohesive and match v1's visual quality.

Purpose: The current Pane 4 has `x: 20` offset in its motion animation, creating a drawer-slide feel instead of the correct same-plane push behavior. This is the single most important fix in Phase 16.1 per user decision.

Output: A DetailPaneOutlet that animates width-only (no x offset), an OrgSwitcherBar that integrates visually with the pane container, and AppShell background/gap treatment that feels cohesive.
</objective>

<execution_context>
@/Users/Naegele/.claude/get-shit-done/workflows/execute-plan.md
@/Users/Naegele/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@/Users/Naegele/dev/brain/.planning/ROADMAP.md
@/Users/Naegele/dev/brain/.planning/STATE.md
@/Users/Naegele/dev/brain/.planning/phases/16.1-workspace-polish-brand-guidelines/16.1-RESEARCH.md
@/Users/Naegele/dev/brain/docs/design/brand-guidelines-v4.2.md
@/Users/Naegele/dev/brain/src/components/layout/AppShell.tsx (v1 reference)
@/Users/Naegele/dev/callvault/src/components/layout/AppShell.tsx
@/Users/Naegele/dev/callvault/src/components/layout/DetailPaneOutlet.tsx
@/Users/Naegele/dev/callvault/src/components/layout/OrgSwitcherBar.tsx
@/Users/Naegele/dev/callvault/src/globals.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix DetailPaneOutlet same-plane push animation</name>
  <files>
    /Users/Naegele/dev/callvault/src/components/layout/DetailPaneOutlet.tsx
  </files>
  <action>
Remove the `x: 20` from `initial` and `exit` keyframes in the motion.aside element. This is the critical fix that eliminates the drawer feel.

Current (BROKEN):
```
initial={{ width: 0, opacity: 0, x: 20 }}
animate={{ width, opacity: 1, x: 0 }}
exit={{ width: 0, opacity: 0, x: 20 }}
```

Change to (CORRECT):
```
initial={{ width: 0, opacity: 0 }}
animate={{ width, opacity: 1 }}
exit={{ width: 0, opacity: 0 }}
```

Keep the SPRING config exactly as-is (stiffness 260, damping 28). Do NOT change it.

Also fix the close button positioning: the button uses `absolute top-3 right-3` but the parent has `overflow-hidden`, which will clip it. Add a `relative` wrapper div inside the aside for the close button, or change the close button approach to be inside the flex flow (not absolutely positioned). The close button should be in a header row at the top of the panel, not floating with absolute positioning.

Replace the raw `&#x2715;` character with a proper Remix Icon (RiCloseLine) for consistency with the rest of the app. Import from `@remixicon/react`.
  </action>
  <verify>
1. Open the app in dev-browser at localhost:8080 or callvault.vercel.app
2. Navigate to the calls list page (/) where showDetailPane is true
3. Trigger the panel open (if panelStore has no openPanel call wired yet, temporarily add one or use React DevTools to call openPanel)
4. Verify: Pane 4 animates width from 0 to 360px with NO horizontal sliding offset
5. Verify: Pane 3 shrinks as Pane 4 grows (same-plane push)
6. Verify: Close button is visible and not clipped
7. Run `cd /Users/Naegele/dev/callvault && npx tsc --noEmit` to confirm no TypeScript errors
  </verify>
  <done>
DetailPaneOutlet animates with width-only spring transition. No x offset in initial or exit. Pane 3 shrinks via flex reflow when Pane 4 opens. Close button uses RiCloseLine and is not clipped by overflow-hidden.
  </done>
</task>

<task type="auto">
  <name>Task 2: Polish AppShell and OrgSwitcherBar visual integration</name>
  <files>
    /Users/Naegele/dev/callvault/src/components/layout/AppShell.tsx
    /Users/Naegele/dev/callvault/src/components/layout/OrgSwitcherBar.tsx
  </files>
  <action>
Compare v1 AppShell (brain/src/components/layout/AppShell.tsx) with v2 and ensure visual parity for background treatment and header feel. Specifically:

**AppShell.tsx adjustments:**
1. Verify the body/viewport background (`bg-viewport` or equivalent) wraps the entire shell. The v1 uses a subtle off-white body background with card-white panes. Ensure v2 matches: the gap between panes should show the viewport background (the slightly darker off-white), creating visual separation.
2. Check the `p-1` container padding — this may be too tight. Compare with v1's spacing and adjust if the panes feel cramped. The gap-3 (12px) between panes is correct per CONTEXT.md specs.
3. Ensure Pane 3 uses `border-border/60` (not `border-border` which is full opacity) for consistency with Panes 1, 2, and 4 which all use `border-border/60`.

**OrgSwitcherBar.tsx adjustments:**
1. The bar currently uses `h-10 border-b border-border/40 bg-card/80 backdrop-blur-sm`. Audit whether this visually connects to the pane container below or looks "floating/disconnected". The bar sits between the top of the viewport and the pane row.
2. Consider whether the bar should have rounded corners on top (matching pane rounded-2xl) or if it should be flush/full-width. Per v1, there is no OrgSwitcherBar — this is a v2 addition. It should feel like a natural part of the shell, not a separate element.
3. If the bar looks disconnected from panes, try: removing the border-b, adjusting the background to match card exactly (not card/80), or reducing the visual gap between bar and pane container (currently the p-1 padding creates a gap).
4. The bar's text/icon sizing is good (xs font, 14px icons). Keep those.

**Background audit:**
- Verify `bg-viewport` is used on the outermost container (the body or shell wrapper). This should be the slightly off-white (#FCFCFC light / #161616 dark) that shows through pane gaps.
- Panes should all use `bg-card` (#FFFFFF light / #202020 dark).
- OrgSwitcherBar background should complement both.

Use dev-browser to compare the current v2 look against the v1 visual feel. The goal is "the engine (spring physics) stays, the body (visual treatment) matches v1's cohesive feel."
  </action>
  <verify>
1. Screenshot the v2 AppShell at desktop width (1440px) in dev-browser
2. Compare visually against v1 at callvaultai.com or brain repo screenshots
3. Verify: No visual gap/disconnection between OrgSwitcherBar and pane container
4. Verify: Pane backgrounds are consistent (all bg-card)
5. Verify: Viewport background shows through pane gaps as subtle separator
6. Run `cd /Users/Naegele/dev/callvault && npx tsc --noEmit` to confirm no TypeScript errors
  </verify>
  <done>
AppShell background treatment matches v1's cohesive feel. OrgSwitcherBar integrates visually with the pane container below. Pane border opacity is consistent across all 4 panes. The overall shell looks like a unified application, not separate floating panels.
  </done>
</task>

</tasks>

<verification>
1. Pane 4 opens with width-only animation (no horizontal slide offset)
2. Pane 3 shrinks when Pane 4 opens (flex reflow, same plane)
3. OrgSwitcherBar does not look disconnected from pane container
4. All pane backgrounds are consistent
5. No TypeScript errors
6. Close button is visible and functional
</verification>

<success_criteria>
The AppShell visual behavior matches v1: Pane 4 pushes Pane 3, all panes on the same plane, header integrates with body, backgrounds are cohesive. The "drawer feel" is completely eliminated. A user switching between v1 and v2 would see the same layout behavior.
</success_criteria>

<output>
After completion, create `.planning/phases/16.1-workspace-polish-brand-guidelines/16.1-01-SUMMARY.md`
</output>
