---
phase: 02-chat-foundation
plan: 10
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/panels/CallDetailPanel.tsx
  - src/components/layout/DetailPaneOutlet.tsx
  - src/pages/Chat.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Clicking citation sources opens call details in Pane 4 panel (not popup dialog)"
    - "CallDetailPanel renders call overview, transcript tabs, and action buttons"
    - "Panel slides in from right with 300ms animation matching other panels"
  artifacts:
    - path: "src/components/panels/CallDetailPanel.tsx"
      provides: "Call detail view in panel format"
      min_lines: 100
    - path: "src/components/layout/DetailPaneOutlet.tsx"
      provides: "call-detail case in panel router"
      contains: "case 'call-detail'"
  key_links:
    - from: "src/pages/Chat.tsx"
      to: "panelStore.openPanel"
      via: "handleViewCall uses openPanel instead of setShowCallDialog"
      pattern: "openPanel.*call-detail"
    - from: "src/components/layout/DetailPaneOutlet.tsx"
      to: "src/components/panels/CallDetailPanel.tsx"
      via: "switch case renders CallDetailPanel"
      pattern: "CallDetailPanel.*recordingId"
---

<objective>
Fix Gap 1: Call Detail Panel instead of Popup Dialog

UAT found that clicking citation sources opens a popup dialog instead of a side panel. The panel architecture (Pane 4) already exists for folders/tags/settings but wasn't wired up for call details.

Purpose: Users expect call details to appear in the consistent 4-pane layout, not as a modal overlay that obscures context.
Output: CallDetailPanel.tsx with DetailPaneOutlet wiring, Chat.tsx updated to use openPanel instead of setShowCallDialog.
</objective>

<execution_context>
@/Users/Naegele/.claude/get-shit-done/workflows/execute-plan.md
@/Users/Naegele/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/components/CallDetailDialog.tsx
@src/components/panels/FolderDetailPanel.tsx
@src/components/layout/DetailPaneOutlet.tsx
@src/stores/panelStore.ts
@src/pages/Chat.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CallDetailPanel.tsx by extracting from CallDetailDialog</name>
  <files>src/components/panels/CallDetailPanel.tsx</files>
  <action>
Create a new panel component that displays call details in the Pane 4 side panel format:

1. Create `src/components/panels/CallDetailPanel.tsx` with these key differences from CallDetailDialog:
   - Remove Dialog/DialogContent wrapper - panel renders directly in DetailPaneOutlet
   - Accept `recordingId: number` prop instead of full `call: Meeting` object
   - Fetch call data internally using the same pattern as FolderDetailPanel (useMemo to find from list or direct query)
   - Add panel header with close button using `usePanelStore().closePanel`
   - Add pin button using `usePanelStore().togglePin` (matches FolderDetailPanel pattern)
   - Keep tabs: Overview, Transcript, Invitees, Participants
   - Keep the "Chat with AI" action button

2. Import pattern from FolderDetailPanel:
   - Use `usePanelStore()` for closePanel, togglePin, isPinned
   - Header structure: icon + title + pin button + close button
   - Same border-b styling for header

3. Simplify for panel context:
   - Remove the modal dialogs (ChangeSpeakerDialog, TrimConfirmDialog, ResyncConfirmDialog) - keep them in CallDetailDialog for non-chat contexts
   - For transcript editing, show a simplified read-only view or link to full dialog
   - Focus on displaying info and enabling navigation to chat

4. Width: Panel container handles width (360px desktop, 320px tablet via DetailPaneOutlet)

Pattern to follow from FolderDetailPanel:
```tsx
const { closePanel, togglePin, isPinned } = usePanelStore();

return (
  <div className="flex flex-col h-full">
    {/* Header */}
    <div className="flex items-center justify-between p-4 border-b border-border">
      <div className="flex items-center gap-2 min-w-0 flex-1">
        <RiPhoneLine className="h-5 w-5 text-ink-muted flex-shrink-0" />
        <h2 className="font-semibold text-ink truncate">{call?.title}</h2>
      </div>
      <div className="flex items-center gap-1">
        <Button variant="ghost" size="icon" onClick={togglePin}>
          {isPinned ? <RiPushpinFill /> : <RiPushpinLine />}
        </Button>
        <Button variant="ghost" size="icon" onClick={closePanel}>
          <RiCloseLine />
        </Button>
      </div>
    </div>
    {/* Content */}
    <div className="flex-1 overflow-auto p-4">
      {/* Tabs content */}
    </div>
  </div>
);
```
  </action>
  <verify>File exists at src/components/panels/CallDetailPanel.tsx with proper structure, imports usePanelStore, exports CallDetailPanel function</verify>
  <done>CallDetailPanel.tsx created with header, tabs, close/pin buttons, accepts recordingId prop</done>
</task>

<task type="auto">
  <name>Task 2: Wire CallDetailPanel into DetailPaneOutlet and Chat.tsx</name>
  <files>src/components/layout/DetailPaneOutlet.tsx, src/pages/Chat.tsx</files>
  <action>
1. Update DetailPaneOutlet.tsx:
   - Add import: `import { CallDetailPanel } from '@/components/panels/CallDetailPanel';`
   - Add case in renderPanel() switch:
     ```tsx
     case 'call-detail':
       return panelData?.recordingId ? (
         <CallDetailPanel recordingId={panelData.recordingId} />
       ) : null;
     ```
   - Add case in getAriaLabel():
     ```tsx
     case 'call-detail':
       return 'Call detail panel';
     ```

2. Update Chat.tsx handleViewCall callback:
   - Import usePanelStore at top if not already imported
   - Change from:
     ```tsx
     setSelectedCall(callData as unknown as Meeting);
     setShowCallDialog(true);
     ```
   - To:
     ```tsx
     openPanel('call-detail', { recordingId });
     ```
   - Remove or keep the setSelectedCall/setShowCallDialog state as fallback for non-panel contexts

3. Keep CallDetailDialog at bottom of Chat.tsx as fallback (don't remove yet):
   - The dialog is still used in other parts of the app (TranscriptsTab, etc.)
   - We're only changing the chat page behavior

4. Update the onSourceClick handler in SourceList render:
   - Should already work since handleViewCall is passed and we're changing its implementation
  </action>
  <verify>
1. `grep -n "case 'call-detail'" src/components/layout/DetailPaneOutlet.tsx` shows the new case
2. `grep -n "openPanel.*call-detail" src/pages/Chat.tsx` shows the new call
3. Run `npm run build` - no TypeScript errors
  </verify>
  <done>DetailPaneOutlet routes call-detail to CallDetailPanel, Chat.tsx uses openPanel instead of dialog for source clicks</done>
</task>

</tasks>

<verification>
1. Start dev server: `npm run dev`
2. Navigate to /chat
3. Ask a question that returns sources (e.g., "What did we discuss in recent calls?")
4. Click on a citation marker [1] or source in the SourceList
5. Verify: Call details appear in Pane 4 (right side panel), NOT as a popup dialog
6. Verify: Panel has close button, pin button, call title in header
7. Verify: Tabs (Overview, Transcript) are functional
8. Verify: Panel can be closed with X button or clicking elsewhere
</verification>

<success_criteria>
- Citation clicks open call details in Pane 4 side panel
- Panel matches visual style of FolderDetailPanel (header, pin, close)
- Panel animates in from right with smooth transition
- Popup dialog no longer appears when clicking sources in chat
- Build passes with no TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/02-chat-foundation/02-10-SUMMARY.md`
</output>
