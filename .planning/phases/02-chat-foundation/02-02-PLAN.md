---
phase: 02-chat-foundation
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/stores/contentLibraryStore.ts
  - src/stores/contentItemsStore.ts
  - src/stores/businessProfileStore.ts
autonomous: true

must_haves:
  truths:
    - "Store errors surface to user with toast notifications (no silent null returns)"
    - "Every failed store operation shows a clear, actionable error message"
    - "Existing optimistic rollback behavior is preserved"
  artifacts:
    - path: "src/stores/contentLibraryStore.ts"
      provides: "Toast notifications on all 7 error paths"
      contains: "toast.error"
    - path: "src/stores/contentItemsStore.ts"
      provides: "Toast notifications on all 5 error paths"
      contains: "toast.error"
    - path: "src/stores/businessProfileStore.ts"
      provides: "Toast notifications on all 4 error paths"
      contains: "toast.error"
  key_links:
    - from: "src/stores/contentLibraryStore.ts"
      to: "sonner toast"
      via: "import { toast } from 'sonner'"
      pattern: "toast\\.error"
    - from: "src/stores/contentItemsStore.ts"
      to: "sonner toast"
      via: "import { toast } from 'sonner'"
      pattern: "toast\\.error"
    - from: "src/stores/businessProfileStore.ts"
      to: "sonner toast"
      via: "import { toast } from 'sonner'"
      pattern: "toast\\.error"
---

<objective>
Fix STORE-01: Add toast.error() notifications to all 16 silent failure methods across 3 stores. Currently these stores perform optimistic updates and rollback on error, but never tell the user something went wrong.

Purpose: Users currently experience silent failures — operations appear to work but data doesn't persist. This is the #6 success criterion for Phase 2.
Output: All store error paths show actionable toast messages. Existing rollback behavior preserved.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Files to modify
@src/stores/contentLibraryStore.ts
@src/stores/contentItemsStore.ts
@src/stores/businessProfileStore.ts

# Reference: correct toast pattern (already used in useChatSession)
@src/hooks/useChatSession.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add toast.error() to contentLibraryStore and contentItemsStore</name>
  <files>src/stores/contentLibraryStore.ts, src/stores/contentItemsStore.ts</files>
  <action>
**contentLibraryStore.ts** — Add `import { toast } from 'sonner';` at the top (check if already imported). Then add `toast.error()` to these 7 methods' error paths:

1. `saveContentItem` — on error: `toast.error("Couldn't save content item. Please try again.")`
2. `deleteItem` — on error: `toast.error("Couldn't delete item. Please try again.")`
3. `incrementItemUsage` — on error: `toast.error("Couldn't update usage count.")`
4. `saveNewTemplate` — on error: `toast.error("Couldn't save template. Please try again.")`
5. `deleteTemplateItem` — on error: `toast.error("Couldn't delete template. Please try again.")`
6. `incrementTemplateUsage` — on error: `toast.error("Couldn't update template usage.")`
7. `fetchTags` — on error: `toast.error("Couldn't load tags.")`

**contentItemsStore.ts** — Add `import { toast } from 'sonner';` at the top. Then add `toast.error()` to these 5 methods' error paths:

1. `addItem` — on error: `toast.error("Couldn't add item. Please try again.")`
2. `updateItem` — on error: `toast.error("Couldn't update item. Please try again.")`
3. `removeItem` — on error: `toast.error("Couldn't remove item. Please try again.")`
4. `markItemAsUsed` — on error: `toast.error("Couldn't mark item as used.")`
5. `markItemAsDraft` — on error: `toast.error("Couldn't update item status.")`

**Rules:**
- Add `toast.error()` AFTER the existing optimistic rollback (inside the error branch, after `set()`)
- Do NOT change the return value (still return null/false as before — callers may depend on this)
- Do NOT change the optimistic rollback logic
- Do NOT add toast.success() — keep error-only to match the task scope
- Use `sonner` toast (the project's toast library), NOT react-hot-toast or similar
  </action>
  <verify>
1. `grep -c "toast.error" src/stores/contentLibraryStore.ts` returns 7
2. `grep -c "toast.error" src/stores/contentItemsStore.ts` returns 5
3. Both files compile: `tsc --noEmit` passes
4. `import { toast } from 'sonner'` present in both files
  </verify>
  <done>
- 12 of 16 silent failure methods now show toast notifications
- All existing rollback behavior unchanged
- Return values unchanged (null/false preserved for callers)
  </done>
</task>

<task type="auto">
  <name>Task 2: Add toast.error() to businessProfileStore</name>
  <files>src/stores/businessProfileStore.ts</files>
  <action>
**businessProfileStore.ts** — Add `import { toast } from 'sonner';` at the top. Then add `toast.error()` to these 4 methods' error paths:

1. `createProfile` — on error: `toast.error("Couldn't create business profile. Please try again.")`
2. `updateProfile` — on error: `toast.error("Couldn't update business profile. Please try again.")`
3. `deleteProfile` — on error: `toast.error("Couldn't delete business profile. Please try again.")`
4. `setAsDefault` — on error: `toast.error("Couldn't set default profile. Please try again.")`

**Same rules as Task 1:**
- Add after optimistic rollback
- Do NOT change return values
- Use `sonner` toast
  </action>
  <verify>
1. `grep -c "toast.error" src/stores/businessProfileStore.ts` returns 4
2. File compiles: `tsc --noEmit` passes
3. `import { toast } from 'sonner'` present in file
  </verify>
  <done>
- All 16 of 16 silent failure methods now show toast notifications
- STORE-01 requirement fully satisfied
- Zero regressions — no behavior changes beyond adding notifications
  </done>
</task>

</tasks>

<verification>
- `grep -rc "toast.error" src/stores/contentLibraryStore.ts src/stores/contentItemsStore.ts src/stores/businessProfileStore.ts` shows 7 + 5 + 4 = 16 total
- `tsc --noEmit` passes clean
- All three stores still export correctly and compile
- No changes to return values or rollback behavior
</verification>

<success_criteria>
- All 16 silent store failure methods show toast.error() notifications
- Error messages are user-friendly and actionable ("Couldn't X. Please try again.")
- Existing optimistic update + rollback pattern unchanged
- STORE-01 requirement complete
</success_criteria>

<output>
After completion, create `.planning/phases/02-chat-foundation/02-02-SUMMARY.md`
</output>
