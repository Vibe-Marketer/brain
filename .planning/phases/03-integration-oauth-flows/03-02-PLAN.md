---
phase: 03-integration-oauth-flows
plan: 02
type: execute
wave: 2
depends_on: ["03-01"]
files_modified: []
autonomous: false

user_setup:
  - service: zoom
    why: "Verify Zoom Marketplace app has correct redirect URI"
    dashboard_config:
      - task: "Confirm redirect URI includes /zoom"
        location: "Zoom Marketplace > Your App > OAuth > Redirect URL for OAuth"
        expected_value: "https://app.callvaultai.com/oauth/callback/zoom"

must_haves:
  truths:
    - "User clicks Connect Zoom and completes OAuth flow successfully"
    - "User clicks Connect Google and completes OAuth flow without infinite spinner"
    - "Connected integrations show Connected status with account details"
    - "Failed connection attempts show error message to user"
  artifacts: []
  key_links:
    - from: "Settings/Integrations page"
      to: "Zoom OAuth callback"
      via: "OAuth popup flow"
      pattern: "window.location redirect -> callback page -> API call"
    - from: "Settings/Integrations page"
      to: "Google OAuth callback"
      via: "OAuth popup flow"
      pattern: "window.location redirect -> callback page -> API call"
---

<objective>
Verify Zoom and Google OAuth flows work end-to-end after the redirect URI fix.

Purpose: Confirm that INT-01 (Zoom), INT-02 (Google), and INT-03 (error surfacing) are satisfied by testing actual OAuth flows with real provider interactions. This requires human verification since OAuth involves browser popups and external provider authentication.

Output: Verified OAuth flows for both integrations, documented in SUMMARY.
</objective>

<execution_context>
@~/.config/Claude/get-shit-done/workflows/execute-plan.md
@~/.config/Claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-integration-oauth-flows/03-RESEARCH.md
@.planning/phases/03-integration-oauth-flows/03-01-SUMMARY.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 1: Verify Zoom OAuth flow end-to-end</name>
  <what-built>
Plan 03-01 fixed the Zoom OAuth redirect URI mismatch. The callback now uses `https://app.callvaultai.com/oauth/callback/zoom` to match the URL generator.

PREREQUISITE: Verify Zoom Marketplace app has the correct redirect URI configured:
- Location: Zoom Marketplace > Your App > OAuth > Redirect URL for OAuth
- Expected: `https://app.callvaultai.com/oauth/callback/zoom`
  </what-built>
  <how-to-verify>
1. Go to https://app.callvaultai.com/settings?tab=integrations (or your local dev URL)
2. Click "Connect Zoom" button
3. Complete Zoom OAuth authorization in the popup
4. Observe result:
   - SUCCESS: Popup closes, integration shows "Connected" with your Zoom account info
   - FAILURE: Error message appears (note the exact error text)

Expected outcomes:
- No "non-200 error" or "redirect_uri_mismatch" 
- Toast shows success message OR clear error message (not silent failure)
- If successful: Last synced time and account email visible
  </how-to-verify>
  <resume-signal>
Type one of:
- "zoom-verified" - Zoom OAuth works correctly
- "zoom-failed: [error message]" - Describe what went wrong
- "zoom-skipped: [reason]" - If unable to test (e.g., no Zoom account)
  </resume-signal>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Verify Google OAuth flow and Beta badge</name>
  <what-built>
1. Google OAuth implementation (no code changes needed - research indicated it should work). This test confirms INT-02 and validates the existing implementation.

2. Google Meet is now labeled as "Google Meet (Beta)" to set appropriate user expectations since it requires paid Google Workspace for full functionality.

Note: Google Meet integration may show limitations with free Google accounts (refresh token only returned with paid Google Workspace).
  </what-built>
  <how-to-verify>
**First: Verify Beta badge displays**
1. Go to https://app.callvaultai.com/settings?tab=integrations (or your local dev URL)
2. Confirm Google Meet shows as "Google Meet (Beta)" in:
   - The integration status row (if already connected)
   - The "Add Integration" dropdown/button
   - The connection wizard when clicking to connect

**Then: Test OAuth flow**
1. Click "Connect Google" button (should show "Google Meet (Beta)")
2. Complete Google OAuth authorization in the popup
3. Observe result:
   - SUCCESS: Popup closes within 30 seconds, integration shows "Connected"
   - TIMEOUT: Spinner continues > 30 seconds (note if timeout toast appears)
   - FAILURE: Error message appears (note the exact error text)

Expected outcomes:
- No infinite spinner (timeout should trigger within 30 seconds)
- Toast shows success message OR clear error message (not silent failure)
- If successful: Account info visible
  </how-to-verify>
  <resume-signal>
Type one of:
- "google-verified" - Google OAuth works correctly  
- "google-timeout" - Spinner exceeded 30s (note if toast appeared)
- "google-failed: [error message]" - Describe what went wrong
- "google-skipped: [reason]" - If unable to test (e.g., no Google account)
  </resume-signal>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Verify error handling (INT-03)</name>
  <what-built>
Error handling paths exist in both OAuth flows. This test confirms that connection errors surface to the user (no silent failures).
  </what-built>
  <how-to-verify>
Test at least ONE of these error scenarios:

Option A - Cancel OAuth flow:
1. Click "Connect Zoom" or "Connect Google"
2. In the popup, click "Cancel" or close the popup before completing auth
3. Expected: Error toast appears or status shows disconnected (not stuck in "Connecting...")

Option B - Network error simulation (if dev tools available):
1. Open browser DevTools > Network tab
2. Enable "Offline" mode
3. Click "Connect Zoom" or "Connect Google"
4. Expected: Error message appears within reasonable time

Option C - Observe any real error from Tasks 1/2:
If you saw an error in Task 1 or 2, note whether it displayed to the user.
  </how-to-verify>
  <resume-signal>
Type one of:
- "errors-verified: [describe test]" - Error handling works (errors surface to user)
- "errors-failed: [describe issue]" - Silent failures observed
- "errors-untested" - Unable to trigger error scenario
  </resume-signal>
</task>

</tasks>

<verification>
Based on human verification results:
- [ ] INT-01: Zoom OAuth works (zoom-verified)
- [ ] INT-02: Google OAuth works without infinite spinner (google-verified)
- [ ] INT-03: Errors surface to user (errors-verified)
</verification>

<success_criteria>
All three requirements verified:
1. Zoom OAuth connects successfully (or clear error if Marketplace not configured)
2. Google OAuth connects OR times out with user feedback (no infinite spinner)
3. Connection errors show user-facing messages (no silent failures)
</success_criteria>

<output>
After completion, create `.planning/phases/03-integration-oauth-flows/03-02-SUMMARY.md` documenting:
- Test results for each OAuth flow
- Any issues discovered and their status
- Requirements verification status (INT-01, INT-02, INT-03)
</output>
