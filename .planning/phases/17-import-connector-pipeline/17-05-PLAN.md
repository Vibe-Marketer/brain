---
phase: 17-import-connector-pipeline
plan: 05
type: execute
wave: 3
depends_on: ["17-02", "17-03", "17-04"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "User can navigate to Import Hub and see all connected sources with status and call counts"
    - "A file uploaded via the dropzone is transcribed and appears in the recordings list"
    - "All existing connectors write to recordings table — no fathom_calls inserts"
    - "File upload connector is ≤230 lines total (edge function + frontend component + registry)"
    - "Dedup prevents duplicate imports across all connectors"
  artifacts: []
  key_links: []
---

<objective>
Verify the complete import connector pipeline: UI, connectors, file upload, and dedup.

Purpose: Phase 17 success criteria require: (1) Import Hub shows connected sources, (2) new connector ≤230 lines, (3) all connectors use shared pipeline. This plan verifies all three by deploying edge functions, running the frontend, and counting lines.

Output: Verified phase completion or identified gaps for closure.
</objective>

<execution_context>
@/Users/Naegele/.claude/get-shit-done/workflows/execute-plan.md
@/Users/Naegele/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/17-import-connector-pipeline/17-01-SUMMARY.md
@.planning/phases/17-import-connector-pipeline/17-02-SUMMARY.md
@.planning/phases/17-import-connector-pipeline/17-03-SUMMARY.md
@.planning/phases/17-import-connector-pipeline/17-04-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Deploy all modified edge functions and verify builds</name>
  <files></files>
  <action>
Deploy all modified and new edge functions to production:

```bash
cd /Users/Naegele/dev/brain
npx supabase functions deploy youtube-import --project-ref vltmrnjsubfzrgrtdqey
npx supabase functions deploy zoom-sync-meetings --project-ref vltmrnjsubfzrgrtdqey
npx supabase functions deploy sync-meetings --project-ref vltmrnjsubfzrgrtdqey
npx supabase functions deploy fetch-meetings --project-ref vltmrnjsubfzrgrtdqey
npx supabase functions deploy file-upload-transcribe --project-ref vltmrnjsubfzrgrtdqey
```

Verify callvault frontend builds:
```bash
cd /Users/Naegele/dev/callvault && pnpm build
```

Verify IMP-02 line count — total lines across all file upload connector files:
```bash
echo "=== IMP-02 Line Count ==="
echo "Edge function:"
wc -l /Users/Naegele/dev/brain/supabase/functions/file-upload-transcribe/index.ts
echo "Frontend component:"
wc -l /Users/Naegele/dev/callvault/src/components/import/FileUploadDropzone.tsx
echo "Source card (shared, not counted):"
wc -l /Users/Naegele/dev/callvault/src/components/import/SourceCard.tsx
echo "=== Total connector-specific lines (edge function + dropzone) ==="
cat /Users/Naegele/dev/brain/supabase/functions/file-upload-transcribe/index.ts /Users/Naegele/dev/callvault/src/components/import/FileUploadDropzone.tsx | wc -l
```

The IMP-02 budget is ≤230 lines for the connector-specific code. The SourceCard is shared across all connectors (not counted). The pipeline utility is shared infrastructure (not counted). Only the edge function adapter + the connector-specific frontend component count.

Verify no fathom_calls inserts remain in any connector:
```bash
grep -r "\.from('fathom_calls').insert" /Users/Naegele/dev/brain/supabase/functions/youtube-import/ /Users/Naegele/dev/brain/supabase/functions/zoom-sync-meetings/ /Users/Naegele/dev/brain/supabase/functions/sync-meetings/ /Users/Naegele/dev/brain/supabase/functions/fetch-meetings/ || echo "PASS: No fathom_calls inserts found"
```

Verify all connectors import from connector-pipeline:
```bash
grep -l "connector-pipeline" /Users/Naegele/dev/brain/supabase/functions/youtube-import/index.ts /Users/Naegele/dev/brain/supabase/functions/zoom-sync-meetings/index.ts /Users/Naegele/dev/brain/supabase/functions/file-upload-transcribe/index.ts
```
  </action>
  <verify>
- All 5 edge functions deploy successfully (or deployment steps documented for user)
- `pnpm build` passes in callvault/ repo
- IMP-02: total connector-specific lines ≤ 230
- Zero `fathom_calls` inserts in any connector
- All connector edge functions import from connector-pipeline
  </verify>
  <done>
All edge functions deployed, frontend builds, IMP-02 line count verified ≤230, no fathom_calls inserts, all connectors use shared pipeline
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Human verification of Import Hub</name>
  <files></files>
  <action>
Human verifies the complete Import Connector Pipeline end-to-end:
- Shared connector pipeline utility (_shared/connector-pipeline.ts)
- import_sources table with RLS
- YouTube, Zoom, Fathom connectors rewired to use pipeline
- File upload connector with Whisper transcription
- Import Hub UI with source cards, toggles, and file upload dropzone

Verification steps:
1. Navigate to http://localhost:3000/import (run `pnpm dev` in callvault/ first)
2. Verify 4 source cards are visible: Fathom, Zoom, YouTube, File Upload
3. Each card should show: source name, icon, status badge, call count
4. Toggle the active/inactive switch on any source — it should persist after page refresh
5. Drag a small MP3 or WAV file onto the file upload dropzone
6. Verify: file is accepted, transcription starts, and after a few seconds a new recording appears
7. Navigate to the calls list (/) and verify the new recording from file upload appears
8. Try uploading the same file again — should show "already imported" message (dedup working)
9. Try uploading a file >25MB — should show error message about size limit
  </action>
  <verify>User confirms all 9 verification steps pass</verify>
  <done>User types "approved" or describes issues for gap closure</done>
</task>

</tasks>

<verification>
Phase 17 success criteria verification:

1. **SC-1:** "User can navigate to Import Hub and see all connected sources with connection status, last sync time, and active/inactive toggle" — verified by Task 2 steps 2-4
2. **SC-2:** "Developer can add a new import source by writing ≤230 lines" — verified by Task 1 line count
3. **SC-3:** "Import triggered from any connector writes to recordings table via shared pipeline" — verified by Task 1 grep check (no fathom_calls inserts, all import from connector-pipeline)
</verification>

<success_criteria>
1. All success criteria from the phase goal are verified
2. Human spot-check confirms the Import Hub renders correctly with source cards
3. File upload transcription works end-to-end (upload → Whisper → recording in list)
4. IMP-02 line count is documented as ≤230
</success_criteria>

<output>
After completion, create `.planning/phases/17-import-connector-pipeline/17-05-SUMMARY.md`
</output>
