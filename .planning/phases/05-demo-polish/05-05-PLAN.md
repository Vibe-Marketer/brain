---
phase: 05-demo-polish
plan: 05
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/transcript-library/BulkActionToolbarEnhanced.tsx
  - src/components/transcripts/TranscriptsTab.tsx
  - src/stores/panelStore.ts
autonomous: true

must_haves:
  truths:
    - "Bulk action toolbar appears as right-side slide-in pane"
    - "Toolbar no longer uses bottom Mac-style bar position"
    - "Selection actions work from 4th pane location"
  artifacts:
    - path: "src/components/transcript-library/BulkActionToolbarEnhanced.tsx"
      provides: "4th pane bulk actions UI"
      contains: "DetailPane"
    - path: "src/stores/panelStore.ts"
      provides: "Panel type for bulk actions"
      contains: "bulk-actions"
  key_links:
    - from: "src/components/transcript-library/BulkActionToolbarEnhanced.tsx"
      to: "src/stores/panelStore.ts"
      via: "Panel store integration"
      pattern: "usePanelStore"
---

<objective>
Refactor BulkActionToolbar from bottom Mac-style bar to right-side 4th pane

Purpose: Current toolbar uses `createPortal` to position at bottom of screen. Per FIX-06, it should follow the 4th pane pattern like other detail panels for UI consistency.
Output: Bulk actions appear in slide-in right pane when items selected
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-demo-polish/05-RESEARCH.md

@src/components/transcript-library/BulkActionToolbarEnhanced.tsx
@src/components/transcripts/TranscriptsTab.tsx
@src/components/layout/DetailPaneOutlet.tsx
@src/stores/panelStore.ts
@src/components/layout/AppShell.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add bulk-actions panel type to store</name>
  <files>src/stores/panelStore.ts</files>
  <action>
Add 'bulk-actions' to the PanelType union:

```typescript
export type PanelType =
  | 'folder-detail'
  | 'tag-detail'
  | 'setting-help'
  | 'call-detail'
  | 'bulk-actions'  // ADD THIS
  | null;
```

The panelData for bulk-actions will contain:
```typescript
interface BulkActionsPanelData {
  selectedCalls: Meeting[];
  selectedCount: number;
  tags: Array<{ id: string; name: string }>;
  onClearSelection: () => void;
  onDelete: () => void;
  onTag?: (tagId: string) => void;
  onRemoveTag?: () => void;
  onCreateNewTag?: () => void;
  onAssignFolder?: () => void;
}
```
  </action>
  <verify>
    - `grep -n "bulk-actions" src/stores/panelStore.ts` shows the type
    - `npm run build` succeeds
  </verify>
  <done>
    Panel store supports bulk-actions panel type
  </done>
</task>

<task type="auto">
  <name>Task 2: Create BulkActionsPane component</name>
  <files>src/components/transcript-library/BulkActionToolbarEnhanced.tsx</files>
  <action>
Refactor BulkActionToolbarEnhanced to render as a pane instead of portal:

**1. Remove createPortal usage entirely**

**2. Change the component to render inline with 4th pane styling:**

```typescript
import { cn } from "@/lib/utils";
import { usePanelStore } from "@/stores/panelStore";

export function BulkActionsPane({
  selectedCount,
  selectedCalls,
  tags,
  onClearSelection,
  onDelete,
  onTag,
  onRemoveTag,
  onCreateNewTag,
  onAssignFolder,
}: BulkActionToolbarEnhancedProps) {
  // ... existing state and handlers ...

  if (selectedCount === 0) return null;

  return (
    <div className={cn(
      // 4th pane styling (matches DetailPaneOutlet)
      "w-[360px] h-full bg-card border-l border-border",
      "flex flex-col",
      "animate-in slide-in-from-right duration-500"
    )}>
      {/* Header */}
      <div className="flex items-center justify-between p-4 border-b border-border">
        <div className="flex items-center gap-2">
          <Badge variant="secondary">{selectedCount}</Badge>
          <span className="text-sm font-medium">
            {selectedCount === 1 ? "transcript" : "transcripts"} selected
          </span>
        </div>
        <Button
          variant="ghost"
          size="icon"
          onClick={onClearSelection}
          className="h-8 w-8"
        >
          <RiCloseLine className="h-4 w-4" />
        </Button>
      </div>

      {/* Actions - vertical layout for pane */}
      <div className="flex-1 overflow-y-auto p-4 space-y-2">
        <h3 className="text-sm font-semibold text-muted-foreground mb-3">
          ACTIONS
        </h3>
        
        {/* Tag actions */}
        <ActionSection title="Tags">
          <TagDropdown ... />
          <Button variant="outline" onClick={() => setShowManualTagDialog(true)}>
            <RiPriceTag3Line className="h-4 w-4 mr-2" />
            Manage Tags
          </Button>
        </ActionSection>

        {/* Export actions */}
        <ActionSection title="Export">
          <ExportDropdown ... />
        </ActionSection>

        {/* AI actions */}
        <ActionSection title="AI">
          <Button variant="outline" onClick={handleGenerateAITitles}>
            <RiMagicLine className="h-4 w-4 mr-2" />
            Generate Titles
          </Button>
          <Button variant="outline" onClick={handleAutoTagCalls}>
            <RiPriceTag3Line className="h-4 w-4 mr-2" />
            Auto-Tag
          </Button>
        </ActionSection>

        {/* Other actions */}
        <ActionSection title="Other">
          <Button variant="outline" onClick={handleChat}>
            <RiChatQuoteLine className="h-4 w-4 mr-2" />
            Chat with Selected
          </Button>
          <Button variant="outline" onClick={onAssignFolder}>
            <RiFolderLine className="h-4 w-4 mr-2" />
            Assign Folder
          </Button>
        </ActionSection>
      </div>

      {/* Footer - destructive action */}
      <div className="p-4 border-t border-border">
        <Button 
          variant="destructive" 
          className="w-full"
          onClick={onDelete}
        >
          <RiDeleteBin6Line className="h-4 w-4 mr-2" />
          Delete Selected
        </Button>
      </div>

      {/* Dialogs */}
      <SmartExportDialog ... />
      <ManualTagDialog ... />
    </div>
  );
}

// Helper component for grouped actions
function ActionSection({ title, children }: { title: string; children: React.ReactNode }) {
  return (
    <div className="space-y-2">
      <h4 className="text-xs font-medium text-muted-foreground uppercase tracking-wider">
        {title}
      </h4>
      <div className="flex flex-col gap-1">
        {children}
      </div>
    </div>
  );
}
```

**3. Ensure buttons use full width in vertical layout:**
```typescript
<Button variant="outline" className="w-full justify-start">
  <Icon className="h-4 w-4 mr-2" />
  Label
</Button>
```
  </action>
  <verify>
    - `grep -n "createPortal" src/components/transcript-library/BulkActionToolbarEnhanced.tsx` returns no matches
    - `grep -n "w-\\[360px\\]" src/components/transcript-library/BulkActionToolbarEnhanced.tsx` shows pane width
    - `npm run build` succeeds
  </verify>
  <done>
    BulkActionsPane renders as 4th pane, not bottom portal
  </done>
</task>

<task type="auto">
  <name>Task 3: Integrate with TranscriptsTab layout</name>
  <files>src/components/transcripts/TranscriptsTab.tsx</files>
  <action>
Update TranscriptsTab to show BulkActionsPane in the detail pane slot:

**Option A: Direct rendering in AppShell config**
```typescript
<AppShell
  config={{
    secondaryPane: <CategoryPane />,
    showDetailPane: selectedCount > 0,  // Show when items selected
    detailPane: selectedCount > 0 ? (
      <BulkActionsPane
        selectedCount={selectedCount}
        selectedCalls={selectedCalls}
        tags={tags}
        onClearSelection={handleClearSelection}
        onDelete={handleDelete}
        // ... other props
      />
    ) : null
  }}
>
  {/* Main content */}
</AppShell>
```

**Option B: Using panel store (preferred for consistency)**
```typescript
const { openPanel, closePanel, panelType, panelData } = usePanelStore();

// Effect to sync selection state with panel
useEffect(() => {
  if (selectedCount > 0) {
    openPanel('bulk-actions', {
      selectedCalls,
      selectedCount,
      tags,
      onClearSelection: handleClearSelection,
      // ...
    });
  } else if (panelType === 'bulk-actions') {
    closePanel();
  }
}, [selectedCount, selectedCalls]);

// In AppShell or DetailPaneOutlet, handle 'bulk-actions' panel type
```

Choose the approach that aligns with existing codebase patterns for detail panes.
  </action>
  <verify>
    - Select transcripts - bulk action pane slides in from right
    - Deselect all - pane closes
    - All actions work from new location
    - `npm run build` succeeds
  </verify>
  <done>
    Bulk actions integrated with TranscriptsTab 4th pane slot
  </done>
</task>

</tasks>

<verification>
1. Select transcripts on `/transcripts` - right pane slides in
2. All bulk actions (tag, export, delete, AI, chat) work from pane
3. Clear selection - pane slides out
4. No bottom bar visible (old pattern removed)
5. Console: No JavaScript errors
6. Build: `npm run build` completes without errors
</verification>

<success_criteria>
- FIX-06 addressed: Bulk action toolbar uses 4th pane pattern
- No createPortal to bottom of screen
- Actions organized vertically in pane
- Animations follow 500ms standard (per brand guidelines)
- Consistent with other detail panes in the app
</success_criteria>

<output>
After completion, create `.planning/phases/05-demo-polish/05-05-SUMMARY.md`
</output>
