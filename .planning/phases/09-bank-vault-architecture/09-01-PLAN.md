---
phase: 09-bank-vault-architecture
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - supabase/functions/send-coach-invite/
  - src/hooks/useCoachRelationships.ts
  - src/components/settings/CoachesTab.tsx
  - src/components/sharing/CoachInviteDialog.tsx
  - src/components/sharing/CoacheeInviteDialog.tsx
  - src/components/sharing/RelationshipCard.tsx
  - src/components/sharing/RelationshipList.tsx
  - src/types/sharing.ts
  - src/lib/query-config.ts
  - src/pages/CollaborationPage.tsx
  - src/components/billing/PlanCards.tsx
  - src/components/settings/BillingTab.tsx
  - src/App.tsx
autonomous: true

must_haves:
  truths:
    - "No coach-related code exists in the codebase"
    - "Application compiles without errors after removal"
    - "No orphaned imports or references to coach types"
  artifacts:
    - path: "supabase/functions/send-coach-invite/"
      provides: "DELETED - no longer exists"
    - path: "src/hooks/useCoachRelationships.ts"
      provides: "DELETED - no longer exists"
    - path: "src/components/settings/CoachesTab.tsx"
      provides: "DELETED - no longer exists"
  key_links:
    - from: "src/types/sharing.ts"
      to: "coach types"
      via: "removal"
      pattern: "no InvitedBy|CoachRelationship|CoachShare references"
    - from: "src/App.tsx"
      to: "/coach routes"
      via: "removal"
      pattern: "no /coach route definitions"
---

<objective>
Eliminate all coach-related code from the codebase. No production data exists for coach features, so this is a clean deletion without migration concerns.

Purpose: Clear legacy code that conflicts with the new Bank/Vault architecture. Coach functionality will be replaced by vault_type='coach' in the new model.
Output: Clean codebase with no coach references, ready for Bank/Vault implementation.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-bank-vault-architecture/09-CONTEXT.md
@.planning/phases/09-bank-vault-architecture/09-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Delete coach Edge Function and database tables</name>
  <files>
    supabase/functions/send-coach-invite/
    supabase/migrations/ (new migration to drop tables)
  </files>
  <action>
1. Delete the entire `supabase/functions/send-coach-invite/` directory (282 lines)

2. Create a new migration file `supabase/migrations/20260131000001_drop_coach_tables.sql`:
```sql
-- Drop coach-related tables (no production data exists)
DROP TABLE IF EXISTS coach_notes CASCADE;
DROP TABLE IF EXISTS coach_shares CASCADE;
DROP TABLE IF EXISTS coach_relationships CASCADE;
```

3. Run `supabase db push` to apply the migration locally

Note: These tables have no production data per CONTEXT.md, so CASCADE is safe.
  </action>
  <verify>
- `ls supabase/functions/send-coach-invite/` returns "No such file or directory"
- `supabase db push` succeeds
- Query `SELECT tablename FROM pg_tables WHERE tablename LIKE 'coach%'` returns empty
  </verify>
  <done>
- send-coach-invite Edge Function deleted
- coach_relationships, coach_shares, coach_notes tables dropped
- Migration file committed
  </done>
</task>

<task type="auto">
  <name>Task 2: Delete coach frontend files and clean up imports</name>
  <files>
    src/hooks/useCoachRelationships.ts
    src/components/settings/CoachesTab.tsx
    src/components/sharing/CoachInviteDialog.tsx
    src/components/sharing/CoacheeInviteDialog.tsx
    src/components/sharing/RelationshipCard.tsx
    src/components/sharing/RelationshipList.tsx
    src/types/sharing.ts
    src/lib/query-config.ts
    src/pages/CollaborationPage.tsx
    src/components/billing/PlanCards.tsx
    src/components/settings/BillingTab.tsx
    src/App.tsx
  </files>
  <action>
1. DELETE these files entirely:
   - `src/hooks/useCoachRelationships.ts` (~928 lines)
   - `src/components/settings/CoachesTab.tsx` (~400 lines)
   - `src/components/sharing/CoachInviteDialog.tsx` (~350 lines)
   - `src/components/sharing/CoacheeInviteDialog.tsx` (~350 lines)
   - `src/components/sharing/RelationshipCard.tsx` (~200 lines)
   - `src/components/sharing/RelationshipList.tsx` (~150 lines)

2. MODIFY `src/types/sharing.ts` - Remove these types:
   - `InvitedBy` (coach | coachee enum)
   - `CoachRelationship`
   - `CoachRelationshipWithUsers`
   - `CoachShare`
   - `CoachShareWithDetails`
   - `CoachNote`
   - `ConfigureCoachSharingInput`

3. MODIFY `src/lib/query-config.ts` - Remove coach-related query keys

4. MODIFY `src/pages/CollaborationPage.tsx` - Remove coaches route/tab references

5. MODIFY `src/components/billing/PlanCards.tsx` - Remove coach feature mentions in plan descriptions

6. MODIFY `src/components/settings/BillingTab.tsx` - Remove coach feature mentions

7. MODIFY `src/App.tsx` - Remove /coach routes and any coach-related imports

8. Search for any remaining coach references:
   - `grep -r "coach" --include="*.ts" --include="*.tsx" src/`
   - Clean up any orphaned imports
  </action>
  <verify>
- `npm run build` succeeds without errors
- `npm run typecheck` passes (if available)
- `grep -r "useCoachRelationships\|CoachesTab\|CoachInvite" src/` returns empty
- `grep -ri "coach" --include="*.ts" --include="*.tsx" src/ | grep -v "//" | wc -l` returns 0 or only false positives in comments
  </verify>
  <done>
- All 6 coach component files deleted
- sharing.ts cleaned of coach types
- query-config.ts cleaned
- CollaborationPage.tsx cleaned
- PlanCards.tsx and BillingTab.tsx cleaned
- App.tsx routes cleaned
- Application compiles successfully
  </done>
</task>

</tasks>

<verification>
1. `npm run build` completes without errors
2. `supabase db push` succeeds
3. No coach-related files exist in src/
4. No coach-related Edge Functions exist
5. Database has no coach_ prefixed tables
</verification>

<success_criteria>
- Zero coach-related code in frontend (hooks, components, types)
- Zero coach-related Edge Functions
- Zero coach database tables
- Application builds and runs successfully
- No TypeScript errors from orphaned imports
</success_criteria>

<output>
After completion, create `.planning/phases/09-bank-vault-architecture/09-01-SUMMARY.md`
</output>
