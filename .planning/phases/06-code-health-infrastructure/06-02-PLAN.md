---
phase: 06-code-health-infrastructure
plan: 02
type: tdd
wave: 2
depends_on: ["06-01"]
files_modified:
  - src/hooks/__tests__/useChatStreaming.test.ts
  - src/hooks/__tests__/useChatFilters.test.ts
  - src/components/chat/__tests__/ChatMessageList.test.tsx
  - src/components/chat/__tests__/ChatInputArea.test.tsx
autonomous: true

must_haves:
  truths:
    - "Extracted hooks have comprehensive test coverage"
    - "Extracted components have comprehensive test coverage"
    - "Tests run and pass"
  artifacts:
    - path: "src/hooks/__tests__/useChatStreaming.test.ts"
      provides: "Streaming hook tests"
      min_lines: 50
    - path: "src/hooks/__tests__/useChatFilters.test.ts"
      provides: "Filter hook tests"
      min_lines: 50
  key_links:
    - from: "src/hooks/__tests__/useChatStreaming.test.ts"
      to: "src/hooks/useChatStreaming.ts"
      via: "import under test"
      pattern: "import.*useChatStreaming"
---

<objective>
Write comprehensive tests for Chat.tsx extracted hooks and components

Purpose: Ensure extracted code is testable in isolation per CONTEXT.md requirement for "comprehensive tests"
Output: Full test coverage for useChatStreaming, useChatFilters, ChatMessageList, ChatInputArea
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-code-health-infrastructure/06-01-SUMMARY.md
</context>

<feature>
  <name>Chat Refactor Tests</name>
  <files>
    src/hooks/__tests__/useChatStreaming.test.ts
    src/hooks/__tests__/useChatFilters.test.ts
    src/components/chat/__tests__/ChatMessageList.test.tsx
    src/components/chat/__tests__/ChatInputArea.test.tsx
  </files>
  <behavior>
    useChatStreaming:
    - Initial state should have isStreaming=false, connectionState='disconnected'
    - throttledErrorLog should rate-limit error logs
    - isRateLimitError should detect 429 and "rate limit" in messages
    - isStreamingInterruptionError should detect network errors

    useChatFilters:
    - Initial state should have empty filters
    - setDateRange should update dateRange state
    - setParticipants should update selected participants
    - buildFiltersObject should combine all filters into request format

    ChatMessageList:
    - Should render user messages with UserMessage component
    - Should render assistant messages with AssistantMessage component
    - Should render tool calls with ToolCalls component
    - Should handle empty message list

    ChatInputArea:
    - Should render PromptInput with context bar
    - Should show filter badges when filters active
    - Should call onSubmit when form submitted
    - Should handle mention insertion
  </behavior>
  <implementation>
    Use Vitest + React Testing Library (project's testing stack)
    Mock external dependencies (supabase, api calls)
    Use renderHook for hook tests
    Test edge cases and error states
  </implementation>
</feature>

<verification>
1. `npm run test -- src/hooks/__tests__/useChatStreaming.test.ts` passes
2. `npm run test -- src/hooks/__tests__/useChatFilters.test.ts` passes
3. `npm run test -- src/components/chat/__tests__/ChatMessageList.test.tsx` passes
4. `npm run test -- src/components/chat/__tests__/ChatInputArea.test.tsx` passes
</verification>

<success_criteria>
- All 4 test files created with meaningful test cases
- Tests cover happy path and edge cases
- Tests pass without flakiness
- Hooks are tested with renderHook
- Components are tested with React Testing Library
</success_criteria>

<output>
After completion, create `.planning/phases/06-code-health-infrastructure/06-02-SUMMARY.md`
</output>
