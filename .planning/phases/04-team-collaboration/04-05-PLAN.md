---
phase: 04-team-collaboration
plan: 05
type: execute
wave: 3
depends_on: ["04-02"]
files_modified:
  - supabase/migrations/20260129000002_add_onboarding_complete.sql
  - src/pages/TeamManagement.tsx
autonomous: true

must_haves:
  truths:
    - "Admins can see 'pending setup' status badge on members who haven't completed onboarding"
    - "New members who haven't completed onboarding are tracked"
  artifacts:
    - path: "supabase/migrations/20260129000002_add_onboarding_complete.sql"
      provides: "Database column for onboarding status"
      contains: "onboarding_complete"
    - path: "src/pages/TeamManagement.tsx"
      provides: "Pending setup badge in member list"
      contains: "Pending setup"
  key_links:
    - from: "src/pages/TeamManagement.tsx"
      to: "team_memberships.onboarding_complete"
      via: "Query select"
      pattern: "onboarding_complete"
---

<objective>
Add pending setup tracking for team members who haven't completed onboarding

Purpose: CONTEXT.md specifies "User added to team but marked as 'pending setup'" and "Admins can see 'pending setup' status badge on members who haven't completed onboarding".
Output: Database column for tracking + UI badge in admin member list
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-team-collaboration/04-CONTEXT.md
@.planning/phases/04-team-collaboration/04-RESEARCH.md

@src/pages/TeamManagement.tsx
@src/hooks/useTeamHierarchy.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create migration for onboarding_complete column</name>
  <files>supabase/migrations/20260129000002_add_onboarding_complete.sql</files>
  <action>
Create migration to add onboarding_complete column to team_memberships:

```sql
-- Migration: Add onboarding_complete to team_memberships
-- Tracks whether a team member has completed the onboarding flow
-- Per CONTEXT.md: "User added to team but marked as 'pending setup'"

ALTER TABLE team_memberships 
ADD COLUMN IF NOT EXISTS onboarding_complete BOOLEAN DEFAULT false;

-- Add index for quick filtering of pending members
CREATE INDEX IF NOT EXISTS idx_team_memberships_onboarding_incomplete
ON team_memberships(team_id, onboarding_complete)
WHERE onboarding_complete = false AND status = 'active';

-- Comment for documentation
COMMENT ON COLUMN team_memberships.onboarding_complete IS 
'Whether member has completed onboarding. Admins see "Pending setup" badge for incomplete members.';
```

Note: Default is false because most join flows will set this to true upon completing onboarding. New invites start as false until the user completes their setup.
  </action>
  <verify>
    - Migration file exists at supabase/migrations/20260129000002_add_onboarding_complete.sql
    - SQL syntax is valid
  </verify>
  <done>
    Database schema supports tracking onboarding completion per team member
  </done>
</task>

<task type="auto">
  <name>Task 2: Add pending setup badge to member list</name>
  <files>src/pages/TeamManagement.tsx</files>
  <action>
Update TeamManagement.tsx to show "Pending setup" badge for members who haven't completed onboarding:

**1. Update the member query to include onboarding_complete:**

In the useTeamMembers hook (or wherever members are fetched), ensure onboarding_complete is included in the select. If using the existing hook from useTeamHierarchy.ts, the TeamMembershipWithUser type may need updating, or just cast/access the field.

**2. Add badge in member list rendering:**

Find where team members are rendered (likely in a table or list). Add a badge next to members where `onboarding_complete === false`:

```tsx
// In the member row/card, after the role badge or name:
{!member.onboarding_complete && (
  <span className="inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium bg-amber-100 text-amber-800 dark:bg-amber-900/30 dark:text-amber-400">
    <RiTimeLine className="h-3 w-3" />
    Pending setup
  </span>
)}
```

**3. Import the icon if needed:**
```tsx
import { RiTimeLine } from '@remixicon/react';
```

**4. Update TeamMembershipWithUser type (in src/types/sharing.ts) if needed:**

If the type doesn't include onboarding_complete, add it:
```typescript
export interface TeamMembershipWithUser extends TeamMembership {
  user_email?: string | null;
  user_name?: string | null;
  onboarding_complete?: boolean;
}
```

The badge should only be visible to admins (check if current user is admin before showing), but since the member list itself is only visible to admins per CONTEXT.md ("Only admins can see the team member list"), the badge can simply be rendered when the condition is met.
  </action>
  <verify>
    - `npm run build` succeeds
    - `grep -n "Pending setup" src/pages/TeamManagement.tsx` shows the badge
    - Badge uses amber/warning colors (consistent with status badges)
  </verify>
  <done>
    Admins can see "Pending setup" badge on members who haven't completed onboarding
  </done>
</task>

</tasks>

<verification>
1. Database: onboarding_complete column exists on team_memberships
2. UI: Members with onboarding_complete=false show "Pending setup" badge
3. Styling: Badge is clearly visible with amber/warning styling
4. Build passes: `npm run build` completes without errors
</verification>

<success_criteria>
- CONTEXT.md decision honored: "User added to team but marked as 'pending setup'"
- CONTEXT.md decision honored: "Admins can see 'pending setup' status badge"
- Badge styling is consistent with other status indicators
- No TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/04-team-collaboration/04-05-SUMMARY.md`
</output>
