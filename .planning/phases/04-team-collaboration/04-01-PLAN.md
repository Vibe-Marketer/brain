---
phase: 04-team-collaboration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/App.tsx
  - src/hooks/useTeamHierarchy.ts
autonomous: true

must_haves:
  truths:
    - "Team join page accessible at /join/team/:token"
    - "Invite links use /join/team/ pattern (not /team/join/)"
    - "Invite tokens expire after 7 days"
  artifacts:
    - path: "src/App.tsx"
      provides: "TeamJoin route registration"
      contains: "/join/team/:token"
    - path: "src/hooks/useTeamHierarchy.ts"
      provides: "Correct invite URL and 7-day expiry"
      contains: "/join/team/"
  key_links:
    - from: "src/App.tsx"
      to: "src/pages/TeamJoin.tsx"
      via: "Route element"
      pattern: 'path="/join/team/:token"'
    - from: "src/hooks/useTeamHierarchy.ts"
      to: "/join/team/:token"
      via: "URL generation"
      pattern: "/join/team/"
---

<objective>
Fix team invite link routing so users can access the join page via `/join/team/:token`

Purpose: Currently TeamJoin.tsx exists but isn't routed - invite links 404. URL pattern and expiry also need fixing per CONTEXT.md decisions.
Output: Working team invite flow with correct routing, URL pattern, and 7-day expiration
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-team-collaboration/04-CONTEXT.md
@.planning/phases/04-team-collaboration/04-RESEARCH.md

@src/App.tsx
@src/pages/TeamJoin.tsx
@src/hooks/useTeamHierarchy.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Register TeamJoin route in App.tsx</name>
  <files>src/App.tsx</files>
  <action>
Add the TeamJoin route to App.tsx:

1. Add import at top with other page imports:
   `import TeamJoin from '@/pages/TeamJoin';`

2. Add route BEFORE the 404 catch-all route (`<Route path="*"`):
   ```tsx
   {/* Team join page - public-ish route (redirects to login if not authenticated) */}
   <Route path="/join/team/:token" element={<TeamJoin />} />
   ```

Note: TeamJoin handles its own authentication redirect internally (stores token in sessionStorage, redirects to /login, then resumes), so it should NOT be wrapped in ProtectedRoute. This matches the pattern established by SharedCallView which is also a token-based public route.

Place this route after the SharedCallView route (`/s/:token`) and before the 404 catch-all.
  </action>
  <verify>
    - `grep -n "join/team" src/App.tsx` shows the route
    - `grep -n "TeamJoin" src/App.tsx` shows the import
    - `npm run build` succeeds with no TypeScript errors
  </verify>
  <done>
    Route `/join/team/:token` is registered and TeamJoin component will render when visiting that URL
  </done>
</task>

<task type="auto">
  <name>Task 2: Fix invite URL pattern and expiry in useTeamHierarchy</name>
  <files>src/hooks/useTeamHierarchy.ts</files>
  <action>
Make two changes in useTeamHierarchy.ts:

**1. Fix invite URL pattern (around line 364):**
Change from:
```typescript
const inviteUrl = `${window.location.origin}/team/join/${inviteToken}`;
```
To:
```typescript
const inviteUrl = `${window.location.origin}/join/team/${inviteToken}`;
```

This aligns with CONTEXT.md: "Join pages are accessible at `/join/team/:token`"

**2. Fix invite expiration (around line 146-149) - change from 30 to 7 days:**
Change from:
```typescript
function getInviteExpiration(): string {
  const date = new Date();
  date.setDate(date.getDate() + 30);
  return date.toISOString();
}
```
To:
```typescript
function getInviteExpiration(): string {
  const date = new Date();
  date.setDate(date.getDate() + 7);
  return date.toISOString();
}
```

This aligns with CONTEXT.md: "Invite links expire after 7 days"
  </action>
  <verify>
    - `grep -n "/join/team/" src/hooks/useTeamHierarchy.ts` shows correct URL pattern
    - `grep -n "/team/join/" src/hooks/useTeamHierarchy.ts` returns no matches
    - `grep -n "date.getDate() + 7" src/hooks/useTeamHierarchy.ts` shows 7-day expiry
    - `npm run build` succeeds
  </verify>
  <done>
    Generated invite URLs use `/join/team/:token` pattern and expire after 7 days
  </done>
</task>

</tasks>

<verification>
1. Route registration: Visit `/join/team/test-token` in browser - should show TeamJoin page (with error about invalid token, which is expected)
2. URL pattern: Generate team invite via UI - URL should contain `/join/team/` not `/team/join/`
3. Expiry: Check getInviteExpiration() returns date 7 days in future
4. Build passes: `npm run build` completes without errors
</verification>

<success_criteria>
- TEAM-02 requirement met: Team join page accessible via route `/join/team/:token`
- Invite URL pattern matches route pattern
- Invite expiry is 7 days per CONTEXT.md
- No TypeScript errors
- No breaking changes to existing functionality
</success_criteria>

<output>
After completion, create `.planning/phases/04-team-collaboration/04-01-SUMMARY.md`
</output>
