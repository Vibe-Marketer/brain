---
phase: 19-mcp-audit-workspace-tokens
plan: 02
type: execute
wave: 2
depends_on: ["19-01"]
files_modified:
  - /Users/Naegele/Developer/mcp/callvault-mcp/src/operations.json
  - /Users/Naegele/Developer/mcp/callvault-mcp/src/handlers/navigation.ts
  - /Users/Naegele/Developer/mcp/callvault-mcp/src/handlers/index.ts
  - /Users/Naegele/Developer/mcp/callvault-mcp/src/prompts.ts
  - /Users/Naegele/Developer/mcp/callvault-mcp/src/worker.ts
autonomous: true

must_haves:
  truths:
    - "All MCP tools use Organization/Workspace/Folder naming -- zero Bank/Vault/Hub in user-facing text"
    - "Old operation keys list_banks and list_vaults are replaced by list_organizations and list_workspaces"
    - "Worker redeploys successfully and responds to requests with new naming"
    - "Existing data queries continue returning correct results (zero regression)"
  artifacts:
    - path: "/Users/Naegele/Developer/mcp/callvault-mcp/src/operations.json"
      provides: "Renamed operations catalog"
      contains: "list_organizations"
    - path: "/Users/Naegele/Developer/mcp/callvault-mcp/src/handlers/navigation.ts"
      provides: "Renamed handler functions"
      contains: "listOrganizations"
    - path: "/Users/Naegele/Developer/mcp/callvault-mcp/src/handlers/index.ts"
      provides: "Updated handler routing map"
      contains: "navigation.list_organizations"
    - path: "/Users/Naegele/Developer/mcp/callvault-mcp/src/prompts.ts"
      provides: "Updated prompt text with new naming"
      contains: "organization"
  key_links:
    - from: "/Users/Naegele/Developer/mcp/callvault-mcp/src/operations.json"
      to: "/Users/Naegele/Developer/mcp/callvault-mcp/src/handlers/index.ts"
      via: "operation key string matching"
      pattern: "navigation\\.list_organizations"
    - from: "/Users/Naegele/Developer/mcp/callvault-mcp/src/handlers/index.ts"
      to: "/Users/Naegele/Developer/mcp/callvault-mcp/src/handlers/navigation.ts"
      via: "function import and registration"
      pattern: "listOrganizations"
---

<objective>
Rename all Bank/Vault/Hub terminology in the MCP Worker to Organization/Workspace/Folder and redeploy. This is a clean break per user decision -- old operation names stop working.

Purpose: MCP-02 (preserve capabilities) and MCP-03 (update naming) require the Worker to use the new terminology. Phase 16 completed the rename in the frontend; the MCP Worker is the last holdout.

Output: Updated Worker source deployed to `callvault-mcp.naegele412.workers.dev` with Organization/Workspace/Folder naming throughout.
</objective>

<execution_context>
@/Users/Naegele/.claude/get-shit-done/workflows/execute-plan.md
@/Users/Naegele/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/19-mcp-audit-workspace-tokens/19-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rename operations, handlers, and prompts</name>
  <files>
    /Users/Naegele/Developer/mcp/callvault-mcp/src/operations.json
    /Users/Naegele/Developer/mcp/callvault-mcp/src/handlers/navigation.ts
    /Users/Naegele/Developer/mcp/callvault-mcp/src/handlers/index.ts
    /Users/Naegele/Developer/mcp/callvault-mcp/src/prompts.ts
    /Users/Naegele/Developer/mcp/callvault-mcp/src/worker.ts
    /Users/Naegele/Developer/mcp/callvault-mcp/src/types.ts
  </files>
  <action>
Use the naming migration inventory from the Plan 01 audit (`.planning/mcp-audit.md`) to make all renames. This is a clean break per user decision -- old Bank/Vault/Hub tool names stop working immediately.

**operations.json changes:**

1. Rename operation keys:
   - `navigation.list_banks` -> `navigation.list_organizations`
   - `navigation.list_vaults` -> `navigation.list_workspaces`

2. Update all operation descriptions:
   - "banks" -> "organizations"
   - "bank" -> "organization"
   - "vaults" -> "workspaces"
   - "vault" -> "workspace"
   - "hubs" -> "folders" (if any)
   - "hub" -> "folder" (if any)

3. Update parameter names in operations.json:
   - `bank_id` parameter -> `organization_id` (in list_vaults/list_workspaces operation)
   - Keep `vault_id` parameter name as-is in recordings operations (this is the DB column name, used internally)
   - Update parameter descriptions to use new terminology

4. Update the navigation category description: "Navigate workspace organization: banks, vaults, folders, and tags" -> "Navigate workspace hierarchy: organizations, workspaces, folders, and tags"

**handlers/navigation.ts changes:**

5. Rename handler functions:
   - `listBanks` -> `listOrganizations`
   - `listVaults` -> `listWorkspaces`
   - DO NOT change the actual Supabase queries -- they still query `bank_memberships`, `banks`, `vault_memberships`, `vaults` tables (these are the DB table names, not user-facing)

6. Update the parameter extraction in the renamed functions:
   - In `listOrganizations` (was `listBanks`): no param changes needed (it has no bank_id param)
   - In `listWorkspaces` (was `listVaults`): change param extraction from `bank_id` to `organization_id` (the operation param name changes, but the query still uses the extracted value against `bank_id` column in DB)

**handlers/index.ts changes:**

7. Update the HANDLERS record:
   - `"navigation.list_banks": listBanks` -> `"navigation.list_organizations": listOrganizations`
   - `"navigation.list_vaults": listVaults` -> `"navigation.list_workspaces": listWorkspaces`
   - Update imports to match renamed functions

**prompts.ts changes:**

8. Update all prompt templates:
   - Replace "bank" with "organization" in instruction text
   - Replace "vault" with "workspace" in instruction text
   - Replace "hub" with "folder" in instruction text
   - Update any operation references (e.g., "use list_banks" -> "use list_organizations")
   - Update parameter references in prompts (e.g., "bank_id" -> "organization_id")
   - Keep internal field names (`vault_id` in execute params) but update the surrounding text

**worker.ts changes:**

9. Update the McpServer metadata if it references old naming
10. Update any resource descriptions or URIs that reference old naming
11. Review tool descriptions for `callvault_discover`, `callvault_get_schema`, `callvault_execute` for old naming

**types.ts changes:**

12. Update any type comments or string literals that reference old naming

**CRITICAL: Do NOT change:**
- Supabase table names in queries (banks, vaults, bank_memberships, vault_memberships -- these are DB tables)
- The `vault_id` parameter name when used as a query filter in recordings handlers (this is the DB column name)
- The actual Supabase client calls or RLS patterns
  </action>
  <verify>
Run TypeScript type-check in the callvault-mcp directory:
```bash
cd /Users/Naegele/Developer/mcp/callvault-mcp && npx tsc --noEmit
```
Confirm zero errors. Then verify no old naming remains in user-facing strings:
```bash
grep -rn "list_banks\|list_vaults\|listBanks\|listVaults" /Users/Naegele/Developer/mcp/callvault-mcp/src/ --include="*.ts" --include="*.json"
```
Should return zero matches.
  </verify>
  <done>All user-facing Bank/Vault/Hub naming replaced with Organization/Workspace/Folder. TypeScript compiles clean. Old operation keys removed from handler routing.</done>
</task>

<task type="auto">
  <name>Task 2: Deploy renamed Worker and verify with curl</name>
  <files></files>
  <action>
Deploy the renamed Worker to Cloudflare and verify the new naming works correctly.

**Deploy:**
```bash
cd /Users/Naegele/Developer/mcp/callvault-mcp
unset CLOUDFLARE_API_TOKEN
wrangler deploy
```

Per Phase 12 Plan 05 established pattern: unset CLOUDFLARE_API_TOKEN to use OAuth token from `~/.wrangler/config/default.toml`.

**Verify with curl:**

1. Get a test JWT (same approach as Plan 01 Task 2):
```bash
curl -s -X POST "https://vltmrnjsubfzrgrtdqey.supabase.co/auth/v1/token?grant_type=password" \
  -H "apikey: <ANON_KEY>" \
  -H "Content-Type: application/json" \
  -d '{"email":"<EMAIL>","password":"<PASSWORD>"}'
```

2. Initialize MCP session:
```bash
curl -s -X POST https://callvault-mcp.naegele412.workers.dev/mcp \
  -H "Authorization: Bearer <TOKEN>" \
  -H "Content-Type: application/json" \
  -H "Accept: application/json" \
  -d '{"jsonrpc":"2.0","id":1,"method":"initialize","params":{"protocolVersion":"2025-03-26","capabilities":{},"clientInfo":{"name":"verify","version":"1.0"}}}'
```

3. Verify `callvault_discover` returns new operation names:
   - Should include `navigation.list_organizations` and `navigation.list_workspaces`
   - Should NOT include `navigation.list_banks` or `navigation.list_vaults`

4. Verify `callvault_execute` with new operation names:
   - Execute `navigation.list_organizations` -- should return data
   - Execute `navigation.list_workspaces` with `organization_id` param -- should return data

5. Verify old operation names are rejected:
   - Execute `navigation.list_banks` -- should return error "Unknown operation" or similar

6. Verify non-renamed operations still work (regression check - MCP-02):
   - Execute `recordings.list` with a vault_id -- should return recordings
   - Execute `contacts.list` -- should return contacts

Document all curl commands and responses in the commit message or summary.
  </action>
  <verify>
The following curl commands all return successful responses:
- `callvault_discover` returns categories with new operation names
- `callvault_execute` with `navigation.list_organizations` returns data
- `callvault_execute` with `recordings.list` returns data (regression check)
And this returns an error:
- `callvault_execute` with `navigation.list_banks` returns "unknown operation" error
  </verify>
  <done>Worker deployed with Organization/Workspace/Folder naming. New operation names work. Old operation names rejected. Non-renamed operations unaffected (zero regression on MCP-02).</done>
</task>

</tasks>

<verification>
- TypeScript compiles clean in callvault-mcp directory
- Zero instances of `list_banks`, `list_vaults`, `listBanks`, `listVaults` in source
- Worker deployed and responding at callvault-mcp.naegele412.workers.dev
- New operation names return real data
- Old operation names return errors
- Non-renamed operations (recordings, contacts, search) still work
</verification>

<success_criteria>
MCP-02 satisfied: all v1 capabilities still work (recordings, contacts, search, transcripts, analysis). MCP-03 satisfied: all user-facing naming uses Organization/Workspace/Folder. Clean break: old Bank/Vault/Hub operation names rejected.
</success_criteria>

<output>
After completion, create `.planning/phases/19-mcp-audit-workspace-tokens/19-02-SUMMARY.md`
</output>
