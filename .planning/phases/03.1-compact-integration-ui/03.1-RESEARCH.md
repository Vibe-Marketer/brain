# Phase 3.1: Compact Integration UI - Research

**Researched:** 2026-01-28
**Domain:** React UI Components, Modal Patterns, Integration States
**Confidence:** HIGH

## Summary

This phase redesigns integration cards from large list-based cards to compact button/icon format with a reusable connection modal. Research focused on:

1. **Existing codebase patterns** for integrations, modals, and state management
2. **Brand guidelines compliance** for colors, spacing, and button systems
3. **Component reusability patterns** already established in the project

**Primary recommendation:** Build `IntegrationConnectModal` as a new component using the existing `Dialog` primitive from Radix UI, create `CompactIntegrationButton` using existing platform icons, and leverage the existing `useIntegrationSync` hook for state management.

## Standard Stack

### Core (Already in Codebase)

| Library | Version | Purpose | Why Standard |
|---------|---------|---------|--------------|
| `@radix-ui/react-dialog` | In use | Modal/dialog primitive | Already used for Dialog component |
| `@radix-ui/react-tooltip` | In use | Tooltip primitive | Already used throughout codebase |
| `@remixicon/react` | In use | Icons | Mandatory per brand guidelines |
| `zustand` | In use | Client state | Used for panel state, could use for modal |
| `@tanstack/react-query` | In use | Server state | Used by useIntegrationSync |

### Supporting (Already in Codebase)

| Library | Version | Purpose | When to Use |
|---------|---------|---------|-------------|
| `sonner` | In use | Toast notifications | Connection success/error feedback |
| `date-fns` | In use | Date formatting | "Last synced: X ago" display |
| `clsx`/`tailwind-merge` | In use | Class merging | Conditional styling |

### Alternatives Considered

| Instead of | Could Use | Tradeoff |
|------------|-----------|----------|
| Radix Dialog | Custom modal | Radix provides accessibility out-of-box, already in use |
| Zustand for modal | React Context | Context works but Zustand pattern established |
| Custom icons | SVG inline | Icons already exist as FathomIcon, GoogleMeetIcon, ZoomIcon |

**Installation:**
```bash
# No new dependencies required - all libraries already present
```

## Architecture Patterns

### Recommended Component Structure

```
src/
├── components/
│   ├── integrations/                    # NEW: Integration-specific components
│   │   ├── CompactIntegrationButton.tsx # NEW: 56-64px icon button
│   │   ├── IntegrationConnectModal.tsx  # NEW: Reusable connection modal
│   │   └── IntegrationButtonGroup.tsx   # NEW: Grid of compact buttons
│   ├── sync/
│   │   ├── IntegrationSyncPane.tsx      # MODIFY: Use CompactIntegrationButton
│   │   ├── IntegrationStatusRow.tsx     # KEEP: For Settings list view
│   │   └── InlineConnectionWizard.tsx   # REUSE: Content for modal
│   └── shared/
│       └── IntegrationManager.tsx       # MODIFY: Support compact variant
├── hooks/
│   └── useIntegrationSync.ts            # REUSE: No changes needed
└── stores/
    └── integrationModalStore.ts         # NEW: Modal state management
```

### Pattern 1: Compact Button Component

**What:** Square button with rounded corners displaying platform logo, connected/disconnected state via ring color and opacity

**When to use:** Sync page header, anywhere compact integration display needed

**Example:**
```tsx
// Source: CONTEXT.md decisions + existing SourcePlatformIcons.tsx patterns
interface CompactIntegrationButtonProps {
  platform: IntegrationPlatform;
  connected: boolean;
  email?: string;
  lastSyncAt?: string | null;
  onClick: () => void;
  size?: 'sm' | 'md' | 'lg'; // 48px | 56-64px | 72px
}

export function CompactIntegrationButton({
  platform,
  connected,
  email,
  lastSyncAt,
  onClick,
  size = 'md',
}: CompactIntegrationButtonProps) {
  const Icon = platformIcons[platform];
  const name = platformNames[platform];
  
  // Size mapping per CONTEXT.md: Medium (56-64px)
  const sizeClasses = {
    sm: 'w-12 h-12',    // 48px
    md: 'w-14 h-14',    // 56px (fits 6+ per row)
    lg: 'w-16 h-16',    // 64px
  };
  
  const iconSizes = {
    sm: 24,
    md: 28,
    lg: 32,
  };
  
  return (
    <TooltipProvider delayDuration={200}>
      <Tooltip>
        <TooltipTrigger asChild>
          <button
            onClick={onClick}
            className={cn(
              // Base: Square with rounded corners
              sizeClasses[size],
              "relative rounded-xl",
              "flex items-center justify-center",
              "transition-all duration-200",
              // Ring for connection state - 2px ring
              "ring-2 ring-offset-2 ring-offset-background",
              connected 
                ? "ring-success" // Green ring 
                : "ring-destructive/50", // Red ring
              // Opacity treatment per CONTEXT.md
              !connected && "opacity-50",
              // Hover effect
              "hover:scale-105",
              // Background
              "bg-card border border-border shadow-sm"
            )}
          >
            {/* Platform icon */}
            <Icon size={iconSizes[size]} className={!connected ? 'grayscale' : ''} />
            
            {/* Connected badge: green checkmark bottom-right */}
            {connected && (
              <div className="absolute -bottom-1 -right-1 w-4 h-4 rounded-full bg-success flex items-center justify-center">
                <RiCheckLine className="h-2.5 w-2.5 text-white" />
              </div>
            )}
            
            {/* Info icon: top-right, white circle with "i" */}
            {connected && (
              <div className="absolute -top-1 -right-1 w-4 h-4 rounded-full bg-white dark:bg-card border border-border flex items-center justify-center">
                <RiInformationLine className="h-2.5 w-2.5 text-ink-muted" />
              </div>
            )}
          </button>
        </TooltipTrigger>
        <TooltipContent side="bottom" className="text-xs">
          {connected ? (
            <div>
              <p className="font-medium">{name} - Connected</p>
              {email && <p className="text-ink-muted">{email}</p>}
              {lastSyncAt && (
                <p className="text-ink-muted">
                  Last synced: {formatDistanceToNow(new Date(lastSyncAt), { addSuffix: true })}
                </p>
              )}
            </div>
          ) : (
            <p>{name} - Click to connect</p>
          )}
        </TooltipContent>
      </Tooltip>
    </TooltipProvider>
  );
}
```

### Pattern 2: Reusable Modal with Discriminated Content

**What:** Single IntegrationConnectModal component that shows different content based on connection state

**When to use:** Sync page, Settings > Integrations, Onboarding

**Example:**
```tsx
// Source: Existing Dialog primitive + InlineConnectionWizard content
interface IntegrationConnectModalProps {
  platform: IntegrationPlatform | null;
  open: boolean;
  onOpenChange: (open: boolean) => void;
  onConnectionChange?: () => void;
}

export function IntegrationConnectModal({
  platform,
  open,
  onOpenChange,
  onConnectionChange,
}: IntegrationConnectModalProps) {
  const { integrations } = useIntegrationSync();
  
  if (!platform) return null;
  
  const integration = integrations.find(i => i.platform === platform);
  const isConnected = integration?.connected ?? false;
  
  return (
    <Dialog open={open} onOpenChange={onOpenChange}>
      <DialogContent className="sm:max-w-md">
        {isConnected ? (
          // Connected state content
          <ConnectedContent
            platform={platform}
            email={integration?.email}
            lastSyncAt={integration?.lastSyncAt}
            onDisconnect={() => {/* disconnect logic */}}
            onClose={() => onOpenChange(false)}
          />
        ) : (
          // Disconnected state - reuse InlineConnectionWizard
          <InlineConnectionWizard
            platform={platform}
            onComplete={() => {
              onConnectionChange?.();
              onOpenChange(false);
            }}
            onCancel={() => onOpenChange(false)}
            currentEmail={integration?.email}
          />
        )}
      </DialogContent>
    </Dialog>
  );
}
```

### Pattern 3: Modal State Store (Optional)

**What:** Zustand store for managing modal state globally

**When to use:** When modal needs to be triggered from multiple locations

**Example:**
```tsx
// Source: Existing panelStore.ts pattern
import { create } from 'zustand';
import type { IntegrationPlatform } from '@/hooks/useIntegrationSync';

interface IntegrationModalState {
  isOpen: boolean;
  platform: IntegrationPlatform | null;
  openModal: (platform: IntegrationPlatform) => void;
  closeModal: () => void;
}

export const useIntegrationModalStore = create<IntegrationModalState>((set) => ({
  isOpen: false,
  platform: null,
  openModal: (platform) => set({ isOpen: true, platform }),
  closeModal: () => set({ isOpen: false, platform: null }),
}));
```

### Anti-Patterns to Avoid

- **Duplicating connection logic:** The `InlineConnectionWizard` already handles OAuth flow - reuse it inside the modal
- **Hardcoding sizes:** Use Tailwind classes that map to the decided 56-64px size
- **Ignoring brand guidelines ring colors:** Must use `ring-success` (green) and `ring-destructive` (red) not arbitrary colors
- **Creating per-platform modals:** One modal component with conditional content, not three separate modals
- **Vibe orange misuse:** Do NOT use vibe orange for the ring - it's only for 9 specific uses per brand guidelines

## Don't Hand-Roll

| Problem | Don't Build | Use Instead | Why |
|---------|-------------|-------------|-----|
| Modal primitive | Custom modal overlay | `@radix-ui/react-dialog` (existing) | Focus trap, aria, escape handling |
| Tooltip primitive | Custom tooltip | `@radix-ui/react-tooltip` (existing) | Positioning, delay, accessibility |
| Platform icons | New SVG icons | `FathomIcon`, `GoogleMeetIcon`, `ZoomIcon` | Already exist in codebase |
| OAuth flow | Custom OAuth | `InlineConnectionWizard` | Handles timeouts, errors, redirects |
| Connection state | Custom fetch | `useIntegrationSync` hook | Real-time updates via Supabase subscription |
| Toast notifications | Custom notifications | `sonner` | Already integrated |

**Key insight:** This phase is primarily UI composition, not new functionality. The OAuth flows, state management, and icons all exist - we're just reorganizing how they're presented.

## Common Pitfalls

### Pitfall 1: Ring Color Accessibility

**What goes wrong:** Green/red ring colors fail WCAG contrast on some backgrounds
**Why it happens:** Pure green (#00FF00) or pure red (#FF0000) have poor contrast
**How to avoid:** Use semantic colors from brand guidelines: `ring-success` (green-600 based) and `ring-destructive` (red-600 based)
**Warning signs:** Ring colors appear washed out or invisible in dark mode

### Pitfall 2: Button Size Inconsistency

**What goes wrong:** Buttons don't fit 6+ in a row at various viewport widths
**Why it happens:** Using fixed pixel widths without considering gap and padding
**How to avoid:** Test at 1024px viewport width (tablet breakpoint) - should fit 6 buttons with 8-12px gaps
**Warning signs:** Buttons wrap to second row at tablet size

### Pitfall 3: Modal State Race Condition

**What goes wrong:** Modal shows stale connection state after OAuth redirect
**Why it happens:** `useIntegrationSync` has pending OAuth detection but modal might not re-render
**How to avoid:** Use `onConnectionChange` callback to trigger refresh, ensure modal re-reads from hook
**Warning signs:** User connects successfully but modal still shows "Connect" button

### Pitfall 4: Settings Page Regression

**What goes wrong:** Changing IntegrationManager breaks Settings > Integrations page
**Why it happens:** Settings needs list format, not compact buttons
**How to avoid:** Keep `variant="full"` working exactly as before, only modify `variant="compact"` 
**Warning signs:** IntegrationsTab.tsx tests fail or visual regression

### Pitfall 5: Tooltip Hover vs Click Confusion

**What goes wrong:** Users can't click the button because tooltip intercepts
**Why it happens:** TooltipTrigger with `asChild` must wrap a focusable element correctly
**How to avoid:** Button is the TooltipTrigger child, not the other way around
**Warning signs:** Click events don't fire, only hover works

## Code Examples

### CompactIntegrationButton Complete Implementation

```tsx
// Source: Derived from CONTEXT.md + existing patterns
import { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from "@/components/ui/tooltip";
import { RiCheckLine, RiInformationLine } from "@remixicon/react";
import { FathomIcon, GoogleMeetIcon, ZoomIcon } from "@/components/transcript-library/SourcePlatformIcons";
import { cn } from "@/lib/utils";
import { formatDistanceToNow } from "date-fns";
import type { IntegrationPlatform } from "@/hooks/useIntegrationSync";

const platformIcons = {
  fathom: FathomIcon,
  google_meet: GoogleMeetIcon,
  zoom: ZoomIcon,
};

const platformNames = {
  fathom: "Fathom",
  google_meet: "Google Meet",
  zoom: "Zoom",
};

interface CompactIntegrationButtonProps {
  platform: IntegrationPlatform;
  connected: boolean;
  email?: string;
  lastSyncAt?: string | null;
  onClick: () => void;
}

export function CompactIntegrationButton({
  platform,
  connected,
  email,
  lastSyncAt,
  onClick,
}: CompactIntegrationButtonProps) {
  const Icon = platformIcons[platform];
  const name = platformNames[platform];
  
  return (
    <TooltipProvider delayDuration={200}>
      <Tooltip>
        <TooltipTrigger asChild>
          <button
            onClick={onClick}
            className={cn(
              // Size: 56px per CONTEXT.md decision (fits 6-8 per row)
              "w-14 h-14",
              // Shape: Square with rounded corners
              "relative rounded-xl",
              "flex flex-col items-center justify-center gap-0.5",
              "transition-all duration-200",
              // Ring for connection state
              "ring-2 ring-offset-2 ring-offset-background",
              connected ? "ring-success" : "ring-destructive/50",
              // Opacity per CONTEXT.md: 50-60% when disconnected
              !connected && "opacity-60",
              // Hover
              "hover:scale-105 hover:shadow-md",
              // Background
              "bg-card border border-border shadow-sm"
            )}
          >
            <Icon size={28} className={cn(!connected && "grayscale")} />
            
            {/* Connected: green checkmark badge bottom-right */}
            {connected && (
              <div className="absolute -bottom-1 -right-1 w-4 h-4 rounded-full bg-success flex items-center justify-center shadow-sm">
                <RiCheckLine className="h-2.5 w-2.5 text-white" />
              </div>
            )}
            
            {/* Connected: info icon top-right */}
            {connected && (
              <div className="absolute -top-1 -right-1 w-4 h-4 rounded-full bg-white dark:bg-card border border-border flex items-center justify-center shadow-sm">
                <RiInformationLine className="h-2.5 w-2.5 text-ink-muted" />
              </div>
            )}
          </button>
        </TooltipTrigger>
        <TooltipContent side="bottom" className="text-xs max-w-[200px]">
          <div className="space-y-0.5">
            <p className="font-medium">
              {name} {connected ? "- Connected" : "- Not Connected"}
            </p>
            {connected && email && (
              <p className="text-ink-muted truncate">{email}</p>
            )}
            {connected && lastSyncAt && (
              <p className="text-ink-muted">
                Last synced: {formatDistanceToNow(new Date(lastSyncAt), { addSuffix: true })}
              </p>
            )}
            {!connected && (
              <p className="text-ink-muted">Click to connect</p>
            )}
          </div>
        </TooltipContent>
      </Tooltip>
    </TooltipProvider>
  );
}
```

### Integration Button Group for Sync Page Header

```tsx
// Source: CONTEXT.md - "Integrations" header with compact buttons next to it
import { useIntegrationSync } from "@/hooks/useIntegrationSync";
import { useIntegrationModalStore } from "@/stores/integrationModalStore";
import { CompactIntegrationButton } from "./CompactIntegrationButton";

export function IntegrationButtonGroup() {
  const { integrations } = useIntegrationSync();
  const { openModal } = useIntegrationModalStore();
  
  return (
    <div className="flex items-center gap-2">
      <span className="text-sm font-medium text-ink-soft uppercase tracking-wide mr-2">
        Integrations
      </span>
      <div className="flex items-center gap-2">
        {integrations.map((integration) => (
          <CompactIntegrationButton
            key={integration.platform}
            platform={integration.platform}
            connected={integration.connected}
            email={integration.email}
            lastSyncAt={integration.lastSyncAt}
            onClick={() => openModal(integration.platform)}
          />
        ))}
      </div>
    </div>
  );
}
```

### ConnectedContent for Modal

```tsx
// Source: CONTEXT.md modal requirements for connected state
import { Button } from "@/components/ui/button";
import { DialogHeader, DialogTitle, DialogDescription, DialogFooter } from "@/components/ui/dialog";
import { RiCheckboxCircleLine, RiTimeLine, RiSettings3Line } from "@remixicon/react";
import { formatDistanceToNow } from "date-fns";
import { useNavigate } from "react-router-dom";
import type { IntegrationPlatform } from "@/hooks/useIntegrationSync";

interface ConnectedContentProps {
  platform: IntegrationPlatform;
  email?: string;
  lastSyncAt?: string | null;
  onDisconnect: () => void;
  onClose: () => void;
}

const platformNames = {
  fathom: "Fathom",
  google_meet: "Google Meet", 
  zoom: "Zoom",
};

export function ConnectedContent({
  platform,
  email,
  lastSyncAt,
  onDisconnect,
  onClose,
}: ConnectedContentProps) {
  const navigate = useNavigate();
  const name = platformNames[platform];
  
  return (
    <>
      <DialogHeader>
        <DialogTitle className="flex items-center gap-2">
          <RiCheckboxCircleLine className="h-5 w-5 text-success" />
          {name} Connected
        </DialogTitle>
        <DialogDescription>
          Your {name} account is connected and syncing.
        </DialogDescription>
      </DialogHeader>
      
      <div className="space-y-4 py-4">
        {/* Connected account email */}
        {email && (
          <div className="flex items-center justify-between py-2 border-b border-border">
            <span className="text-sm text-ink-muted">Connected as</span>
            <span className="text-sm font-medium">{email}</span>
          </div>
        )}
        
        {/* Last synced */}
        {lastSyncAt && (
          <div className="flex items-center justify-between py-2 border-b border-border">
            <span className="text-sm text-ink-muted flex items-center gap-1">
              <RiTimeLine className="h-4 w-4" />
              Last synced
            </span>
            <span className="text-sm">
              {formatDistanceToNow(new Date(lastSyncAt), { addSuffix: true })}
            </span>
          </div>
        )}
      </div>
      
      <DialogFooter className="flex-col sm:flex-row gap-2">
        <Button
          variant="hollow"
          onClick={() => {
            onClose();
            navigate('/settings/integrations');
          }}
          className="flex-1"
        >
          <RiSettings3Line className="mr-2 h-4 w-4" />
          Manage in Settings
        </Button>
        <Button
          variant="destructive"
          onClick={onDisconnect}
          className="flex-1"
        >
          Disconnect
        </Button>
      </DialogFooter>
    </>
  );
}
```

## State of the Art

| Old Approach | Current Approach | When Changed | Impact |
|--------------|------------------|--------------|--------|
| Large card list | Compact icon buttons | This phase | 6x density improvement |
| Inline wizard | Modal wizard | This phase | Reusable across pages |
| Per-page integration UI | Shared component | Already done (IntegrationManager) | Foundation for this work |

**Deprecated/outdated:**
- `IntegrationStatusCard.tsx`: Still used in Settings but the row-based approach stays for that context
- Large integration cards on Sync page: Being replaced by compact buttons

## Open Questions

1. **Disconnect flow location**
   - What we know: CONTEXT.md says modal shows disconnect option
   - What's unclear: Should disconnect require confirmation dialog?
   - Recommendation: Add a simple "Are you sure?" inline confirmation in the modal, not a second modal

2. **Label text below icon**
   - What we know: CONTEXT.md mentions "Small text below icon (e.g., 'Zoom')"
   - What's unclear: Is this required or optional given tooltip exists?
   - Recommendation: Skip label to keep buttons compact; tooltip provides name on hover

3. **Onboarding integration**
   - What we know: Same modal used in onboarding per CONTEXT.md
   - What's unclear: Onboarding flow doesn't exist yet - is it in scope?
   - Recommendation: Build modal to be trigger-agnostic; onboarding uses same store/component later

## Sources

### Primary (HIGH confidence)
- `/Users/Naegele/dev/brain/docs/design/brand-guidelines-v4.2.md` - Color system, button system, spacing
- `/Users/Naegele/dev/brain/src/components/ui/dialog.tsx` - Existing Dialog component
- `/Users/Naegele/dev/brain/src/components/ui/tooltip.tsx` - Existing Tooltip component
- `/Users/Naegele/dev/brain/src/hooks/useIntegrationSync.ts` - Integration state management
- `/Users/Naegele/dev/brain/src/components/sync/InlineConnectionWizard.tsx` - OAuth flow implementation
- `/Users/Naegele/dev/brain/src/components/transcript-library/SourcePlatformIcons.tsx` - Platform icons

### Secondary (MEDIUM confidence)
- CONTEXT.md decisions provided in task context - User-locked design decisions

### Tertiary (LOW confidence)
- None - all patterns verified against existing codebase

## Metadata

**Confidence breakdown:**
- Standard stack: HIGH - All libraries already in use, verified via package.json patterns
- Architecture: HIGH - Following existing component patterns in codebase
- Pitfalls: MEDIUM - Based on code review and React patterns, not production experience with this specific UI

**Research date:** 2026-01-28
**Valid until:** 2026-02-28 (30 days - stable UI patterns)
