# Phase 10.2: Vaults Page — Research

**Researched:** 2026-02-09
**Domain:** Frontend vault management page, bank/vault context system, member management
**Confidence:** HIGH

## Summary

This research verifies the current codebase state to identify which references in the 9 existing PLAN.md files are accurate vs stale. The bank/vault architecture (Phase 9) is fully in place: database tables, RLS policies, TypeScript types, BankSwitcher, useBankContext, AddToVaultMenu, VaultManagement (settings), and useVaultAssignment all exist and function. The Collaboration page at `/team` is the current placeholder that will be replaced by `/vaults`.

**Key findings:**
- All database tables exist and are production-ready (banks, bank_memberships, vaults, vault_memberships, recordings, vault_entries)
- BankSwitcher exists and works — sets active bank context via useBankContext/bankContextStore
- NO vault_invitations table exists (CONTEXT.md says NOT to create one — use shareable link pattern from TeamJoin)
- Team invite pattern uses `invite_token` on the `teams` table — NOT a separate invitations table. Vault invites should follow same pattern
- NO `ZoomImportDialog` or `GoogleImportDialog` components exist — Zoom/Google sync is triggered via `useIntegrationSync` hook calling edge functions directly, not through dedicated import dialogs
- `useVaultMutations`, `useBankMutations`, `useVaultMemberMutations` do NOT exist yet — need to be created
- Query keys for vaults are partially defined (`vaultEntries` exists) but no `vaults` key group
- PanelType does NOT include `vault-detail` or `vault-member` or `bank-settings` yet

**Primary recommendation:** Patch plans to fix stale references (import dialog names, invite pattern, missing hooks) and restructure for parallel execution.

<user_constraints>
## User Constraints (from CONTEXT.md)

### Locked Decisions
- Full vault experience shipped in this phase — includes badges, search, and import vault selection
- Plans should be parallelized where possible (not 9 sequential waves)
- Import vault selection stays in phase (covers all 3 import flows: Zoom, Google, YouTube)
- Existing plans should be researched then patched — not replanned from scratch
- Bank switcher controls which bank's vaults are visible — vault list shows ONLY active bank's vaults
- Use existing BankSwitcher in header for global bank context
- Vaults page ALSO shows which bank you're in prominently
- Vault detail: recordings always visible in main content area, members open as slide-in detail panel (4th pane pattern). NO tabs
- Reuse existing TranscriptTable component for recordings display within vaults
- Invite flow: reuse team invite pattern from Phase 4 — generate shareable link with expiry. NO new vault_invitations table, NO email sending infrastructure
- Role management: full 5-level hierarchy exposed in UI
- Default join role via link: always member
- Both self-removal and admin removal allowed
- Business bank: collect name + logo + settings upfront
- Entry points for business bank creation: both header BankSwitcher dropdown AND Vaults page CTA
- Post-creation: auto-switch to new bank + immediately prompt to create first vault
- Bank settings (rename, logo, danger zone/delete) lives in Settings page only — NOT on Vaults page

### Claude's Discretion
- Exact wave grouping for parallel execution
- Loading skeleton and transition designs
- Error boundary placement and fallback UI
- Mobile responsive breakpoints and overlay patterns
- VaultBadge component visual design
- Search/filter UI component design within vaults
- VaultSelector component design for import dialogs

### Deferred Ideas (OUT OF SCOPE)
- None
</user_constraints>

## Existing Components & Hooks

### 1. BankSwitcher (`src/components/header/BankSwitcher.tsx`) — EXISTS ✅
- **Status:** Fully functional
- **Exports:** `BankSwitcher` component (named export)
- **What it does:**
  - Dropdown in header showing active bank name + icon
  - Lists all user banks with role badges
  - Shows vaults within active bank with "All Recordings" option
  - Has "Create Business Bank" CTA (currently navigates to `/settings/banks` with Pro badge)
  - Has "Manage Banks" link to `/settings/banks`
- **Uses:** `useBankContext()` for `activeBank`, `activeVault`, `banks`, `vaults`, `switchBank`, `switchVault`
- **Plan Impact:** Plan 05 references enhancing BankSwitcher — the base already has the dropdown structure. Need to add `CreateBusinessBankDialog` integration instead of navigating to settings.

### 2. useBankContext (`src/hooks/useBankContext.ts`) — EXISTS ✅
- **Status:** Fully functional
- **Exports:** `useBankContext()` hook
- **Returns:**
  - State: `activeBankId`, `activeVaultId`, `activeBank`, `activeVault`, `personalVault`, `banks`, `vaults`
  - Loading: `isLoading`, `isInitialized`, `error`
  - Actions: `switchBank(bankId)`, `switchVault(vaultId | null)`, `reset()`
  - Helpers: `isPersonalBank`, `isBusinessBank`, `bankRole`, `vaultRole`
- **Key behavior:** Auto-creates personal bank via `ensure_personal_bank` RPC if user has no banks
- **Query key:** `['bankContext', 'banks', userId]` and `['bankContext', 'vaults', activeBankId, userId]`
- **Plan Impact:** Plans reference this correctly. The `vaults` from this hook are already filtered by active bank — exactly what VaultListPane needs.

### 3. bankContextStore (`src/stores/bankContextStore.ts`) — EXISTS ✅
- **Exports:** `useBankContextStore` (Zustand), `BANK_CONTEXT_UPDATED_KEY`
- **State:** `activeBankId`, `activeVaultId`, `isLoading`, `isInitialized`, `error`
- **Actions:** `setActiveBank`, `setActiveVault`, `initialize`, `setLoading`, `setError`, `reset`
- **Cross-tab sync via localStorage**

### 4. Bank Types (`src/types/bank.ts`) — EXISTS ✅
- **Exports:** `BankType`, `BankRole`, `VaultType`, `VaultRole`, `FolderVisibility`, `Bank`, `BankMembership`, `Vault`, `VaultMembership`, `BankWithMembership`, `VaultWithMembership`, `Recording`, `VaultEntry`
- **All types plans reference are defined here**

### 5. AddToVaultMenu (`src/components/vault/AddToVaultMenu.tsx`) — EXISTS ✅
- **Status:** Fully functional
- **Props:** `recordingId`, `legacyRecordingId`, `compact`
- **What it does:** Popover checklist of vaults, toggle assignments, prevents personal vault removal
- **Uses:** `useVaultAssignment`, `useBankContext`
- **Plan Impact:** Plan 02 references integrating this — it already works as-is.

### 6. useVaultAssignment (`src/hooks/useVaultAssignment.ts`) — EXISTS ✅
- **Status:** Fully functional
- **Exports:** `useVaultAssignment(recordingId, legacyRecordingId?)`
- **Returns:** `recordingVaultEntries`, `assignedVaultIds` (Set), `effectiveRecordingId`, `isLoading`, `addToVault`, `removeFromVault`, `toggleVault`, `isAdding`, `isRemoving`
- **Uses query key:** `queryKeys.vaultEntries.byRecording(id)`
- **Resolves legacy IDs to UUIDs automatically**
- **Plan Impact:** Plans 02 and 07 reference this — it works correctly.

### 7. VaultManagement (`src/components/settings/VaultManagement.tsx`) — EXISTS ✅
- **Status:** Working, basic settings-style vault CRUD
- **Props:** `bankId`, `canManage`
- **Features:** Lists vaults in a bank, create vault dialog (name + type), creates vault_membership for creator, creates default folders for team vaults
- **Already implements:** Create vault mutation, default folder creation (Hall of Fame, Manager Reviews)
- **Plan Impact:** Plan 03 creates separate `CreateVaultDialog` — should reuse patterns from this existing implementation. Plan 06 references migrating this.

### 8. BanksTab (`src/components/settings/BanksTab.tsx`) — EXISTS ✅
- **Status:** Working settings tab
- **Uses:** `useBankContext`, `VaultManagement`
- **Shows:** Banks as tabs, each with bank details card + VaultManagement
- **Plan Impact:** Plan 06 references adding migration banner — accurate.

### 9. CollaborationPage (`src/pages/CollaborationPage.tsx`) — EXISTS ✅
- **Status:** Working 3-pane page at `/team` route
- **Uses:** `AppShell` with `CollaborationCategoryPane` as secondaryPane
- **Content:** Loads TeamTab via React.lazy
- **Plan Impact:** Plan 01 replaces this with VaultsPage. Plan 06 converts it to redirect.

### 10. CollaborationCategoryPane (`src/components/panes/CollaborationCategoryPane.tsx`) — EXISTS ✅
- **Status:** Working, but only has 1 category: "team"
- **Pattern:** Good reference for VaultListPane styling (left orange indicator, icon buttons, keyboard nav)
- **Plan Impact:** VaultListPane should follow this pattern.

### 11. sidebar-nav (`src/components/ui/sidebar-nav.tsx`) — EXISTS ✅
- **Current nav items:** Home, AI Chat, Content, Import, Sorting, **Collaboration** (path: `/team`, icon: RiTeamLine), Analytics, Settings
- **Plan Impact:** Plan 01 changes "Collaboration" to "Vaults" — need to update `id`, `name`, `path`, `iconLine`, `iconFill`, and `matchPaths`.

### 12. AppShell (`src/components/layout/AppShell.tsx`) — EXISTS ✅
- **Pane architecture:** 4 panes (NavRail, Secondary, Main, Detail)
- **Config:** `showNavRail`, `secondaryPane`, `showDetailPane`, `onLibraryToggle`, `onSettingsClick`, `onSortingClick`, `onSyncClick`
- **Widths:** NavRail 220/72px, Secondary 280px, Main flex-1, Detail 360/320px
- **Plans correctly reference this pattern**

### 13. DetailPaneOutlet (`src/components/layout/DetailPaneOutlet.tsx`) — EXISTS ✅
- **Current panel types rendered:** `folder-detail`, `tag-detail`, `setting-help`, `user-detail`, `call-detail`
- **Missing:** `vault-member`, `vault-detail`, `bank-settings` — need to be added
- **Plan Impact:** Plans 02, 05 need to add new panel types here.

### 14. PanelType/PanelData (`src/types/panel.ts`) — EXISTS ✅
- **Current PanelType union:** `workspace-detail | call-detail | insight-detail | filter-tool | ai-assistant | inspector | folder-detail | tag-detail | setting-help | settings | sorting | user-detail | bulk-actions | null`
- **Missing:** `vault-member`, `vault-detail`, `bank-settings`
- **Plan Impact:** Plan 01 correctly identifies need to add vault panel types.

### 15. query-config (`src/lib/query-config.ts`) — EXISTS ✅
- **Current vault-related keys:** `vaultEntries.all`, `vaultEntries.byRecording(id)`, `vaultEntries.byVault(id)`
- **Missing:** No `vaults` key group (for vault list, detail, members, recordings)
- **Plan Impact:** Plan 01 correctly identifies need to add `vaults` query keys.

### 16. TranscriptTable (`src/components/transcript-library/TranscriptTable.tsx`) — EXISTS ✅
- **Props:** `calls` (Meeting[]), `selectedCalls`, `tags`, `tagAssignments`, `folders`, `folderAssignments`, `hostEmail`, pagination props, visibility/export controls, sharing statuses
- **Data shape:** Uses `Meeting` type (from `src/types`), not `Recording` type from bank.ts
- **Features:** Column visibility toggle, sort, pagination, checkbox selection, tag/folder display
- **Plan Impact:** Plan 02 says "reuse existing TranscriptTable" — this is technically possible but the data shape mismatch (Meeting vs Recording/VaultEntry) means **a vault-specific recordings table component may be needed**, or TranscriptTable needs a wrapper/adapter. The CONTEXT.md says "Reuse existing TranscriptTable component" so we need to adapt data.

### 17. TeamInviteDialog (`src/components/sharing/TeamInviteDialog.tsx`) — EXISTS ✅
- **Status:** Working dialog for team member invites
- **Pattern:** Email-based invite, role selection, member list with role management
- **Uses:** `useTeamMembers` hook (team_memberships table)
- **Plan Impact:** CONTEXT.md says "reuse team invite pattern." The UI pattern is reusable but the underlying data is team_memberships, not vault_memberships. Need vault-specific version.

### 18. TeamJoin (`src/pages/TeamJoin.tsx`) — EXISTS ✅
- **Route:** `/join/team/:token`
- **Pattern:** Token-based join via `invite_token` column on `teams` table
- **Flow:** Validate token → check expiry → check not already member → create membership → redirect
- **Plan Impact:** This is the shareable link pattern to reuse. For vaults: need `invite_token` and `invite_expires_at` columns on `vaults` table, and a `/join/vault/:token` page.

### 19. YouTubeImportForm (`src/components/import/YouTubeImportForm.tsx`) — EXISTS ✅
- **Status:** Working form, calls `youtube-import` edge function
- **No vault_id parameter currently**
- **Plan Impact:** Plan 09 correctly identifies need to add VaultSelector here.

### 20. Layout (`src/components/Layout.tsx`) — EXISTS ✅
- **Status:** Simplified — no card wrapper, just TopBar + fixed main area
- **getPageLabel:** Returns 'COLLABORATION' for `/team` paths
- **Plan Impact:** Need to add '/vaults' → 'VAULTS' mapping.

## Files/Components That DO NOT Exist (Stale Plan References)

### Missing Hooks (need to be created)
| Hook | Referenced In | Status |
|------|---------------|--------|
| `src/hooks/useVaults.ts` | Plan 01, 02 | ❌ Does not exist |
| `src/hooks/useVaultMutations.ts` | Plan 03 | ❌ Does not exist |
| `src/hooks/useVaultMemberMutations.ts` | Plan 04 | ❌ Does not exist |
| `src/hooks/useBankMutations.ts` | Plan 05 | ❌ Does not exist |
| `src/hooks/useRecordingSearch.ts` | Plan 08 | ❌ Does not exist |
| `src/hooks/useUserPreferences.ts` | Plan 09 | ❌ Does not exist |

### Missing Components (need to be created)
| Component | Referenced In | Status |
|-----------|---------------|--------|
| `src/pages/VaultsPage.tsx` | Plan 01 | ❌ Does not exist |
| `src/components/panes/VaultListPane.tsx` | Plan 01 | ❌ Does not exist |
| `src/components/panes/VaultDetailPane.tsx` | Plan 02 | ❌ Does not exist |
| `src/components/panels/VaultMemberPanel.tsx` | Plan 02 | ❌ Does not exist |
| `src/components/dialogs/CreateVaultDialog.tsx` | Plan 03 | ❌ Does not exist |
| `src/components/dialogs/EditVaultDialog.tsx` | Plan 03 | ❌ Does not exist |
| `src/components/dialogs/DeleteVaultDialog.tsx` | Plan 03 | ❌ Does not exist |
| `src/components/dialogs/InviteMemberDialog.tsx` | Plan 04 | ❌ — rename to vault-specific |
| `src/components/dialogs/ChangeRoleDialog.tsx` | Plan 04 | ❌ Does not exist |
| `src/components/dialogs/CreateBusinessBankDialog.tsx` | Plan 05 | ❌ Does not exist |
| `src/components/panels/BankSettingsPanel.tsx` | Plan 05 | ❌ — BUT per CONTEXT.md, bank settings goes in Settings page only, NOT on Vaults page |
| `src/components/vault/VaultBadge.tsx` | Plan 07 | ❌ Does not exist |
| `src/components/vault/VaultBadgeList.tsx` | Plan 07 | ❌ Does not exist |
| `src/components/vault/VaultSearchFilter.tsx` | Plan 08 | ❌ Does not exist |
| `src/components/vault/VaultSelector.tsx` | Plan 09 | ❌ Does not exist |

### Stale File References in Plans
| Plan | References | Actual Status |
|------|-----------|---------------|
| Plan 04 | `src/components/sharing/TeamInviteDialog.tsx` as context | ✅ Exists but pattern needs adaptation |
| Plan 04 | Creates `vault_invitations` table migration | ❌ **STALE — CONTEXT.md explicitly says NO vault_invitations table** |
| Plan 05 | `src/components/panels/BankSettingsPanel.tsx` | ❌ **STALE — CONTEXT.md says bank settings lives in Settings page only** |
| Plan 09 | `src/components/sync/ZoomImportDialog.tsx` | ❌ **Does not exist** — Zoom sync uses `useIntegrationSync` hook calling `zoom-sync-meetings` edge function |
| Plan 09 | `src/components/sync/GoogleImportDialog.tsx` | ❌ **Does not exist** — Google sync uses `useIntegrationSync` calling `google-poll-sync` edge function |
| Plan 02 | References "Tabs for Recordings and Members" | ❌ **STALE — CONTEXT.md says NO tabs, recordings always visible, members as slide-in panel** |

## Database Schema State

### Tables — All Exist ✅
| Table | Migration | Status |
|-------|-----------|--------|
| `banks` | `20260131000005_create_banks_tables.sql` | ✅ Complete with RLS |
| `bank_memberships` | `20260131000005_create_banks_tables.sql` | ✅ Complete with RLS |
| `vaults` | `20260131000006_create_vaults_tables.sql` | ✅ Complete with RLS |
| `vault_memberships` | `20260131000006_create_vaults_tables.sql` | ✅ Complete with RLS |
| `recordings` | `20260131000007_create_recordings_tables.sql` | ✅ Complete with RLS |
| `vault_entries` | `20260131000007_create_recordings_tables.sql` | ✅ Complete with RLS |
| `vault_invitations` | N/A | ❌ Does NOT exist — and MUST NOT be created per CONTEXT.md |

### RLS Helper Functions — All Exist ✅
| Function | Purpose |
|----------|---------|
| `is_bank_member(bank_id, user_id)` | Check bank membership |
| `is_bank_admin_or_owner(bank_id, user_id)` | Check bank admin/owner |
| `is_vault_member(vault_id, user_id)` | Check vault membership |
| `is_vault_admin_or_owner(vault_id, user_id)` | Check vault admin/owner |
| `get_vault_bank_id(vault_id)` | Get vault's parent bank |
| `get_recording_bank_id(recording_id)` | Get recording's bank |
| `ensure_personal_bank(p_user_id)` | Auto-create personal bank |

### Missing DB Items for Vault Invites (Shareable Link Pattern)
- `vaults` table needs `invite_token TEXT` and `invite_expires_at TIMESTAMPTZ` columns (like `teams` table has)
- No new table needed — this follows the TeamJoin pattern exactly
- Need a `/join/vault/:token` page (like `/join/team/:token`)

### Edge Functions for Import — All Exist ✅
| Function | File |
|----------|------|
| `youtube-import` | `supabase/functions/youtube-import/index.ts` |
| `zoom-sync-meetings` | `supabase/functions/zoom-sync-meetings/index.ts` |
| `google-poll-sync` | `supabase/functions/google-poll-sync/index.ts` |

## Patterns to Follow

### AppShell 3-Pane Pattern (from SortingTagging.tsx)
```tsx
<AppShell
  config={{
    secondaryPane: <VaultListPane />,
    showDetailPane: true,
  }}
>
  <VaultDetailContent />
</AppShell>
```

### Detail Panel Pattern (via panelStore)
```tsx
// Open panel
const { openPanel } = usePanelStore();
openPanel('vault-member', { type: 'vault-member', vaultId });

// Render in DetailPaneOutlet
case 'vault-member':
  return <VaultMemberPanel vaultId={panelData.vaultId} />;
```

### Query Key Factory Pattern
```tsx
// Add to query-config.ts
vaults: {
  all: ['vaults'] as const,
  list: (bankId?: string) => ['vaults', 'list', bankId] as const,
  detail: (vaultId: string) => ['vaults', 'detail', vaultId] as const,
  members: (vaultId: string) => ['vaults', 'members', vaultId] as const,
  recordings: (vaultId: string) => ['vaults', 'recordings', vaultId] as const,
},
```

### Shareable Invite Link Pattern (from TeamJoin)
1. Add `invite_token` + `invite_expires_at` columns to `vaults` table (migration)
2. Generate token: `crypto.randomUUID()` on invite generation
3. Share link: `/join/vault/{token}`
4. Join page validates token, checks expiry, creates vault_membership with role=member
5. No email sending — user copies and shares the link manually

### Mutation with Optimistic Updates (from useVaultAssignment)
```tsx
const mutation = useMutation({
  mutationFn: async (input) => { /* supabase call */ },
  onMutate: async (input) => {
    await queryClient.cancelQueries({ queryKey });
    const previous = queryClient.getQueryData(queryKey);
    queryClient.setQueryData(queryKey, optimisticUpdate);
    return { previous };
  },
  onError: (err, vars, ctx) => {
    queryClient.setQueryData(queryKey, ctx?.previous);
    toast.error('Failed to ...');
  },
  onSettled: () => {
    queryClient.invalidateQueries({ queryKey });
  },
});
```

## Stale References in Existing Plans — Critical Issues

### Plan 02: Tabs Pattern CONTRADICTS Context
- **Plan says:** "Tabs for Recordings and Members visible" (must_haves truth #3)
- **CONTEXT.md says:** "Vault detail: recordings always visible in main content area, members open as slide-in detail panel (4th pane pattern). NO tabs"
- **Fix:** Remove tabs. Recordings are the main content. Members open via button → VaultMemberPanel in DetailPaneOutlet.

### Plan 04: vault_invitations Table CONTRADICTS Context
- **Plan says:** Create `vault_invitations` database table with full schema
- **CONTEXT.md says:** "NO new vault_invitations table, NO email sending infrastructure"
- **Fix:** Remove the migration task entirely. Instead: add `invite_token` and `invite_expires_at` columns to `vaults` table. Create `/join/vault/:token` page following TeamJoin pattern.

### Plan 04: Email Invite Flow CONTRADICTS Context
- **Plan says:** "Invited users receive email with join link" (must_haves truth #2), invitation email sending
- **CONTEXT.md says:** "reuse team invite pattern from Phase 4 — generate shareable link with expiry. NO email sending infrastructure"
- **Fix:** Generate shareable link. User copies URL. No email. Members join by clicking link.

### Plan 05: BankSettingsPanel Location CONTRADICTS Context
- **Plan says:** Create `BankSettingsPanel` as a detail panel on Vaults page
- **CONTEXT.md says:** "Bank settings (rename, logo, danger zone/delete) lives in Settings page only — NOT on the Vaults page"
- **Fix:** Remove BankSettingsPanel from Plan 05 entirely. Bank settings stay in the existing BanksTab in Settings.

### Plan 09: Import Dialog Names Are WRONG
- **Plan references:** `src/components/sync/ZoomImportDialog.tsx` and `src/components/sync/GoogleImportDialog.tsx`
- **Reality:** These files don't exist. Zoom/Google sync happens via `useIntegrationSync` hook calling edge functions
- **Fix:** VaultSelector needs to be integrated into the Import page's sync flow, specifically into the `IntegrationSyncPane` or wherever the sync trigger lives. The vault_id needs to be passed to the `zoom-sync-meetings` and `google-poll-sync` edge function calls.

## Recommendations for Plan Patching

### Plan 01 (Foundation) — Minor fixes needed
- References are mostly accurate
- Add: `Layout.tsx` needs `/vaults` → 'VAULTS' in `getPageLabel()`
- Add: Route needs to be added in `App.tsx` (currently only `/team` exists)
- The plan correctly notes `SortingTagging.tsx` as reference pattern
- Query keys addition is correct — `vaultEntries` exists but `vaults` does not

### Plan 02 (Vault Detail) — MAJOR rewrite needed
- **Remove tabs** — CONTEXT says NO tabs. Recordings always visible, members in slide-in panel
- VaultDetailPane becomes a recordings display (main content area)
- VaultMemberPanel opens as 4th pane via panelStore
- TranscriptTable reuse: data shape mismatch between `Meeting` type and vault `Recording`/`VaultEntry` types — need adapter or simplified table
- Remove "Tabs" from must_haves truths

### Plan 03 (CRUD) — Minor fixes
- Can reuse patterns from existing `VaultManagement.tsx` (which already has create vault mutation)
- CreateVaultDialog already exists in simplified form in VaultManagement — extract and enhance
- References are generally accurate

### Plan 04 (Member Management) — MAJOR rewrite needed
- **Remove vault_invitations table migration entirely**
- **Remove email sending infrastructure**
- Replace with: add `invite_token`/`invite_expires_at` to vaults table, create VaultJoin page
- InviteMemberDialog becomes "Generate Invite Link" dialog
- Change role and remove member flows can stay as designed
- useVaultMemberMutations still needed but without invitation-related mutations

### Plan 05 (Business Bank) — Moderate fixes
- **Remove BankSettingsPanel** (bank settings stays in Settings page per CONTEXT.md)
- CreateBusinessBankDialog — accurate, needs creation
- BankSwitcher enhancement — mostly accurate, base already has CTA
- useBankMutations — needs creation, references are accurate
- Post-creation flow (auto-switch + prompt first vault) — accurate

### Plan 06 (Polish) — Minor fixes
- Empty states, error boundaries, mobile polish — all accurate
- CollaborationPage redirect — accurate
- Settings migration — accurate
- Remove any references to BankSettingsPanel

### Plan 07 (Vault Badges) — Mostly accurate
- VaultBadge/VaultBadgeList need creation
- CallDetailPage integration — accurate reference
- TranscriptTable integration — accurate but data shape concerns apply

### Plan 08 (Search/Filter) — Mostly accurate
- New components/hooks needed — accurate
- useRecordingSearch hook design — reasonable
- VaultSearchFilter integration — accurate

### Plan 09 (Import Vault Selection) — MAJOR rewrite needed
- **ZoomImportDialog and GoogleImportDialog DO NOT EXIST**
- Zoom sync: vault_id needs to pass through `useIntegrationSync` → `zoom-sync-meetings` edge function
- Google sync: vault_id needs to pass through `useIntegrationSync` → `google-poll-sync` edge function
- YouTubeImportForm exists and can take VaultSelector — accurate
- VaultSelector component design — accurate
- Edge function updates — accurate in concept but file references for Zoom/Google are wrong

### Parallelization Opportunities
Plans currently run sequentially 01→02→03→04→05→06→07→08→09. Suggested parallel grouping:

**Wave A (Foundation — no dependencies):**
- Plan 01: Routing, sidebar, VaultsPage shell, useVaults hook, query keys, panel types

**Wave B (depends on Wave A):**
- Plan 02 (patched): Vault detail (recordings display + member panel)
- Plan 03: Vault CRUD dialogs
- Plan 07: Vault badges (independent UI components, but needs useVaultAssignment working)

**Wave C (depends on Wave B):**
- Plan 04 (patched): Member management (invite link, role changes)
- Plan 05 (patched): Business bank creation
- Plan 08: Search/filter within vaults

**Wave D (depends on Wave C):**
- Plan 09 (patched): Import vault selection
- Plan 06: Polish, migration, error states

## Open Questions

1. **TranscriptTable data shape:** TranscriptTable uses `Meeting` type from `@/types`. Vault recordings use `Recording` + `VaultEntry` from `@/types/bank`. Need to decide: (a) create adapter to map Recording→Meeting, or (b) create vault-specific recordings table component. Recommendation: create a lightweight adapter function.

2. **Vault invite token columns:** Need a migration to add `invite_token` and `invite_expires_at` to the `vaults` table. This is a small schema change, not a new table.

3. **Import flow integration points:** The Zoom/Google sync flow goes through `useIntegrationSync` → edge function. The VaultSelector needs to capture vault_id and pass it through this chain. Where exactly in the import UI should the selector appear?

## Sources

### Primary (HIGH confidence)
- All component files read directly from codebase
- All database migrations read directly
- All hook implementations verified

### Confidence Breakdown
| Area | Level | Reason |
|------|-------|--------|
| Existing components | HIGH | Direct file reads |
| Database schema | HIGH | Migration files read |
| Stale references | HIGH | File existence verified via glob |
| Pattern recommendations | HIGH | Based on existing code patterns |
| Parallelization suggestions | MEDIUM | Based on file dependency analysis, not tested |

**Research date:** 2026-02-09
**Valid until:** 2026-03-09 (stable codebase)
