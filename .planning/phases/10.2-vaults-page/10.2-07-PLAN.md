---
phase: 10.2-vaults-page
plan: 07
type: execute
wave: 2
depends_on: ["10.2-01"]
files_modified:
  - src/components/vault/VaultBadge.tsx
  - src/components/vault/VaultBadgeList.tsx
  - src/pages/CallDetailPage.tsx
  - src/components/transcript-library/TranscriptTable.tsx
autonomous: true

must_haves:
  truths:
    - "User sees vault badges on CallDetailPage showing which vaults the recording is in"
    - "User sees compact vault badges in transcript table rows"
    - "Badges are clickable and navigate to /vaults/:vaultId"
    - "Multiple vaults show as count + expand on hover/click"
    - "Personal vault badge is styled subtly vs team vaults (prominent)"
  artifacts:
    - path: "src/components/vault/VaultBadge.tsx"
      provides: "Single vault badge component"
      exports: ["VaultBadge"]
    - path: "src/components/vault/VaultBadgeList.tsx"
      provides: "List of vault badges with overflow handling"
      exports: ["VaultBadgeList"]
  key_links:
    - from: "CallDetailPage"
      to: "useVaultAssignment"
      via: "Hook to fetch vault entries for recording"
    - from: "VaultBadge"
      to: "/vaults/:vaultId"
      via: "Navigate on click"
    - from: "TranscriptTable"
      to: "VaultBadgeList"
      via: "Compact badges in table rows"
---

<objective>
Show vault membership badges on recordings throughout the app. Users can see at a glance which vaults a recording belongs to, navigate to those vaults, and distinguish between personal and team vaults. These are independent UI components that only need useVaultAssignment (already exists) and the /vaults route (from Plan 01).

Purpose: Make vault membership visible and actionable across the app, reinforcing the vault mental model.
Output: VaultBadge and VaultBadgeList components integrated into CallDetailPage and TranscriptTable.
</objective>

<execution_context>
@/Users/admin/.config/opencode/get-shit-done/workflows/execute-plan.md
</execution_context>

<context>
@/Users/admin/repos/brain/src/CLAUDE.md
@/Users/admin/repos/brain/src/hooks/useVaultAssignment.ts
@/Users/admin/repos/brain/src/pages/CallDetailPage.tsx
@/Users/admin/repos/brain/src/components/transcript-library/TranscriptTable.tsx
@/Users/admin/repos/brain/src/types/bank.ts
@/Users/admin/repos/brain/src/components/vault/AddToVaultMenu.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create VaultBadge and VaultBadgeList Components</name>
  <files>src/components/vault/VaultBadge.tsx, src/components/vault/VaultBadgeList.tsx</files>
  <action>
**VaultBadge Component:**
```tsx
interface VaultBadgeProps {
  vaultId: string;
  vaultName: string;
  vaultType: 'personal' | 'team' | 'coach' | 'client' | 'community';
  size?: 'sm' | 'md' | 'lg';
  onClick?: () => void;
  className?: string;
}
```

Styling by Type (Claude's Discretion — design choices):
- Personal vault: Subtle — bg-muted, text-muted-foreground, no border, RiUserLine icon
- Team/Coach/Client: Prominent — bg-card, border-border, hover:border-vibe-orange/50, RiSafeLine icon
- Active/current context: 3px vibe orange left edge indicator

Sizes:
- sm: h-6 text-xs (table rows)
- md: h-7 text-sm (default, cards)
- lg: h-8 text-sm (detail headers)

Interactions:
- Clickable: navigate to /vaults/:vaultId on click
- Tooltip on hover showing full vault name (if truncated)
- aria-label: "In vault: {vaultName}"

**VaultBadgeList Component:**
```tsx
interface VaultBadgeListProps {
  recordingId: string;
  maxVisible?: number; // Default: 3
  size?: 'sm' | 'md';
  className?: string;
}
```

- Uses useVaultAssignment hook to fetch vault entries for the recording
- Uses useBankContext to get vault details (name, type) from bank context
- Shows up to maxVisible badges, then "+N" overflow badge
- Click overflow badge: popover with all vaults listed
- Personal vault always first, always subtle styling
- Loading: 2-3 small skeleton rectangles
- Empty: nothing rendered (no badges if not in any vault)
  </action>
  <verify>Components render all sizes/types correctly. Click navigates. Overflow popover works.</verify>
  <done>VaultBadge and VaultBadgeList with proper styling, navigation, and overflow handling</done>
</task>

<task type="auto">
  <name>Task 2: Integrate Badges into CallDetailPage and TranscriptTable</name>
  <files>src/pages/CallDetailPage.tsx, src/components/transcript-library/TranscriptTable.tsx</files>
  <action>
**CallDetailPage:**
- Add VaultBadgeList in metadata area (below title row, after date/sentiment badges)
- Pass recordingId from the current call
- Size: 'md' for detail page
- MaxVisible: 3
- Loading skeleton while vaults load (don't shift layout)
- Badges update automatically when recording added/removed from vaults (useVaultAssignment handles cache)

**TranscriptTable:**
- Add "Vaults" column (120-150px width) — position after existing columns
- Cell content: VaultBadgeList with size='sm', maxVisible=2
- Only show non-personal vaults in table (personal is implied)
- If only in personal vault: show nothing or dash "-"
- Click badge: navigates to vault (stopPropagation to prevent row click)
- Performance: memoize vault lookup, badges are lightweight

NOTE: TranscriptTable uses Meeting type. The recordingId for VaultBadgeList needs to be the recording UUID, not the legacy fathom_calls recording_id. Check how recordings map — if TranscriptTable rows have a recording UUID available (from prior migration), use that. If only legacy recording_id is available, useVaultAssignment may need to accept it and do a lookup. Decide based on what data is actually available on Meeting rows.
  </action>
  <verify>CallDetailPage shows vault badges. TranscriptTable has Vaults column. Clicks navigate correctly without triggering row selection.</verify>
  <done>Vault badges visible on CallDetailPage and in TranscriptTable rows with proper navigation</done>
</task>

</tasks>

<verification>
- [ ] VaultBadge renders all sizes (sm, md, lg) correctly
- [ ] Personal vault badge uses subtle styling
- [ ] Team vaults use prominent styling
- [ ] Clicking badge navigates to /vaults/:vaultId
- [ ] CallDetailPage shows vault badges in metadata area
- [ ] TranscriptTable has Vaults column with compact badges
- [ ] Multiple vaults show as count + popover
- [ ] TypeScript compiles without errors
</verification>

<success_criteria>
Users can see vault membership at a glance on CallDetailPage and in the transcript table. Badges distinguish personal vs team vaults, support navigation, and handle multiple vault membership with overflow.
</success_criteria>

<output>
After completion, create `.planning/phases/10.2-vaults-page/10.2-07-SUMMARY.md`
</output>
