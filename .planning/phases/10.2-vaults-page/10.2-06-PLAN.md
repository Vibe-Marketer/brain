---
phase: 10.2-vaults-page
plan: 06
type: execute
wave: 4
depends_on: ["10.2-04", "10.2-05"]
files_modified:
  - src/pages/VaultsPage.tsx
  - src/components/panes/VaultListPane.tsx
  - src/components/panes/VaultDetailPane.tsx
  - src/components/panels/VaultMemberPanel.tsx
  - src/components/settings/BanksTab.tsx
  - src/components/settings/VaultManagement.tsx
  - src/App.tsx
autonomous: false

must_haves:
  truths:
    - "Legacy /team route redirects to /vaults"
    - "All vault views have proper empty states"
    - "Error boundaries catch and display errors gracefully"
    - "Settings Banks tab links to Vaults page for vault management"
    - "Mobile experience is fully functional"
  artifacts:
    - path: "src/pages/VaultsPage.tsx"
      provides: "Polished page with error boundaries"
  key_links:
    - from: "/team"
      to: "/vaults"
      via: "Navigate replace"
    - from: "Settings BanksTab"
      to: "/vaults"
      via: "Link: 'Manage vaults in the Vaults page'"
---

<objective>
Polish the Vaults feature: add empty states and error handling throughout, migrate settings references, ensure mobile responsiveness, and final cleanup. This is the quality gate before shipping.

Purpose: Ship a production-ready Vaults feature that fully replaces Collaboration with proper error handling and mobile support.
Output: Complete feature with error handling, empty states, settings migration, and mobile polish.
</objective>

<execution_context>
@/Users/admin/.config/opencode/get-shit-done/workflows/execute-plan.md
</execution_context>

<context>
@/Users/admin/repos/brain/src/CLAUDE.md
@/Users/admin/repos/brain/src/components/settings/BanksTab.tsx
@/Users/admin/repos/brain/src/components/settings/VaultManagement.tsx
@/Users/admin/repos/brain/src/pages/Settings.tsx
@.planning/phases/10.2-vaults-page/10.2-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Empty States, Error Boundaries, and Settings Migration</name>
  <files>src/components/panes/VaultListPane.tsx, src/components/panes/VaultDetailPane.tsx, src/components/panels/VaultMemberPanel.tsx, src/pages/VaultsPage.tsx, src/components/settings/BanksTab.tsx, src/components/settings/VaultManagement.tsx</files>
  <action>
**Empty States for all views:**

VaultListPane — No Vaults:
- Icon: RiSafeLine (large, muted h-16 w-16 text-muted-foreground/50)
- Title: "No vaults yet" (font-montserrat uppercase)
- Description: "Create your first vault to start collaborating"
- Action: Create Vault button

VaultDetailPane — No Vault Selected:
- Icon: RiArrowLeftLine
- Title: "Select a vault" 
- Description: "Choose a vault from the list to view recordings and members"

VaultDetailPane — No Recordings:
- Icon: RiMicLine
- Title: "No recordings in this vault"
- Description: "Recordings you add to this vault will appear here"
- Action: "Go to Library" button

VaultMemberPanel — No Members:
- Icon: RiTeamLine
- Title: "No members yet"
- Description: "Invite team members to collaborate"
- Action: Invite Members button

**Error Boundary (VaultsPage):**
- Wrap main content in ErrorBoundary (from react-error-boundary)
- Fallback: Error icon, "Something went wrong", error message, "Try Again" + "Go Home" buttons
- Query error states: retry buttons on vault list/detail/recording failures
- All mutations show error toasts

**Settings Migration:**
BanksTab: Add banner "Vault management has moved to the Vaults page" with "Go to Vaults" button
VaultManagement: Add deprecation notice + link to /vaults

**Final Code Quality:**
- Remove console.logs
- Ensure no TypeScript errors (npm run typecheck)
- All buttons have aria-labels
- Focus indicators visible (vibe orange)
- Page title: "Vaults | CallVault"
  </action>
  <verify>All empty states render. Error boundary catches thrown errors. Settings shows migration banner. npm run typecheck passes.</verify>
  <done>Empty states, error boundaries, settings migration, and code quality polish complete</done>
</task>

<task type="checkpoint:human-verify">
  <name>Task 2: Full Feature Verification</name>
  <what-built>
Complete Vaults page with:
- Vault list with bank filtering
- Vault detail with recordings (no tabs)
- Member panel (4th pane slide-in)
- Vault CRUD (create/edit/delete)
- Shareable invite links (/join/vault/:token)
- Role management (5-level hierarchy)
- Business bank creation (from both CTA and BankSwitcher)
- Empty states and error handling
- Mobile responsive layout
  </what-built>
  <how-to-verify>
1. Open http://localhost:8080/vaults
2. Verify sidebar shows "Vaults" (not "Collaboration")
3. Verify vault list shows only active bank's vaults
4. Switch banks in header — vault list updates
5. Select a vault — recordings show in main content (NO tabs)
6. Click "Members" — panel slides in from right
7. Create a new vault — dialog, fills list, auto-selects
8. Edit vault name from detail header
9. Generate invite link — copy and verify /join/vault/:token format
10. Create a business bank — auto-switches, shows default vault
11. Open Chrome DevTools → iPhone 14 Pro viewport
12. Verify mobile layout: vault list overlay, full-screen detail, member bottom sheet
13. Navigate to /team — should redirect to /vaults
14. Open Settings → Banks tab — shows "Vault management moved" banner
  </how-to-verify>
  <resume-signal>Type "approved" or list issues found</resume-signal>
</task>

</tasks>

<verification>
- [ ] All empty states implemented
- [ ] Error boundaries in place
- [ ] Settings shows link to Vaults page
- [ ] /team redirects to /vaults
- [ ] Mobile experience verified
- [ ] Page title shows "Vaults | CallVault"
- [ ] No TypeScript errors
- [ ] No console errors
</verification>

<success_criteria>
Vaults feature is production-ready with proper error handling, empty states, mobile support, settings migration, and clean deprecation of the Collaboration page.
</success_criteria>

<output>
After completion, create `.planning/phases/10.2-vaults-page/10.2-06-SUMMARY.md`
</output>
