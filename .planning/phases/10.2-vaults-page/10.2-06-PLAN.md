---
phase: 10.2-vaults-page
plan: 06
type: execute
wave: 6
depends_on: ["10.2-05"]
files_modified:
  - src/pages/CollaborationPage.tsx
  - src/components/panes/CollaborationCategoryPane.tsx
  - src/components/settings/BanksTab.tsx
  - src/components/settings/VaultManagement.tsx
  - src/pages/VaultsPage.tsx
  - src/components/panes/VaultDetailPane.tsx
  - src/components/panes/VaultListPane.tsx
autonomous: false

must_haves:
  truths:
    - "Legacy Collaboration page redirects to Vaults"
    - "All vault operations have proper empty states"
    - "Error boundaries catch and display errors gracefully"
    - "Settings Banks tab links to Vaults page"
    - "Mobile experience is fully functional"
  artifacts:
    - path: "src/pages/CollaborationPage.tsx"
      provides: "Legacy redirect component"
      exports: ["default"]
  key_links:
    - from: "/team"
      to: "/vaults"
      via: "Navigate replace"
---

<objective>
Polish the Vaults feature: migrate legacy settings, add empty states and error handling, ensure mobile responsiveness, and deprecate the old Collaboration page.

Purpose: Ship a production-ready Vaults feature that fully replaces Collaboration.
Output: Complete feature with error handling, empty states, mobile polish, and clean deprecation path.
</objective>

<execution_context>
@/Users/admin/.config/opencode/get-shit-done/workflows/execute-plan.md
</execution_context>

<context>
@/Users/admin/repos/brain/src/CLAUDE.md
@/Users/admin/repos/brain/src/pages/CollaborationPage.tsx
@/Users/admin/repos/brain/src/components/settings/BanksTab.tsx
@/Users/admin/repos/brain/src/components/settings/VaultManagement.tsx
@/Users/admin/repos/brain/src/pages/Settings.tsx
</context>

<tasks>

<task type="auto">
  <name>Add Empty States to All Views</name>
  <files>src/components/panes/VaultListPane.tsx, src/components/panes/VaultDetailPane.tsx, src/components/panels/VaultMemberPanel.tsx</files>
  <action>
Design and implement empty states for all views:

**VaultListPane - No Vaults:**
- Icon: RiSafeLine (large, muted)
- Title: "No vaults yet"
- Description: "Create your first vault to start collaborating"
- Action: Create Vault button

**VaultListPane - No Business Banks:**
- Icon: RiBuilding4Line
- Title: "No business banks"
- Description: "Create a business bank to collaborate with your team"
- Action: Create Business Bank button

**VaultDetailPane - No Recordings:**
- Icon: RiMicLine (recording icon)
- Title: "No recordings in this vault"
- Description: "Recordings you add to this vault will appear here"
- Action: "Go to Library" button (links to home)
- Secondary: "Import Calls" button

**VaultDetailPane - No Vault Selected:**
- Icon: RiArrowLeftLine (pointing to list)
- Title: "Select a vault"
- Description: "Choose a vault from the list to view recordings and members"
- Visual: Show vault list preview or arrow animation

**VaultMemberPanel - No Members:**
- Icon: RiTeamLine
- Title: "No members yet"
- Description: "Invite team members to collaborate in this vault"
- Action: Invite Members button

**VaultMemberPanel - Pending Only:**
- Show pending section with "Awaiting response" subtitle

**Empty State Design:**
- Centered content
- Large muted icon (h-16 w-16 text-muted-foreground/50)
- Title: font-montserrat uppercase
- Description: text-muted-foreground
- Action button below
- Minimum height to avoid layout shift
  </action>
  <verify>All empty states render correctly, actions work</verify>
  <done>Empty states for all vault views</done>
</task>

<task type="auto">
  <name>Implement Error Boundaries and Error States</name>
  <files>src/pages/VaultsPage.tsx, src/components/panes/VaultDetailPane.tsx</files>
  <action>
Add error handling throughout:

**Error Boundary (VaultsPage):**
- Wrap main content in ErrorBoundary
- Fallback UI with:
  - Error icon (RiErrorWarningLine)
  - "Something went wrong"
  - Error message (if available)
  - "Try Again" button (resets error boundary)
  - "Go Home" link

**Query Error States:**
- If vault list fails to load:
  - Show error state in VaultListPane
  - Retry button
  - Contact support link

- If vault detail fails:
  - Show error in main content
  - "Unable to load vault"
  - Back to vault list button

- If recordings fail to load:
  - Show error in table area
  - Retry button

**Error Logging:**
- Log errors to console with context
- Include vault ID, user ID, timestamp
- No sensitive data in logs

**Toast Error Handling:**
- All mutations show error toasts
- User-friendly error messages
- Action suggestions when applicable
  </action>
  <verify>Error states render, retry works, toasts show</verify>
  <done>Error boundaries and error states throughout</done>
</task>

<task type="auto">
  <name>Migrate Settings Banks Tab</name>
  <files>src/components/settings/BanksTab.tsx, src/components/settings/VaultManagement.tsx</files>
  <action>
Update BanksTab to link to new Vaults page:

**BanksTab Changes:**
- Add banner at top: "Vault management has moved"
- "Manage your vaults and members in the new Vaults page"
- "Go to Vaults" button (navigates to /vaults)

**VaultManagement (in Settings):**
- Add deprecation notice
- Keep for reference but reduce prominence
- "Vault management is now in the Vaults page"
- Link to /vaults

**Simplify BanksTab:**
- Keep bank list (read-only overview)
- Remove vault creation from settings
- Keep basic bank info display
- Focus on bank-level settings only

**Settings Detail Pane:**
- Remove Team tab reference if still there
- Ensure Settings nav doesn't show vault management

**Migration Path:**
- Users familiar with settings-based vault management get directed to new location
- No functionality removed, just relocated
  </action>
  <verify>Settings shows link to Vaults, no duplicate functionality</verify>
  <done>Settings BanksTab migrated to reference Vaults page</done>
</task>

<task type="auto">
  <name>Deprecate Collaboration Page</name>
  <files>src/pages/CollaborationPage.tsx, src/App.tsx</files>
  <action>
Convert CollaborationPage to redirect:

**CollaborationPage.tsx:**
```tsx
import { useEffect } from 'react';
import { useNavigate } from 'react-router-dom';

export default function CollaborationPage() {
  const navigate = useNavigate();
  
  useEffect(() => {
    // Redirect to new Vaults page
    navigate('/vaults', { replace: true });
  }, [navigate]);
  
  return null; // Or loading spinner
}
```

**App.tsx:**
- Keep /team route but redirect to /vaults
- Add comment: "Legacy route - redirects to /vaults"
- Remove CollaborationPage import (use inline redirect)

**CollaborationCategoryPane.tsx:**
- Add deprecation comment
- Keep file for reference but mark as deprecated
- Future: delete after full migration

**CollaborationDetailPane.tsx:**
- Same treatment
- Mark as deprecated

**Analytics/Logging:**
- Track /team route hits to monitor legacy usage
- If significant traffic after 30 days, investigate why
  </action>
  <verify>/team redirects to /vaults, no 404s</verify>
  <done>Collaboration page deprecated with redirect</done>
</task>

<task type="checkpoint:human-verify">
  <name>Mobile Experience Verification</name>
  <what-built>
Complete mobile-responsive Vaults page with:
- Collapsible vault list overlay on mobile
- Full-screen vault detail view
- Touch-friendly action buttons
- Bottom sheet for member panel
- Swipe gestures where applicable
  </what-built>
  <how-to-verify>
1. Open Chrome DevTools
2. Set device to iPhone 14 Pro (393x852)
3. Navigate to http://localhost:8080/vaults
4. Verify:
   - Vault list shows as overlay
   - Can select vault
   - Detail view is full-screen
   - Member panel opens as bottom sheet
   - All buttons are tappable (min 44px)
   - Text is readable (no horizontal scroll)
5. Repeat with iPad (tablet) viewport
6. Test orientation change (portrait â†” landscape)
  </how-to-verify>
  <resume-signal>Type "approved" or list mobile issues found</resume-signal>
</task>

<task type="auto">
  <name>Final Polish and Performance</name>
  <files>src/pages/VaultsPage.tsx, src/components/panes/VaultListPane.tsx, src/components/panes/VaultDetailPane.tsx</files>
  <action>
Final polish items:

**Performance:**
- Virtualize long recording lists (react-window)
- Debounce search inputs (300ms)
- Lazy load member avatars
- Prefetch vault details on hover (optional)

**Accessibility:**
- All buttons have aria-labels
- Focus indicators visible (vibe orange)
- Keyboard navigation works (Tab, Enter, Escape)
- Screen reader announcements for actions
- Color contrast meets WCAG 2.1 AA

**Animations:**
- Smooth transitions between vaults (500ms)
- Loading skeletons match content shape
- Toast animations (slide in/out)
- Dialog open/close animations

**Meta:**
- Page title: "Vaults | CallVault"
- Update document.title on vault change
- Favicon consistent

**Code Quality:**
- Remove console.logs
- Add JSDoc comments to public functions
- Ensure no TypeScript errors (npm run typecheck)
- ESLint passes (npm run lint)

**Testing Checklist:**
- Create vault
- Delete vault
- Invite member
- Change role
- Remove member
- Create business bank
- Switch banks
- Mobile navigation
- Error states
  </action>
  <verify>All checks pass, no console errors, performance acceptable</verify>
  <done>Final polish complete</done>
</task>

</tasks>

<verification>
- [ ] All empty states implemented
- [ ] Error boundaries in place
- [ ] Settings links to Vaults
- [ ] /team redirects to /vaults
- [ ] Mobile experience verified
- [ ] Performance optimized
- [ ] Accessibility checked
- [ ] TypeScript compiles
- [ ] No console errors
</verification>

<success_criteria>
Vaults feature is production-ready with proper error handling, empty states, mobile support, and clean migration from the deprecated Collaboration page.
</success_criteria>

<output>
After completion, create `.planning/phases/10.2-vaults-page/10.2-06-SUMMARY.md`
</output>
