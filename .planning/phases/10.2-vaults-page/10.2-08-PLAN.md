---
phase: 10.2-vaults-page
plan: 08
type: execute
wave: 3
depends_on: ["10.2-02"]
files_modified:
  - src/components/vault/VaultSearchFilter.tsx
  - src/hooks/useRecordingSearch.ts
  - src/components/panes/VaultDetailPane.tsx
autonomous: true

must_haves:
  truths:
    - "User can search recordings within a vault by title"
    - "User can filter by date range and sort by date/duration/title"
    - "Search is debounced (300ms) for performance"
    - "Empty state shows when no results match filters"
    - "Clear filters button resets all filters"
  artifacts:
    - path: "src/components/vault/VaultSearchFilter.tsx"
      provides: "Search input and filter controls for vault recordings"
      exports: ["VaultSearchFilter"]
    - path: "src/hooks/useRecordingSearch.ts"
      provides: "Search and filter logic for recordings"
      exports: ["useRecordingSearch"]
  key_links:
    - from: "VaultSearchFilter"
      to: "useRecordingSearch"
      via: "Filter state management"
    - from: "VaultDetailPane"
      to: "VaultSearchFilter"
      via: "Toolbar above recordings table"
---

<objective>
Enable search and filtering of recordings within a vault. Users can search by title, filter by date range, and sort results. This makes vault content discoverable as the number of recordings grows.

Purpose: Make vault content manageable and findable at scale.
Output: Search/filter toolbar integrated into vault detail view.
</objective>

<execution_context>
@/Users/admin/.config/opencode/get-shit-done/workflows/execute-plan.md
</execution_context>

<context>
@/Users/admin/repos/brain/src/CLAUDE.md
@/Users/admin/repos/brain/src/components/panes/VaultDetailPane.tsx
@/Users/admin/repos/brain/src/hooks/useVaults.ts
@/Users/admin/repos/brain/src/lib/query-config.ts
@.planning/phases/10.2-vaults-page/10.2-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useRecordingSearch Hook</name>
  <files>src/hooks/useRecordingSearch.ts</files>
  <action>
Create search and filter hook for vault recordings:

```tsx
interface RecordingFilters {
  searchQuery: string;        // Search in title
  dateRange: { start: Date | null; end: Date | null };
  sortBy: 'date' | 'duration' | 'title';
  sortOrder: 'asc' | 'desc';
}

interface UseRecordingSearchOptions {
  vaultId: string | null;
  recordings: VaultRecording[]; // From useVaultRecordings
}

interface UseRecordingSearchResult {
  filters: RecordingFilters;
  setSearchQuery: (query: string) => void;
  setDateRange: (start: Date | null, end: Date | null) => void;
  setSort: (sortBy: 'date' | 'duration' | 'title', order?: 'asc' | 'desc') => void;
  clearFilters: () => void;
  hasActiveFilters: boolean;
  filteredRecordings: VaultRecording[];
  totalCount: number;
  filteredCount: number;
}
```

Search: Client-side filtering on recording.title (case-insensitive). Debounce by 300ms using useMemo or custom useDebounce.

Filter: Date range on recording.created_at. Duration not needed for MVP (simplify from original plan).

Sort: date (created_at), duration (duration_seconds), title (case-insensitive alpha).

hasActiveFilters: True if any filter differs from default. Used to show "Clear Filters" button.

Keep it simple — client-side filtering. Server-side can be added later if datasets exceed ~1000 recordings.
  </action>
  <verify>Hook filters recordings correctly. Debounce works. Clear resets all filters.</verify>
  <done>useRecordingSearch hook with search, date filter, sort, and clear functionality</done>
</task>

<task type="auto">
  <name>Task 2: Create VaultSearchFilter Component and Integrate into VaultDetailPane</name>
  <files>src/components/vault/VaultSearchFilter.tsx, src/components/panes/VaultDetailPane.tsx</files>
  <action>
**VaultSearchFilter Component:**
Toolbar layout: Search input (flex-1) + Sort dropdown + Clear button
- Sticky at top of recordings list
- Background: bg-card with border-b

Search Input:
- Placeholder: "Search recordings..."
- Left icon: RiSearchLine
- Clear button (X) when text entered
- 300ms debounce indicator (subtle spinner)

Sort Dropdown:
- Options: Date (newest/oldest), Duration (longest/shortest), Title (A-Z/Z-A)
- Default: Date (newest)
- Using existing Select/DropdownMenu components

Date Filter (optional — only if complexity allows within context):
- Simple presets: All Time, This Week, This Month, Last 30 Days
- Or skip entirely and ship in gap closure if needed

Clear Filters:
- Only visible when hasActiveFilters
- Hollow button with RiCloseLine

Results Count:
- "Showing X of Y recordings" below toolbar when filters active

**VaultDetailPane Integration:**
Insert VaultSearchFilter toolbar between header and recordings table:
```tsx
<VaultPaneHeader />
<VaultSearchFilter filters={filters} ... />
{filteredRecordings.length > 0 ? (
  <TranscriptTable recordings={mappedRecordings} />
) : hasActiveFilters ? (
  <EmptyFilterState onClear={clearFilters} />
) : (
  <EmptyVaultState />
)}
```

EmptyFilterState: "No recordings match your search" + "Clear filters" button
  </action>
  <verify>Search filters recordings in real-time. Sort changes order. Clear resets. Empty filter state shows correctly.</verify>
  <done>VaultSearchFilter integrated into VaultDetailPane with search, sort, and clear functionality</done>
</task>

</tasks>

<verification>
- [ ] Search input debounces at 300ms
- [ ] Search filters by recording title
- [ ] Sort by date/duration/title works
- [ ] Clear filters button resets all
- [ ] Empty state shows when no results match
- [ ] Results count shows "X of Y" when filtering
- [ ] TypeScript compiles without errors
</verification>

<success_criteria>
Users can search and filter vault recordings by title, sort by date/duration/title. Clear feedback on active filters and results count. Simple, fast client-side implementation.
</success_criteria>

<output>
After completion, create `.planning/phases/10.2-vaults-page/10.2-08-SUMMARY.md`
</output>
