---
phase: 10.2-vaults-page
plan: 05
subsystem: business-bank-creation
tags: [react, business-bank, bank-switcher, vault-list-pane, useBankMutations, dialog]

# Dependency graph
requires:
  - phase: 10.2-vaults-page
    plan: 01
    provides: VaultListPane, /vaults routing, useBankContext
  - phase: 10.2-vaults-page
    plan: 03
    provides: CreateVaultDialog pattern reference
provides:
  - CreateBusinessBankDialog for full bank configuration
  - useCreateBusinessBank mutation hook
  - Business bank creation entry points in VaultListPane and BankSwitcher
  - BankSwitcher grouped by personal/business with section labels
affects: [10.2-06]

# Tech tracking
tech-stack:
  added: []
  patterns:
    - "Multi-step mutation: bank + membership + vault + vault membership in single mutationFn"
    - "Post-mutation auto-switch via useBankContext.switchBank"
    - "Collapsible advanced settings section in dialog"
    - "BankSwitcher sections: personal first, business banks labeled"

# File tracking
key-files:
  created:
    - src/hooks/useBankMutations.ts
    - src/components/dialogs/CreateBusinessBankDialog.tsx
  modified:
    - src/components/panes/VaultListPane.tsx
    - src/components/header/BankSwitcher.tsx

key-decisions:
  - "No billing gate for MVP (per plan locked decision)"
  - "Default vault auto-created as 'team' type with bank name"
  - "Cross-bank default collapsed in Advanced section, defaults to copy_only"
  - "No bank settings on Vaults page (per locked decision) — settings in Settings page only"
  - "BankSwitcher shows Create Business Bank for ALL users (not just personal bank context)"

patterns-established:
  - "useBankMutations: bank creation with auto-switch + navigation pattern"
  - "BankSwitcher grouped sections: personal → business banks → actions"

# Metrics
duration: 3min
completed: 2026-02-10
---

# Phase 10.2 Plan 05: Business Bank Creation Summary

**Business bank creation from both VaultListPane CTA and BankSwitcher, with full config dialog and auto-switch to new bank**

## Performance

- **Duration:** ~3 min
- **Started:** 2026-02-10T00:12:00Z
- **Completed:** 2026-02-10T00:15:00Z
- **Tasks:** 2/2 complete
- **Files created:** 2
- **Files modified:** 2

## Accomplishments

- Created useBankMutations hook with useCreateBusinessBank: creates bank (type=business), bank_membership (bank_owner), default vault (team), vault_membership (vault_owner)
- Created CreateBusinessBankDialog with name (3-50 chars), default vault name, collapsible advanced cross-bank settings
- Added "Create Business Bank" CTA button at bottom of VaultListPane
- Enhanced BankSwitcher with personal/business sections, "Business Banks" label, empty state, and Create Business Bank option opening dialog
- Removed old Pro badge and settings redirect from BankSwitcher Create Business Bank (no billing gate for MVP)
- Post-creation: auto-switch to new bank, navigate to /vaults, toast confirmation

## Task Commits

Each task was committed atomically:

1. **Task 1: Create useBankMutations Hook + CreateBusinessBankDialog** - `618f4be` (feat)
2. **Task 2: Wire Business Bank Creation into VaultListPane and BankSwitcher** - `1c15f5d` (feat)

## Files Created/Modified

- `src/hooks/useBankMutations.ts` - useCreateBusinessBank mutation hook (118 lines)
- `src/components/dialogs/CreateBusinessBankDialog.tsx` - Business bank creation dialog (222 lines)
- `src/components/panes/VaultListPane.tsx` - Added Create Business Bank CTA + dialog
- `src/components/header/BankSwitcher.tsx` - Personal/business sections, dialog trigger, empty state

## Decisions Made

- **No billing gate** — plan locked decision, business banks free for MVP
- **Default vault = team type** — business banks auto-create a team vault named "{Bank Name}'s Vault"
- **Cross-bank default in Advanced** — most users won't need to change from "copy_only"
- **Create available to all users** — not restricted to personal bank context anymore
- **No bank settings on Vaults page** — locked decision, settings in Settings page only

## Deviations from Plan

None — plan executed exactly as written.

## Issues Encountered

None

## User Setup Required

None — no external service configuration required.

## Next Phase Readiness

- Business bank creation complete from both entry points
- BankSwitcher properly groups personal and business banks
- Ready for 10.2-06 (Polish & Final Verification)

## Self-Check: PASSED

---
*Phase: 10.2-vaults-page*
*Completed: 2026-02-10*
