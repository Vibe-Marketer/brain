---
phase: 14-foundation
plan: 05
type: execute
wave: 5
depends_on: ["14-04"]
files_modified:
  - /Users/Naegele/dev/callvault/.github/workflows/ci.yml
  - /Users/Naegele/dev/callvault/src/routes/_authenticated.tsx
autonomous: false
user_setup:
  - service: supabase
    why: "Auth redirect allowlist must include new domain before any user access"
    env_vars: []
    dashboard_config:
      - task: "Add new Vercel domain to Supabase URL Configuration redirect allowlist"
        location: "Supabase Dashboard -> Authentication -> URL Configuration -> Redirect URLs"
      - task: "Verify Google OAuth consent screen does NOT include Meet scopes"
        location: "Google Cloud Console -> APIs & Services -> OAuth consent screen"
  - service: vercel
    why: "New Vercel project for v2 deployment"
    env_vars:
      - name: VITE_SUPABASE_URL
        source: "Copy from brain/.env — the value of VITE_SUPABASE_URL (starts with https://)"
      - name: VITE_SUPABASE_PUBLISHABLE_KEY
        source: "Copy from brain/.env — use VITE_SUPABASE_PUBLISHABLE_KEY (NOT VITE_SUPABASE_PUBLISHABLE_DEFAULT_KEY). The correct key starts with 'eyJ'. WARNING: brain/.env contains both VITE_SUPABASE_PUBLISHABLE_KEY and VITE_SUPABASE_PUBLISHABLE_DEFAULT_KEY — use the one WITHOUT 'DEFAULT' in the name."
    dashboard_config:
      - task: "Create new Vercel project pointing at Vibe-Marketer/callvault repo"
        location: "Vercel Dashboard -> New Project"
  - service: github
    why: "New GitHub repo for v2 codebase"
    dashboard_config:
      - task: "Create Vibe-Marketer/callvault repo on GitHub"
        location: "GitHub -> New Repository"
  - service: fathom
    why: "Audit Fathom site config for new domain"
    dashboard_config:
      - task: "Verify Fathom callback URLs reference correct domains"
        location: "Fathom Analytics dashboard"
  - service: zoom
    why: "Audit Zoom OAuth callback URLs for new domain"
    dashboard_config:
      - task: "Verify Zoom OAuth app callback URLs include new Vercel domain"
        location: "Zoom Marketplace -> Manage -> Your Apps -> CallVault -> OAuth"
must_haves:
  truths:
    - "GitHub repo Vibe-Marketer/callvault exists with all code pushed"
    - "Vercel project is created and first deployment succeeds"
    - "New Vercel domain is added to Supabase redirect allowlist"
    - "User can sign in on deployed Vercel URL with existing Supabase account"
    - "Fathom and Zoom OAuth callback URLs are audited for new domain"
    - "Google OAuth consent screen has no Meet scopes"
  artifacts:
    - path: "/Users/Naegele/dev/callvault/.github/workflows/ci.yml"
      provides: "CI workflow for type checking and build"
      contains: "pnpm build"
  key_links:
    - from: "Vercel deployment"
      to: "Supabase Auth"
      via: "Redirect allowlist includes new domain"
      pattern: "callvault.*vercel.*app"
    - from: "Google OAuth"
      to: "Supabase Auth callback"
      via: "Authorized redirect URIs include Supabase project URL"
      pattern: "supabase.co/auth/v1/callback"
---

<objective>
Deploy to production, configure auth allowlists, and verify the complete foundation.

Purpose: FOUND-07 (Supabase redirect allowlist), FOUND-08 (Fathom and Zoom OAuth audit), GitHub repo creation, Vercel deployment, and end-to-end auth verification on the deployed URL.
Output: Live deployed v2 at a Vercel URL. Existing user can sign in. All OAuth callback URLs audited. GitHub repo live.
</objective>

<execution_context>
@/Users/Naegele/.claude/get-shit-done/workflows/execute-plan.md
@/Users/Naegele/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@/Users/Naegele/dev/brain/.planning/ROADMAP.md
@/Users/Naegele/dev/brain/.planning/phases/14-foundation/14-RESEARCH.md
@/Users/Naegele/dev/brain/.planning/phases/14-foundation/14-CONTEXT.md
@/Users/Naegele/dev/brain/.planning/phases/14-foundation/14-04-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create GitHub repo, CI workflow, and push</name>
  <files>
    /Users/Naegele/dev/callvault/.github/workflows/ci.yml
  </files>
  <action>
    1. Create GitHub repo via CLI:
       ```
       cd /Users/Naegele/dev/callvault
       gh repo create Vibe-Marketer/callvault --private --source=. --remote=origin
       ```
       If the repo already exists, just add remote: `git remote add origin https://github.com/Vibe-Marketer/callvault.git`

    2. Create `.github/workflows/ci.yml` — minimal CI:
       ```yaml
       name: CI
       on:
         push:
           branches: [main]
         pull_request:
           branches: [main]
       jobs:
         build:
           runs-on: ubuntu-latest
           steps:
             - uses: actions/checkout@v4
             - uses: pnpm/action-setup@v4
               with:
                 version: 9
             - uses: actions/setup-node@v4
               with:
                 node-version: '22'
                 cache: 'pnpm'
             - run: pnpm install --frozen-lockfile
             - run: pnpm build
       ```
       This validates TypeScript compilation and build success on every push.

    3. Commit everything and push to main:
       ```
       git add -A
       git commit -m "feat(14): foundation — scaffold, auth, AppShell, routes"
       git push -u origin main
       ```

    4. Verify push succeeded: `gh repo view Vibe-Marketer/callvault`
  </action>
  <verify>
    - `gh repo view Vibe-Marketer/callvault` shows the repo exists
    - `git log --oneline -5` shows commits pushed
    - `ls /Users/Naegele/dev/callvault/.github/workflows/ci.yml` exists
  </verify>
  <done>GitHub repo Vibe-Marketer/callvault exists with all code pushed. CI workflow runs type check and build on push.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Deploy to Vercel, configure auth allowlists, verify end-to-end</name>
  <what-built>
    Complete v2 foundation: new repo with auth, AppShell, all routes, pushed to GitHub. Now needs deployment and OAuth configuration that requires dashboard access.
  </what-built>
  <how-to-verify>
    The following steps require human action in external dashboards:

    **Step 1: Create Vercel project**
    1. Go to https://vercel.com/new
    2. Import the `Vibe-Marketer/callvault` repo
    3. Set environment variables:
       - `VITE_SUPABASE_URL` = (copy the value of VITE_SUPABASE_URL from brain/.env)
       - `VITE_SUPABASE_PUBLISHABLE_KEY` = (copy the value of VITE_SUPABASE_PUBLISHABLE_KEY from brain/.env)
       - WARNING: brain/.env contains BOTH `VITE_SUPABASE_PUBLISHABLE_KEY` and `VITE_SUPABASE_PUBLISHABLE_DEFAULT_KEY`. Use `VITE_SUPABASE_PUBLISHABLE_KEY` (the one WITHOUT "DEFAULT" in the name). The correct value starts with "eyJ".
    4. Deploy. Note the Vercel URL (e.g., `callvault.vercel.app` or similar)

    **Step 2: Add Vercel domain to Supabase redirect allowlist (FOUND-07)**
    1. Go to Supabase Dashboard -> Authentication -> URL Configuration
    2. Under "Redirect URLs", add:
       - `https://{your-vercel-url}/oauth/callback`
       - `https://{your-vercel-url}/**` (wildcard for all routes)
    3. Save changes
    4. IMPORTANT: Do NOT change SITE_URL — keep it pointing to v1 until hard cutover

    **Step 3: Verify Google OAuth has no Meet scopes (FOUND-09)**
    1. Go to Google Cloud Console -> APIs & Services -> OAuth consent screen
    2. Verify the scopes list does NOT include:
       - `https://www.googleapis.com/auth/calendar.events.readonly`
       - `https://www.googleapis.com/auth/calendar.readonly`
       - Any scope with "meet" or "calendar" in the name
    3. If Meet scopes exist: remove them (v2 has no Google Meet integration)

    **Step 4: Audit Fathom and Zoom OAuth (FOUND-08)**
    1. Fathom: Go to your Fathom Analytics dashboard
       - Note current callback URLs
       - If Fathom has OAuth callbacks referencing brain domain, note for later update
    2. Zoom: Go to Zoom Marketplace -> Manage -> Your Apps -> CallVault
       - Check "Redirect URL for OAuth"
       - Note if it needs updating for new Vercel domain (can be done when import feature ships)

    **Step 5: Verify auth end-to-end**
    1. Open the deployed Vercel URL in browser
    2. You should be redirected to /login
    3. Click "Sign in with Google"
    4. Authenticate with your Google account
    5. You should be redirected back to the app and see the AppShell layout
    6. Verify: sidebar, main content area, and navigation all render correctly
    7. Navigate to a few routes: /workspaces, /settings, /import
    8. Navigate to /bank — should show "Page Not Found" message
    9. Refresh the page — session should persist (you stay logged in)

    **Step 6: Mobile verification**
    1. Open the Vercel URL on your phone (or use browser DevTools mobile simulation)
    2. Verify the layout adapts: main content full-screen, no overlapping panes
    3. Sign in works on mobile
  </how-to-verify>
  <resume-signal>Type "approved" if auth works end-to-end on the deployed URL, or describe any issues encountered.</resume-signal>
</task>

</tasks>

<verification>
1. GitHub repo `Vibe-Marketer/callvault` exists and is accessible
2. Vercel deployment succeeds and the app is live at a public URL
3. New Vercel URL is in Supabase redirect allowlist (FOUND-07)
4. Google OAuth consent screen has no Meet/Calendar scopes (FOUND-09)
5. Fathom and Zoom OAuth callback URLs are audited (FOUND-08)
6. User can sign in on deployed URL with existing Supabase account (FOUND-01)
7. AppShell renders 4-pane layout with spring animations (FOUND-04)
8. All routes reachable, /bank /vault /hub return 404 (FOUND-05)
9. Session persists across refresh
10. Mobile layout works
</verification>

<success_criteria>
An existing v1 user navigates to the deployed Vercel URL, signs in with Google, sees the 4-pane AppShell, navigates all routes without 404, and /bank returns "Page Not Found". Auth works, redirects work, session persists. All 10 FOUND requirements and AI-02 are satisfied. Phase 14 is complete.
</success_criteria>

<output>
After completion, create `.planning/phases/14-foundation/14-05-SUMMARY.md` in the brain repo.
</output>
