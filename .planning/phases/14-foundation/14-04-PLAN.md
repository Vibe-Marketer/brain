---
phase: 14-foundation
plan: 04
type: execute
wave: 4
depends_on: ["14-03"]
files_modified:
  - /Users/Naegele/dev/callvault/src/routes/_authenticated/workspaces/index.tsx
  - /Users/Naegele/dev/callvault/src/routes/_authenticated/workspaces/$workspaceId.tsx
  - /Users/Naegele/dev/callvault/src/routes/_authenticated/calls/$callId.tsx
  - /Users/Naegele/dev/callvault/src/routes/_authenticated/folders/$folderId.tsx
  - /Users/Naegele/dev/callvault/src/routes/_authenticated/import/index.tsx
  - /Users/Naegele/dev/callvault/src/routes/_authenticated/settings/index.tsx
  - /Users/Naegele/dev/callvault/src/routes/_authenticated/settings/$category.tsx
  - /Users/Naegele/dev/callvault/src/routes/_authenticated/sharing/index.tsx
  - /Users/Naegele/dev/callvault/src/routes/s/$token.tsx
  - /Users/Naegele/dev/callvault/src/routes/bank.tsx
  - /Users/Naegele/dev/callvault/src/routes/vault.tsx
  - /Users/Naegele/dev/callvault/src/routes/hub.tsx
  - /Users/Naegele/dev/callvault/src/lib/query-config.ts
  - /Users/Naegele/dev/callvault/src/hooks/useClipboard.ts
  - /Users/Naegele/dev/callvault/src/hooks/useFileOpen.ts
autonomous: true
must_haves:
  truths:
    - "All non-AI routes are wired and reachable without 404"
    - "/ renders the calls list page inside AppShell"
    - "/workspaces, /workspaces/$id, /calls/$id, /folders/$id, /import, /settings, /sharing all render inside AppShell"
    - "/s/$token renders a public shared call view (no auth required)"
    - "/bank, /vault, /hub return 404 (v1 paths must not exist in v2)"
    - "Zustand stores use v5 double-invocation syntax for UI state"
    - "TanStack Query is configured with query key factory pattern"
    - "Browser API hooks (useClipboard, useFileOpen) abstract for Tauri compatibility"
    - "Hard boundary between TanStack Query (server state) and Zustand (UI state) established by convention and documented in query-config.ts"
  artifacts:
    - path: "/Users/Naegele/dev/callvault/src/routes/_authenticated/workspaces/index.tsx"
      provides: "Workspace list page route"
      contains: "createFileRoute"
    - path: "/Users/Naegele/dev/callvault/src/routes/_authenticated/workspaces/$workspaceId.tsx"
      provides: "Workspace detail page route"
      contains: "createFileRoute"
    - path: "/Users/Naegele/dev/callvault/src/routes/_authenticated/calls/$callId.tsx"
      provides: "Call detail page route"
      contains: "createFileRoute"
    - path: "/Users/Naegele/dev/callvault/src/routes/_authenticated/folders/$folderId.tsx"
      provides: "Folder view page route"
      contains: "createFileRoute"
    - path: "/Users/Naegele/dev/callvault/src/routes/_authenticated/import/index.tsx"
      provides: "Import hub route"
      contains: "createFileRoute"
    - path: "/Users/Naegele/dev/callvault/src/routes/_authenticated/settings/index.tsx"
      provides: "Settings page route"
      contains: "createFileRoute"
    - path: "/Users/Naegele/dev/callvault/src/routes/_authenticated/settings/$category.tsx"
      provides: "Settings category page route"
      contains: "createFileRoute"
    - path: "/Users/Naegele/dev/callvault/src/routes/_authenticated/sharing/index.tsx"
      provides: "Sharing page route"
      contains: "createFileRoute"
    - path: "/Users/Naegele/dev/callvault/src/routes/s/$token.tsx"
      provides: "Public shared call view (no auth)"
      contains: "createFileRoute"
    - path: "/Users/Naegele/dev/callvault/src/routes/bank.tsx"
      provides: "404 catch for v1 /bank path"
      contains: "NotFound"
    - path: "/Users/Naegele/dev/callvault/src/routes/vault.tsx"
      provides: "404 catch for v1 /vault path"
      contains: "NotFound"
    - path: "/Users/Naegele/dev/callvault/src/routes/hub.tsx"
      provides: "404 catch for v1 /hub path"
      contains: "NotFound"
    - path: "/Users/Naegele/dev/callvault/src/lib/query-config.ts"
      provides: "TanStack Query key factory"
      exports: ["queryKeys"]
    - path: "/Users/Naegele/dev/callvault/src/hooks/useClipboard.ts"
      provides: "Clipboard API abstraction for Tauri"
      exports: ["useClipboard"]
    - path: "/Users/Naegele/dev/callvault/src/hooks/useFileOpen.ts"
      provides: "File open API abstraction for Tauri"
      exports: ["useFileOpen"]
  key_links:
    - from: "/Users/Naegele/dev/callvault/src/routes/_authenticated/workspaces/index.tsx"
      to: "/Users/Naegele/dev/callvault/src/components/layout/AppShell.tsx"
      via: "Each route wraps content in AppShell"
      pattern: "AppShell"
    - from: "/Users/Naegele/dev/callvault/src/lib/query-config.ts"
      to: "All route components"
      via: "queryKeys factory for consistent cache keys"
      pattern: "queryKeys"
---

<objective>
Wire all non-AI routes, set up TanStack Query configuration, and create browser API abstraction hooks.

Purpose: FOUND-05 (all non-AI routes wired), FOUND-06 (Zustand v5 + TanStack Query v5 with hard boundary), plus v1 path blocking and Tauri-ready browser API hooks. After this plan, every page in the sitemap is reachable.
Output: All routes render placeholder content inside AppShell. v1 paths (/bank, /vault, /hub) return 404. Query key factory and browser API hooks ready for use.
</objective>

<execution_context>
@/Users/Naegele/.claude/get-shit-done/workflows/execute-plan.md
@/Users/Naegele/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@/Users/Naegele/dev/brain/.planning/ROADMAP.md
@/Users/Naegele/dev/brain/.planning/phases/14-foundation/14-RESEARCH.md
@/Users/Naegele/dev/brain/.planning/phases/14-foundation/14-CONTEXT.md
@/Users/Naegele/dev/brain/.planning/phases/14-foundation/14-03-SUMMARY.md
@/Users/Naegele/dev/brain/src/lib/query-config.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Wire all authenticated routes with AppShell</name>
  <files>
    /Users/Naegele/dev/callvault/src/routes/_authenticated/index.tsx
    /Users/Naegele/dev/callvault/src/routes/_authenticated/workspaces/index.tsx
    /Users/Naegele/dev/callvault/src/routes/_authenticated/workspaces/$workspaceId.tsx
    /Users/Naegele/dev/callvault/src/routes/_authenticated/calls/$callId.tsx
    /Users/Naegele/dev/callvault/src/routes/_authenticated/folders/$folderId.tsx
    /Users/Naegele/dev/callvault/src/routes/_authenticated/import/index.tsx
    /Users/Naegele/dev/callvault/src/routes/_authenticated/settings/index.tsx
    /Users/Naegele/dev/callvault/src/routes/_authenticated/settings/$category.tsx
    /Users/Naegele/dev/callvault/src/routes/_authenticated/sharing/index.tsx
    /Users/Naegele/dev/callvault/src/routes/s/$token.tsx
    /Users/Naegele/dev/callvault/src/routes/bank.tsx
    /Users/Naegele/dev/callvault/src/routes/vault.tsx
    /Users/Naegele/dev/callvault/src/routes/hub.tsx
  </files>
  <action>
    Create ALL route files. Each authenticated route renders inside `<AppShell>` with appropriate config. Routes contain placeholder content (heading + brief description) — real content comes in later phases.

    IMPORTANT: Import AppShell using the typed props from Plan 03:
    ```typescript
    import { AppShell } from '@/components/layout/AppShell'
    // Use: <AppShell secondaryPane={...} showDetailPane={true/false}>
    ```

    AUTHENTICATED ROUTES (under `src/routes/_authenticated/`):

    1. `index.tsx` — / (Calls List, home page):
       - AppShell with secondaryPane (folder sidebar placeholder) and showDetailPane=true
       - Main content: "All Calls" heading with placeholder list
       - This is the default landing page after auth

    2. `workspaces/index.tsx` — /workspaces (Workspace List):
       - AppShell with secondaryPane (org sidebar placeholder)
       - Main content: "Workspaces" heading with placeholder grid

    3. `workspaces/$workspaceId.tsx` — /workspaces/:id (Workspace Detail):
       - Read `workspaceId` from `Route.useParams()`
       - AppShell with secondaryPane (folder tree placeholder)
       - Main content: "Workspace: {id}" placeholder

    4. `calls/$callId.tsx` — /calls/:id (Call Detail):
       - Read `callId` from `Route.useParams()`
       - AppShell with showDetailPane=true
       - Main content: "Call: {id}" with transcript placeholder area

    5. `folders/$folderId.tsx` — /folders/:id (Folder View):
       - Read `folderId` from `Route.useParams()`
       - AppShell with secondaryPane
       - Main content: "Folder: {id}" with call list placeholder

    6. `import/index.tsx` — /import (Import Hub):
       - AppShell without secondaryPane (import hub is full-width main pane)
       - Main content: "Import Hub" heading with connector cards placeholder
       - Placeholder cards for: Fathom, Zoom, YouTube, File Upload (no Google Meet — FOUND-09)

    7. `settings/index.tsx` — /settings (Settings, redirects to first category):
       - Redirect to /settings/account (or render settings layout)

    8. `settings/$category.tsx` — /settings/:category (Settings Category):
       - Read `category` from params
       - AppShell with secondaryPane (settings category list)
       - Main content: Settings form placeholder for selected category
       - Categories: account, organization, workspace, integrations, billing

    9. `sharing/index.tsx` — /sharing (Shared With Me):
       - AppShell without secondaryPane
       - Main content: "Shared With Me" heading with placeholder list

    PUBLIC ROUTES (NOT under _authenticated):

    10. `s/$token.tsx` — /s/:token (Public Shared Call View):
        - NO auth guard (this is a public route)
        - Does NOT use AppShell (standalone page)
        - Read `token` from params
        - Render a simple centered layout with: "Shared Call" heading, placeholder for transcript
        - Will be implemented fully in Phase 21 (SHARE-01)

    V1 PATH BLOCKERS:

    11. `bank.tsx` — /bank/* catch-all:
        - Renders a 404-style page: "Page Not Found — This URL is from an older version of CallVault"
        - Includes a link to / ("Go to CallVault")
        - Use `createFileRoute('/bank')` — catches /bank and any sub-paths

    12. `vault.tsx` — /vault/* catch-all:
        - Same 404 page as /bank

    13. `hub.tsx` — /hub/* catch-all:
        - Same 404 page as /bank

    EVERY authenticated route page component should:
    - Import and use AppShell for layout
    - Include a page heading with Montserrat uppercase style: `font-montserrat font-extrabold text-xl uppercase tracking-wide`
    - Show the current route path as subtle breadcrumb text for debugging
    - Use placeholder `<div>` with muted border and "Coming soon" text for unbuilt features

    CONSTRAINT: No AI, RAG, embedding, Content Hub, or Google Meet routes. No /chat route. No /content route. No /analytics route (analytics will be part of workspace detail in later phases).
  </action>
  <verify>
    Confirm ALL 13 expected route files exist:
    ```bash
    EXPECTED_FILES=(
      "src/routes/_authenticated/index.tsx"
      "src/routes/_authenticated/workspaces/index.tsx"
      "src/routes/_authenticated/workspaces/\$workspaceId.tsx"
      "src/routes/_authenticated/calls/\$callId.tsx"
      "src/routes/_authenticated/folders/\$folderId.tsx"
      "src/routes/_authenticated/import/index.tsx"
      "src/routes/_authenticated/settings/index.tsx"
      "src/routes/_authenticated/settings/\$category.tsx"
      "src/routes/_authenticated/sharing/index.tsx"
      "src/routes/s/\$token.tsx"
      "src/routes/bank.tsx"
      "src/routes/vault.tsx"
      "src/routes/hub.tsx"
    )
    MISSING=0
    for f in "${EXPECTED_FILES[@]}"; do
      if [ ! -f "/Users/Naegele/dev/callvault/$f" ]; then
        echo "MISSING: $f"
        MISSING=$((MISSING+1))
      fi
    done
    echo "Missing files: $MISSING"
    ```
    - All 13 files must exist (MISSING=0)
    - `cd /Users/Naegele/dev/callvault && pnpm dev` compiles without errors
    - Route tree is generated: `ls /Users/Naegele/dev/callvault/src/routeTree.gen.ts`
    - `grep "createFileRoute" /Users/Naegele/dev/callvault/src/routes/bank.tsx` exists (v1 path blocker)
    - `grep "createFileRoute" /Users/Naegele/dev/callvault/src/routes/vault.tsx` exists (v1 path blocker)
    - `grep "createFileRoute" /Users/Naegele/dev/callvault/src/routes/hub.tsx` exists (v1 path blocker)
    - `grep -ri "google.meet\|chat\|content-hub\|embedding\|rag" /Users/Naegele/dev/callvault/src/routes/` returns zero results
    - `grep "AppShell" /Users/Naegele/dev/callvault/src/routes/_authenticated/workspaces/index.tsx` returns match
    - Visiting localhost:3000/bank shows 404-style page
    - Visiting localhost:3000/workspaces renders inside AppShell
  </verify>
  <done>All 13 route files exist: 9 authenticated routes render inside AppShell using typed props (secondaryPane, showDetailPane). Public shared call route at /s/:token works without auth. /bank, /vault, /hub return 404 pages. Route tree auto-generates. Zero AI/RAG/Content Hub/Google Meet routes.</done>
</task>

<task type="auto">
  <name>Task 2: Query config, browser API hooks, and state management boundary</name>
  <files>
    /Users/Naegele/dev/callvault/src/lib/query-config.ts
    /Users/Naegele/dev/callvault/src/hooks/useClipboard.ts
    /Users/Naegele/dev/callvault/src/hooks/useFileOpen.ts
  </files>
  <action>
    1. Create `src/lib/query-config.ts` — TanStack Query key factory:
       - Port pattern from v1's `brain/src/lib/query-config.ts`
       - Define query key factories for all v2 domains:
         ```typescript
         export const queryKeys = {
           calls: {
             all: ['calls'] as const,
             list: (filters?: Record<string, unknown>) => ['calls', 'list', filters] as const,
             detail: (id: string) => ['calls', 'detail', id] as const,
             transcript: (id: string) => ['calls', 'transcript', id] as const,
           },
           workspaces: {
             all: ['workspaces'] as const,
             list: () => ['workspaces', 'list'] as const,
             detail: (id: string) => ['workspaces', 'detail', id] as const,
             members: (id: string) => ['workspaces', 'members', id] as const,
           },
           organizations: {
             all: ['organizations'] as const,
             list: () => ['organizations', 'list'] as const,
             detail: (id: string) => ['organizations', 'detail', id] as const,
           },
           folders: {
             all: ['folders'] as const,
             list: (workspaceId?: string) => ['folders', 'list', workspaceId] as const,
             detail: (id: string) => ['folders', 'detail', id] as const,
             assignments: () => ['folder-assignments'] as const,
           },
           imports: {
             all: ['imports'] as const,
             sources: () => ['imports', 'sources'] as const,
             history: () => ['imports', 'history'] as const,
           },
           sharing: {
             all: ['sharing'] as const,
             sharedWithMe: () => ['sharing', 'shared-with-me'] as const,
           },
           user: {
             profile: () => ['user', 'profile'] as const,
             preferences: () => ['user', 'preferences'] as const,
           },
         } as const
         ```
       - This establishes the hard boundary: TanStack Query = server state (all Supabase data), Zustand = UI state only (panel open/close, sidebar state, etc.)

    2. Create `src/hooks/useClipboard.ts` — browser API abstraction for Tauri:
       - Export `useClipboard()` returning `{ copy: (text: string) => Promise<void> }`
       - Implementation: `navigator.clipboard.writeText(text)`
       - Comment: "Future: check for Tauri context and invoke Tauri clipboard plugin"

    3. Create `src/hooks/useFileOpen.ts` — browser API abstraction for Tauri:
       - Export `useFileOpen()` returning `{ openFile: (accept?: string) => Promise<File | null> }`
       - Implementation: creates hidden `<input type="file">` element, triggers click, resolves with selected file
       - Comment: "Future: check for Tauri context and invoke Tauri file dialog"

    HARD BOUNDARY DOCUMENTATION: Add a comment block at the top of query-config.ts:
    ```
    /**
     * TanStack Query Key Factory
     *
     * HARD BOUNDARY (FOUND-06):
     * - TanStack Query = ALL server state (Supabase data fetching, caching, mutations)
     * - Zustand = UI state ONLY (panel open/close, sidebar collapsed, preferences)
     *
     * This boundary is enforced by convention — there is no runtime enforcement.
     * If you need data from Supabase -> use useQuery/useMutation with these keys
     * If you need to track UI toggle state -> use a Zustand store
     *
     * Violating this boundary (e.g., putting server data in Zustand) will cause
     * cache staleness bugs and break optimistic updates.
     */
    ```
  </action>
  <verify>
    - `cat /Users/Naegele/dev/callvault/src/lib/query-config.ts` exports queryKeys with all domains
    - `grep "HARD BOUNDARY" /Users/Naegele/dev/callvault/src/lib/query-config.ts` returns match
    - `grep "enforced by convention" /Users/Naegele/dev/callvault/src/lib/query-config.ts` returns match
    - `cat /Users/Naegele/dev/callvault/src/hooks/useClipboard.ts` exports useClipboard
    - `cat /Users/Naegele/dev/callvault/src/hooks/useFileOpen.ts` exports useFileOpen
    - `cd /Users/Naegele/dev/callvault && pnpm dev` still compiles without errors
  </verify>
  <done>TanStack Query key factory covers all v2 domains with FOUND-06 hard boundary established by convention and documented in query-config.ts. Browser API hooks abstract clipboard and file operations for future Tauri compatibility. State management boundary is clear: Query for server data, Zustand for UI state.</done>
</task>

</tasks>

<verification>
1. Every route in the sitemap is reachable:
   - / (calls list), /workspaces, /workspaces/:id, /calls/:id, /folders/:id
   - /import, /settings, /settings/:category, /sharing
   - /s/:token (public, no auth)
2. /bank, /vault, /hub return 404-style pages with "older version" messaging
3. All authenticated routes render inside AppShell with 4-pane layout
4. TanStack Query key factory exists with all domain factories
5. useClipboard and useFileOpen hooks exist with Tauri-compatible abstraction
6. Zero AI/RAG/embedding routes or code
7. `pnpm dev` compiles with zero TypeScript errors
</verification>

<success_criteria>
An authenticated user can navigate to every route in the v2 sitemap without hitting a 404. Unauthenticated users are redirected to /login. /bank, /vault, /hub show "Page not found" messaging. The TanStack Query and Zustand hard boundary is established by convention and documented. Browser API hooks are ready for Tauri. FOUND-05 and FOUND-06 are satisfied.
</success_criteria>

<output>
After completion, create `.planning/phases/14-foundation/14-04-SUMMARY.md` in the brain repo.
</output>
