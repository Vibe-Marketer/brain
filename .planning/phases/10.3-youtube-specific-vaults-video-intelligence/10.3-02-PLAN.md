---
phase: 10.3-youtube-specific-vaults-video-intelligence
plan: 02
type: execute
wave: 2
depends_on: ["10.3-01"]
files_modified:
  - src/components/youtube/YouTubeVideoRow.tsx
  - src/components/youtube/YouTubeVideoList.tsx
  - src/components/youtube/YouTubeVideoStats.tsx
  - src/components/youtube/YouTubeOutlierBadge.tsx
  - src/hooks/useYouTubeSearch.ts
  - src/components/panes/VaultDetailPane.tsx
autonomous: true

must_haves:
  truths:
    - "Selecting a YouTube vault shows a media-row video list (not TranscriptTable)"
    - "Each video row displays thumbnail (120x68), title, one-line description snippet, and metadata columns"
    - "Metadata columns show views/likes/comments, channel name, duration + published date, and category"
    - "Outlier Rank column is visible as a disabled placeholder with clear 'coming soon' indication"
    - "Videos can be sorted by views, likes, date, and duration with published date as tie-breaker"
    - "Search filters videos by title (debounced)"
  artifacts:
    - path: "src/components/youtube/YouTubeVideoRow.tsx"
      provides: "Media-row list item with thumbnail + metadata columns"
      min_lines: 60
    - path: "src/components/youtube/YouTubeVideoList.tsx"
      provides: "List container with column headers and sort controls"
      min_lines: 50
    - path: "src/components/youtube/YouTubeVideoStats.tsx"
      provides: "Inline stats display (views/likes/comments with compact numbers)"
      min_lines: 20
    - path: "src/components/youtube/YouTubeOutlierBadge.tsx"
      provides: "Placeholder outlier rank display with disabled/coming-soon state"
      min_lines: 15
    - path: "src/hooks/useYouTubeSearch.ts"
      provides: "YouTube-specific search/sort hook extending useRecordingSearch pattern"
      exports: ["useYouTubeSearch"]
    - path: "src/components/panes/VaultDetailPane.tsx"
      provides: "Conditional rendering branching on vault_type='youtube'"
      contains: "isYouTubeVault"
  key_links:
    - from: "src/components/panes/VaultDetailPane.tsx"
      to: "src/components/youtube/YouTubeVideoList.tsx"
      via: "conditional render when vault.vault_type === 'youtube'"
      pattern: "isYouTubeVault.*YouTubeVideoList"
    - from: "src/components/youtube/YouTubeVideoRow.tsx"
      to: "src/types/youtube.ts"
      via: "imports getYouTubeMetadata to extract typed metadata"
      pattern: "getYouTubeMetadata"
    - from: "src/components/youtube/YouTubeVideoRow.tsx"
      to: "src/lib/youtube-utils.ts"
      via: "imports parseYouTubeDuration and formatCompactNumber"
      pattern: "parseYouTubeDuration|formatCompactNumber"
---

<objective>
Build the YouTube-specific video list UX that replaces TranscriptTable when a YouTube vault is selected. This is the core visual differentiator — media-row layout with thumbnails, rich metadata columns, and sortable headers.

Purpose: Users need a YouTube Studio-like browsing experience for their imported videos. The compact transcript table doesn't work for video content that has thumbnails, view counts, and channel metadata.

Output: YouTube video components, search/sort hook, and VaultDetailPane conditional rendering wired up.
</objective>

<execution_context>
@~/.config/Claude/get-shit-done/workflows/execute-plan.md
@~/.config/Claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10.3-youtube-specific-vaults-video-intelligence/10.3-CONTEXT.md
@.planning/phases/10.3-youtube-specific-vaults-video-intelligence/10.3-RESEARCH.md
@.planning/phases/10.3-youtube-specific-vaults-video-intelligence/10.3-01-SUMMARY.md

@src/components/panes/VaultDetailPane.tsx
@src/hooks/useRecordingSearch.ts
@src/hooks/useVaults.ts
@src/types/youtube.ts
@src/lib/youtube-utils.ts
@src/types/bank.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: YouTube video list components + search hook</name>
  <files>
    src/components/youtube/YouTubeVideoRow.tsx
    src/components/youtube/YouTubeVideoList.tsx
    src/components/youtube/YouTubeVideoStats.tsx
    src/components/youtube/YouTubeOutlierBadge.tsx
    src/hooks/useYouTubeSearch.ts
  </files>
  <action>
    Create `src/components/youtube/` directory with 4 components + 1 hook:

    **YouTubeVideoStats.tsx:**
    - Simple inline component showing views, likes, comments with compact number formatting
    - Uses `formatCompactNumber` from `@/lib/youtube-utils`
    - Layout: horizontal row of icon+number pairs, using Remix icons (RiEyeLine for views, RiThumbUpLine for likes, RiChat3Line for comments)
    - Muted foreground text, small size (text-xs)
    - If a count is undefined/null, show "—" instead

    **YouTubeOutlierBadge.tsx:**
    - Placeholder component for outlier rank column
    - Shows a muted "—" with a tooltip or title attribute: "Outlier ranking coming soon"
    - Use subtle styling: text-muted-foreground/40, italic or dashed border indicator
    - MUST look intentionally disabled, not broken/empty
    - Accept optional `rank` prop for future use but always show placeholder for now

    **YouTubeVideoRow.tsx:**
    - Props: `recording: VaultRecording`, `onVideoClick: (recording: VaultRecording) => void`
    - Layout: horizontal flex row (media-row style, NOT card)
    - Structure left to right:
      1. **Thumbnail** (120x68px): `<img>` with `src` from `getYouTubeMetadata(recording.source_metadata)?.youtube_thumbnail`, rounded-md, object-cover. Fallback: gray placeholder with RiVideoLine icon if no thumbnail.
      2. **Title + Description block** (flex-1, min-w-0):
         - Title: clickable text (font-medium, text-sm, truncate, hover:underline), onClick fires `onVideoClick`
         - Description: one-line snippet (text-xs, text-muted-foreground, truncate), from youtube_description
      3. **Channel** column (w-[140px] flex-shrink-0): channel name (text-xs, truncate)
      4. **Stats** column (w-[120px] flex-shrink-0): `<YouTubeVideoStats>` with views/likes/comments
      5. **Duration + Published** column (w-[100px] flex-shrink-0): duration from `parseYouTubeDuration`, published date (relative format like "2 months ago")
      6. **Category** column (w-[90px] flex-shrink-0): category name from `YOUTUBE_CATEGORIES[categoryId]` or "—"
      7. **Outlier Rank** column (w-[80px] flex-shrink-0): `<YouTubeOutlierBadge>`
    - Row has hover:bg-muted/50 transition
    - Clicking thumbnail also fires `onVideoClick`
    - Use `getYouTubeMetadata()` to extract typed metadata at top of component

    **YouTubeVideoList.tsx:**
    - Props: `recordings: VaultRecording[]`, `onVideoClick: (recording: VaultRecording) => void`, `sortBy: YouTubeSortField`, `sortOrder: SortOrder`, `onSortChange: (field: YouTubeSortField) => void`
    - Renders column headers row at top with sortable columns:
      - "Video" (title area, no sort — too complex)
      - "Channel" (not sortable for now)
      - "Stats" with sort by views or likes (dropdown or click to toggle)
      - "Duration" (sortable)
      - "Published" (sortable, this is the date sort)
      - "Category" (not sortable)
      - "Outlier Rank" (visually present but sort interaction shows placeholder tooltip "Coming soon")
    - Sort indicator: small arrow icon next to active sort column
    - Maps over `recordings` array and renders `<YouTubeVideoRow>` for each
    - Empty state: already handled by VaultDetailPane parent (this component only renders when recordings exist)
    - Use `ScrollArea` for the list body if needed (parent already has ScrollArea)

    **useYouTubeSearch.ts:**
    - Extend the pattern from `useRecordingSearch.ts` but with YouTube-specific sort fields
    - `YouTubeSortField = 'date' | 'views' | 'likes' | 'duration' | 'title'`
    - Default sort: `'date'` descending (per CONTEXT.md: "Default sort should prioritize outlier ranking behavior first" — but since outlier is placeholder, fall back to date/newest)
    - Sort comparisons:
      - `views`: compare `getYouTubeMetadata(a.source_metadata)?.youtube_view_count` vs b
      - `likes`: compare `youtube_like_count`
      - `duration`: compare recording.duration (already a number field)
      - `date`: compare recording_start_time or created_at
      - `title`: localeCompare
    - **Tie-breaker**: When primary sort values are equal, use published date (newer wins) per CONTEXT.md
    - Include same debounced search (300ms) on title as useRecordingSearch
    - Export `useYouTubeSearch` and `YouTubeSortField` and `SortOrder`
  </action>
  <verify>
    - `npx tsc --noEmit` passes for new files
    - All 4 component files exist in `src/components/youtube/`
    - Hook file exists at `src/hooks/useYouTubeSearch.ts`
    - Components use Remix icons only (no lucide, no other icon libs)
  </verify>
  <done>
    YouTubeVideoRow renders media-row layout with thumbnail (120x68), title, description snippet, channel, stats, duration+published, category, and outlier placeholder. YouTubeVideoList renders sortable column headers with YouTubeVideoRow items. useYouTubeSearch provides YouTube-specific sort fields with published-date tie-breaker. All components use existing types and utility functions from Plan 01.
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire VaultDetailPane to conditionally render YouTubeVideoList</name>
  <files>
    src/components/panes/VaultDetailPane.tsx
  </files>
  <action>
    Modify `VaultDetailPane.tsx` to branch rendering based on `vault.vault_type`:

    1. Add imports at top:
       - `import { YouTubeVideoList } from '@/components/youtube/YouTubeVideoList'`
       - `import { useYouTubeSearch } from '@/hooks/useYouTubeSearch'`
       - `import type { YouTubeSortField } from '@/hooks/useYouTubeSearch'`

    2. Add `isYouTubeVault` boolean derived from vault type:
       ```
       const isYouTubeVault = vault?.vault_type === 'youtube'
       ```

    3. **Conditional hook usage**: The component currently uses `useRecordingSearch`. For YouTube vaults, use `useYouTubeSearch` instead. Since hooks can't be called conditionally, use both hooks but only read from the active one:
       - Keep existing `useRecordingSearch` call
       - Add `useYouTubeSearch` call with same `{ recordings }` input
       - Use a pattern like:
         ```
         const youtubeSearch = useYouTubeSearch({ recordings })
         ```
       - In the JSX, use `isYouTubeVault ? youtubeSearch.filteredRecordings : filteredRecordings` etc.

    4. **Replace TranscriptTable conditionally**: In the recordings section (after empty state checks), replace the unconditional `<TranscriptTable>` with:
       ```tsx
       {isYouTubeVault ? (
         <YouTubeVideoList
           recordings={youtubeSearch.filteredRecordings}
           onVideoClick={(recording) => {
             // For now, navigate to call detail page using legacy_recording_id
             // Plan 04 will replace this with modal
             if (recording.legacy_recording_id) {
               navigate(`/call/${recording.legacy_recording_id}`)
             }
           }}
           sortBy={youtubeSearch.sortBy as YouTubeSortField}
           sortOrder={youtubeSearch.sortOrder}
           onSortChange={youtubeSearch.setSortBy}
         />
       ) : (
         <TranscriptTable ... /> // existing code unchanged
       )}
       ```

    5. **Search/filter toolbar**: The existing `VaultSearchFilter` should still work for YouTube vaults (title search and basic sort). However, the sort field options differ. For now, keep VaultSearchFilter as-is for both vault types — YouTube-specific sort controls are in the YouTubeVideoList column headers. The VaultSearchFilter's title search will use the correct search from whichever hook is active:
       - Pass `isYouTubeVault ? youtubeSearch.searchQuery : searchQuery` etc. to VaultSearchFilter

    6. **Recording count and empty states**: Use `isYouTubeVault ? youtubeSearch.totalCount : totalCount` for count displays, and `isYouTubeVault ? youtubeSearch.filteredRecordings : filteredRecordings` for empty filter checks.

    7. **Empty state for YouTube vault**: Replace "Go to Library" button text with "Import Videos" and navigate to `/import` instead of `/library` when vault is YouTube type.
  </action>
  <verify>
    - `npx tsc --noEmit` passes
    - VaultDetailPane imports YouTubeVideoList and useYouTubeSearch
    - `grep "isYouTubeVault" src/components/panes/VaultDetailPane.tsx` shows conditional
    - TranscriptTable still renders for non-YouTube vaults (no regression)
  </verify>
  <done>
    VaultDetailPane renders YouTubeVideoList when vault_type is 'youtube' and TranscriptTable for all other vault types. Search, sort, and empty states are correctly branched. YouTube video click navigates to call detail (temporary — Plan 04 adds modal).
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` — no new type errors
2. YouTube vault selection shows media-row layout with thumbnails
3. Non-YouTube vaults still show TranscriptTable (no regression)
4. Sort headers in YouTube list are clickable and reorder videos
5. Search filters YouTube videos by title
6. Outlier rank column visible as placeholder
</verification>

<success_criteria>
- YouTube vault displays media-row video list with all required metadata columns
- Thumbnail images load from YouTube CDN URLs
- Sort by views, likes, date, duration works with published-date tie-breaker
- Outlier rank column clearly indicates "coming soon" (not broken-looking)
- Non-YouTube vaults are completely unaffected
- Search debounce works at 300ms
</success_criteria>

<output>
After completion, create `.planning/phases/10.3-youtube-specific-vaults-video-intelligence/10.3-02-SUMMARY.md`
</output>
