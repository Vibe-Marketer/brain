---
phase: 10.3-youtube-specific-vaults-video-intelligence
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - supabase/migrations/20260211000001_add_youtube_vault_type.sql
  - src/types/bank.ts
  - src/types/youtube.ts
  - src/lib/youtube-utils.ts
  - src/components/panes/VaultListPane.tsx
  - src/components/panes/VaultDetailPane.tsx
autonomous: true

must_haves:
  truths:
    - "'youtube' is a valid vault_type in the database CHECK constraint"
    - "VaultType TypeScript union includes 'youtube'"
    - "YouTube vault appears in VaultListPane with YouTube icon and red styling"
    - "YouTubeVideoMetadata interface exists with all YouTube-specific fields"
    - "Duration parser converts ISO 8601 to human-readable format"
  artifacts:
    - path: "supabase/migrations/20260211000001_add_youtube_vault_type.sql"
      provides: "Database migration adding 'youtube' to vault_type CHECK"
      contains: "youtube"
    - path: "src/types/youtube.ts"
      provides: "YouTubeVideoMetadata interface + getYouTubeMetadata helper"
      exports: ["YouTubeVideoMetadata", "getYouTubeMetadata"]
    - path: "src/lib/youtube-utils.ts"
      provides: "parseYouTubeDuration + formatCompactNumber + YOUTUBE_CATEGORIES"
      exports: ["parseYouTubeDuration", "formatCompactNumber", "YOUTUBE_CATEGORIES"]
    - path: "src/types/bank.ts"
      provides: "VaultType union with 'youtube'"
      contains: "youtube"
  key_links:
    - from: "src/components/panes/VaultListPane.tsx"
      to: "VAULT_TYPE_CONFIG"
      via: "youtube entry in config object"
      pattern: "youtube.*label.*YouTube"
    - from: "src/components/panes/VaultDetailPane.tsx"
      to: "VAULT_TYPE_STYLES"
      via: "youtube entry in styles object"
      pattern: "youtube.*bg.*text"
---

<objective>
Create the foundation for YouTube vaults: database migration, TypeScript types, utility functions, and vault type configuration in existing panes.

Purpose: Nothing else in this phase can work until 'youtube' is a valid vault_type and the supporting types/utilities exist. This plan lays the groundwork that all subsequent plans build on.

Output: Migration SQL, YouTube types module, utility functions, and updated vault type configs in VaultListPane + VaultDetailPane.
</objective>

<execution_context>
@~/.config/Claude/get-shit-done/workflows/execute-plan.md
@~/.config/Claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10.3-youtube-specific-vaults-video-intelligence/10.3-CONTEXT.md
@.planning/phases/10.3-youtube-specific-vaults-video-intelligence/10.3-RESEARCH.md

@src/types/bank.ts
@src/components/panes/VaultListPane.tsx
@src/components/panes/VaultDetailPane.tsx
@supabase/migrations/20260131000006_create_vaults_tables.sql
</context>

<tasks>

<task type="auto">
  <name>Task 1: Database migration + TypeScript types + utility functions</name>
  <files>
    supabase/migrations/20260211000001_add_youtube_vault_type.sql
    src/types/bank.ts
    src/types/youtube.ts
    src/lib/youtube-utils.ts
  </files>
  <action>
    1. Create migration `supabase/migrations/20260211000001_add_youtube_vault_type.sql`:
       - DROP the existing `vaults_vault_type_check` constraint
       - ADD new CHECK constraint with 'youtube' included: `CHECK (vault_type IN ('personal', 'team', 'coach', 'community', 'client', 'youtube'))`
       - Follow existing migration pattern with section comments (see other migrations for style)

    2. Update `src/types/bank.ts`:
       - Add `'youtube'` to the `VaultType` union type: `export type VaultType = 'personal' | 'team' | 'coach' | 'community' | 'client' | 'youtube'`

    3. Create `src/types/youtube.ts` with:
       - `YouTubeVideoMetadata` interface with fields: `youtube_video_id`, `youtube_channel_id`, `youtube_channel_title`, `youtube_description`, `youtube_thumbnail`, `youtube_duration` (ISO 8601), `youtube_view_count` (number), `youtube_like_count` (number), `youtube_comment_count?` (number), `youtube_category_id?` (string), `youtube_subscriber_count?` (number), `import_source`, `imported_at`
       - `getYouTubeMetadata(sourceMetadata: Record<string, unknown> | null | undefined): YouTubeVideoMetadata | null` — type-narrowing helper that checks for `youtube_video_id` presence and returns typed metadata or null

    4. Create `src/lib/youtube-utils.ts` with:
       - `parseYouTubeDuration(iso8601: string): { seconds: number; display: string }` — parse "PT1H2M10S" to `{ seconds: 3730, display: "1:02:10" }`. Handle edge cases: missing parts, "PT0S", invalid strings (return `{ seconds: 0, display: "0:00" }`)
       - `formatCompactNumber(num: number): string` — format view/like counts compactly: 1234 → "1.2K", 1234567 → "1.2M", 1234567890 → "1.2B", numbers under 1000 returned as-is
       - `YOUTUBE_CATEGORIES: Record<string, string>` — static mapping of YouTube category IDs to names. Include at least the common ones: "1" → "Film & Animation", "2" → "Autos & Vehicles", "10" → "Music", "15" → "Pets & Animals", "17" → "Sports", "20" → "Gaming", "22" → "People & Blogs", "23" → "Comedy", "24" → "Entertainment", "25" → "News & Politics", "26" → "Howto & Style", "27" → "Education", "28" → "Science & Technology"
  </action>
  <verify>
    - `grep -r "youtube" src/types/bank.ts` shows 'youtube' in VaultType
    - `grep -r "YouTubeVideoMetadata" src/types/youtube.ts` shows interface
    - `grep -r "parseYouTubeDuration" src/lib/youtube-utils.ts` shows function
    - Migration SQL file exists and contains correct ALTER TABLE statements
  </verify>
  <done>
    VaultType includes 'youtube', YouTubeVideoMetadata interface exists with all fields, getYouTubeMetadata type-narrowing helper works, parseYouTubeDuration handles all formats, formatCompactNumber compacts large numbers, YOUTUBE_CATEGORIES maps common category IDs, migration ready to apply.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add YouTube vault type to VaultListPane + VaultDetailPane configs</name>
  <files>
    src/components/panes/VaultListPane.tsx
    src/components/panes/VaultDetailPane.tsx
  </files>
  <action>
    1. In `src/components/panes/VaultListPane.tsx`:
       - Import `RiYoutubeLine` from `@remixicon/react`
       - Add `youtube` entry to `VAULT_TYPE_CONFIG` object:
         ```
         youtube: {
           label: 'YouTube',
           icon: RiYoutubeLine,
           className: 'bg-red-500/10 text-red-600',
         },
         ```
       - This goes after the existing `client` entry

    2. In `src/components/panes/VaultDetailPane.tsx`:
       - Add `youtube` entry to `VAULT_TYPE_STYLES` object:
         ```
         youtube: { bg: 'bg-red-500/10', text: 'text-red-600' },
         ```
       - This goes after the existing `client` entry

    Both files already have complete `Record<VaultType, ...>` typing, so TypeScript will flag any missing entries after the VaultType update in Task 1. Adding these entries satisfies the type requirement.
  </action>
  <verify>
    - `npx tsc --noEmit` passes (no type errors from incomplete Record)
    - `grep "youtube" src/components/panes/VaultListPane.tsx` shows YouTube config entry
    - `grep "youtube" src/components/panes/VaultDetailPane.tsx` shows YouTube style entry
  </verify>
  <done>
    YouTube vaults display with red YouTube icon and "YouTube" label in VaultListPane. VaultDetailPane shows red-tinted badge for YouTube vault type. TypeScript compiles without errors.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` — no type errors
2. Migration file exists at `supabase/migrations/20260211000001_add_youtube_vault_type.sql` with correct SQL
3. `src/types/youtube.ts` exports `YouTubeVideoMetadata` and `getYouTubeMetadata`
4. `src/lib/youtube-utils.ts` exports `parseYouTubeDuration`, `formatCompactNumber`, `YOUTUBE_CATEGORIES`
5. VaultListPane VAULT_TYPE_CONFIG has all 6 vault types
6. VaultDetailPane VAULT_TYPE_STYLES has all 6 vault types
</verification>

<success_criteria>
- 'youtube' is a valid VaultType in both TypeScript and database schema
- YouTube metadata has typed interface with type-narrowing helper
- Duration parser, number formatter, and category map exist as reusable utilities
- Both VaultListPane and VaultDetailPane render YouTube vault type correctly
- No type errors across the codebase
</success_criteria>

<output>
After completion, create `.planning/phases/10.3-youtube-specific-vaults-video-intelligence/10.3-01-SUMMARY.md`
</output>
