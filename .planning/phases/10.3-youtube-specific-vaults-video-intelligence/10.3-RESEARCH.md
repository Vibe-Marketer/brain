# Phase 10.3: YouTube-Specific Vaults & Video Intelligence - Research

**Researched:** 2026-02-10
**Domain:** Frontend YouTube vault UX within existing Bank/Vault architecture
**Confidence:** HIGH

## Summary

This phase creates a dedicated YouTube vault experience within the existing Vault infrastructure. The codebase already has substantial YouTube import infrastructure (Edge Functions `youtube-import` and `youtube-api`, `YouTubeImportForm` component, `VaultSelector` with YouTube integration key), a complete Vault system (vaults table, vault_entries, recordings, VaultDetailPane, VaultListPane, VaultsPage), and established chat infrastructure (`chat-stream-v2` with bank/vault scoping). The primary work is:

1. **Database:** Add `'youtube'` to `vault_type` CHECK constraint, potentially add a `youtube_videos` lookup table or extend metadata JSONB usage
2. **Frontend:** Create a YouTube-specific list component (media-row layout), a video detail modal overlay, and conditional rendering in VaultDetailPane/VaultsPage based on vault_type
3. **Import flow:** Add auto-creation of YouTube vault on first import, filter VaultSelector to prevent non-YouTube vault selection
4. **Chat:** Wire existing chat-stream-v2 to work with YouTube vault context (already supports vault_id scoping)

**Primary recommendation:** Extend existing Vault infrastructure with YouTube-specific view components (not parallel systems). The vault_type='youtube' distinction drives conditional rendering throughout.

## Standard Stack

### Core (Already in Project)
| Library | Version | Purpose | Why Standard |
|---------|---------|---------|--------------|
| React + TypeScript | Latest | UI framework | Project stack |
| Tailwind CSS + shadcn/ui | Latest | Styling/components | Project stack |
| TanStack Query | v5 | Data fetching + caching | Project stack |
| Zustand | Latest | Client state | Project stack |
| Supabase | v2 | Backend/DB | Project stack |
| Remix Icon | Latest | Icons | Project standard (mandatory) |
| Vercel AI SDK | v6 | Chat/streaming | Project standard for AI |

### No New Dependencies Required
This phase does not require new libraries. Everything needed exists in the current stack:
- `Dialog`/`DialogContent` from shadcn/ui for modal overlays
- `ScrollArea` for scrollable content
- Existing `useVaults`, `useVaultRecordings`, `useVaultMutations` hooks
- Existing `VaultSelector` component
- Existing `chat-stream-v2` Edge Function with vault scoping

## Architecture Patterns

### Current Architecture Overview

```
Database Layer:
  fathom_calls (legacy, still used for imports + chat queries)
    ├── source_platform = 'youtube'
    ├── metadata JSONB = { youtube_video_id, youtube_channel_id, youtube_channel_title, 
    │                       youtube_description, youtube_thumbnail, youtube_duration,
    │                       youtube_view_count, youtube_like_count, import_source, imported_at }
    └── recording_id in 9000000000000+ range
  
  recordings (new model, used by vault system)
    ├── legacy_recording_id → links to fathom_calls.recording_id
    ├── source_app = 'youtube'
    ├── source_metadata JSONB = {} (currently NOT populated by youtube-import)
    └── bank_id → scoped to one bank
  
  vault_entries (recording in vault)
    ├── vault_id → FK to vaults
    ├── recording_id → FK to recordings (UUID)
    └── local_tags, scores, notes, folder_id

  vaults
    ├── vault_type CHECK ('personal', 'team', 'coach', 'community', 'client')
    │   ⚠️ MISSING 'youtube' — needs migration
    └── bank_id → scoped to one bank

Frontend Layer:
  VaultsPage → AppShell with VaultListPane (secondary) + VaultDetailPane (main)
  VaultDetailPane → uses TranscriptTable via mapRecordingToMeeting adapter
  VaultListPane → renders vault cards with VAULT_TYPE_CONFIG styling
  
Import Layer:
  ManualImport page → YouTubeImportForm → calls youtube-import Edge Function
  VaultSelector → used inside YouTubeImportForm
```

### Recommended Extension Architecture

```
src/
├── components/
│   ├── youtube/                          # NEW: YouTube-specific components
│   │   ├── YouTubeVideoRow.tsx           # Media-row list item (thumbnail + metadata)
│   │   ├── YouTubeVideoList.tsx          # List container with sort/filter
│   │   ├── YouTubeVideoDetailModal.tsx   # Modal overlay for video details
│   │   ├── YouTubeVideoStats.tsx         # Stats bar (views/likes/comments)
│   │   ├── YouTubeOutlierBadge.tsx       # Placeholder outlier rank display
│   │   └── YouTubeChatSection.tsx        # Click-to-start chat in detail modal
│   ├── panes/
│   │   └── VaultDetailPane.tsx           # MODIFY: branch on vault_type
│   ├── panes/
│   │   └── VaultListPane.tsx             # MODIFY: add 'youtube' to VAULT_TYPE_CONFIG
│   └── vault/
│       └── VaultSelector.tsx             # MODIFY: add filtering for youtube-only
├── hooks/
│   ├── useYouTubeVideos.ts               # NEW: fetch+shape YouTube recordings for vault
│   └── useVaults.ts                      # MODIFY: extend useVaultRecordings to include metadata
├── types/
│   └── bank.ts                           # MODIFY: add 'youtube' to VaultType
│   └── youtube.ts                        # NEW: YouTube-specific types
└── pages/
    └── VaultsPage.tsx                    # MODIFY: auto-switch layout based on vault_type

supabase/
├── migrations/
│   └── 202602XXXXXXXX_add_youtube_vault_type.sql  # NEW: add 'youtube' to vault_type
└── functions/
    └── youtube-import/index.ts           # MODIFY: auto-create YouTube vault
```

### Pattern 1: Conditional Vault Layout (vault_type branching)
**What:** VaultDetailPane renders different list components based on `vault.vault_type`
**When to use:** When selected vault is type='youtube', switch from TranscriptTable to YouTubeVideoList

```typescript
// In VaultDetailPane.tsx - replace the TranscriptTable section
const isYouTubeVault = vault.vault_type === 'youtube';

{isYouTubeVault ? (
  <YouTubeVideoList
    recordings={filteredRecordings}
    onVideoClick={handleVideoClick}    // opens modal
    sortBy={sortBy}
    onSortChange={setSortBy}
  />
) : (
  <TranscriptTable
    calls={meetings}
    selectedCalls={[]}
    tags={[]}
    tagAssignments={{}}
    onSelectCall={handleSelectCall}
    onSelectAll={handleSelectAll}
    onCallClick={handleCallClick}
  />
)}
```

### Pattern 2: YouTube Metadata from Recordings
**What:** Extend `useVaultRecordings` to fetch `source_metadata` JSONB from recordings table
**When to use:** YouTube vault recordings need metadata (thumbnail, views, likes, etc.)

```typescript
// recordings.source_metadata should contain YouTube-specific data
// Currently youtube-import stores metadata in fathom_calls.metadata
// BUT migrate_fathom_call_to_recording copies it to recordings.source_metadata
// 
// IMPORTANT: The youtube-import function stores metadata on fathom_calls.metadata
// but the migration function maps it to recordings.source_metadata
// The useVaultRecordings hook already fetches source_metadata from recordings
```

### Pattern 3: Modal Overlay for Video Detail
**What:** Use existing shadcn/ui Dialog pattern for video detail modal
**When to use:** Clicking title/thumbnail in YouTube vault opens modal overlay

```typescript
// Follows established CallDetailDialog pattern
// Uses Dialog + DialogContent from shadcn/ui
// Sections: Video summary (thumbnail/title/channel/stats), Description, Transcript, Chat
```

### Pattern 4: Auto-Create YouTube Vault on First Import
**What:** youtube-import Edge Function creates vault if none exists
**When to use:** First YouTube import when user has no youtube-type vault

```typescript
// In youtube-import/index.ts or as a separate check before import
// 1. Check if user has a vault with vault_type='youtube' in their personal bank
// 2. If not, create one named "YouTube Vault" with vault_type='youtube'
// 3. Auto-add user as vault_owner
// 4. Return vault_id for the import to use
```

### Anti-Patterns to Avoid
- **Separate YouTube page/route:** YouTube vault is "just another vault" in the Vaults page, not a separate page
- **New chat system:** Must reuse chat-stream-v2 with vault_id scoping
- **New database table for videos:** The PRD suggests youtube_videos table, but CONTEXT.md decision says to reuse existing vault infrastructure. Use recordings.source_metadata JSONB.
- **Card/grid layout:** Desktop uses media-row (YouTube Studio style), not cards
- **Auto-starting chat:** Chat must be user-triggered via click-to-start

## Don't Hand-Roll

| Problem | Don't Build | Use Instead | Why |
|---------|-------------|-------------|-----|
| Video detail modal | Custom overlay system | `Dialog` + `DialogContent` from shadcn/ui | Follows existing CallDetailDialog pattern; accessibility, animations included |
| Vault CRUD | Custom vault creation | `useCreateVault` from useVaultMutations.ts | Already handles optimistic updates, toast notifications, query invalidation |
| Chat with video | New chat endpoint | `chat-stream-v2` with `vault_id` param | Already supports bank/vault scoping via sessionFilters |
| YouTube metadata fetch | Custom API | `youtube-api` Edge Function (already exists) | Fetches video-details with views, likes, comments, thumbnails, duration |
| Recording search/filter | Custom filter logic | Extend `useRecordingSearch` hook | Already handles debounced search, date range, sorting |
| Vault switching UX | Custom switching | Existing VaultListPane with vault selection | Already handles bank context, vault cards, keyboard navigation |
| Thumbnail display | Custom image component | Standard `<img>` with fallback | YouTube thumbnail URLs are stable CDN URLs (i.ytimg.com) |

## Common Pitfalls

### Pitfall 1: Metadata Location Mismatch
**What goes wrong:** YouTube metadata is stored in `fathom_calls.metadata` JSONB but the vault system reads from `recordings.source_metadata`. If `source_metadata` isn't populated during migration, YouTube-specific data (thumbnail, views, likes) won't be available in the vault view.
**Why it happens:** `youtube-import` writes to `fathom_calls.metadata` but the `migrate_fathom_call_to_recording` function maps `COALESCE(v_call.metadata, '{}'::jsonb)` to `recordings.source_metadata`. The migration copies the data — BUT the migration is only triggered on-demand, not automatically after youtube-import.
**How to avoid:** Ensure youtube-import Edge Function either:
  (a) Triggers migration after inserting into fathom_calls, OR
  (b) Directly inserts into recordings table + creates vault_entry
  Option (b) is cleaner but requires more refactoring of the import function.
**Warning signs:** YouTube recordings appear in vault with no thumbnail/metadata.

### Pitfall 2: vault_type CHECK Constraint
**What goes wrong:** Creating a vault with `vault_type='youtube'` fails because the CHECK constraint only allows `('personal', 'team', 'coach', 'community', 'client')`.
**Why it happens:** The `vaults` table was created in Phase 09-03 without 'youtube' as an option.
**How to avoid:** Migration must run BEFORE any YouTube vault creation. The migration must update both the database constraint AND the TypeScript `VaultType` type in `src/types/bank.ts`.
**Warning signs:** 500 error on vault creation with "new row violates check constraint".

### Pitfall 3: VaultSelector Filtering for YouTube Imports
**What goes wrong:** Users import YouTube videos into personal/team vaults instead of YouTube vaults.
**Why it happens:** Current VaultSelector shows all vaults regardless of type.
**How to avoid:** Add `filterType?: VaultType` prop to VaultSelector. When `integration='youtube'`, only show vaults with `vault_type='youtube'`.
**Warning signs:** YouTube videos mixed with call transcripts in non-YouTube vaults.

### Pitfall 4: Missing source_metadata in useVaultRecordings Query
**What goes wrong:** YouTube-specific fields (thumbnail, views, likes) not available in frontend.
**Why it happens:** The `useVaultRecordings` hook already fetches `source_metadata` from recordings table. However, the `VaultRecording` type extends `Recording` which has `source_metadata?: Record<string, unknown> | null`. The data is fetched but may not have YouTube-specific typing.
**How to avoid:** Create a `YouTubeMetadata` TypeScript interface and type-narrow from `source_metadata`.
**Warning signs:** TypeScript errors accessing `source_metadata.youtube_thumbnail` etc.

### Pitfall 5: Outlier Rank Column in Pre-Launch State
**What goes wrong:** Outlier rank shows as broken/empty instead of graceful placeholder.
**Why it happens:** No ranking data exists yet; column must show "Coming Soon" or similar disabled state.
**How to avoid:** Design the column with explicit placeholder state from the start. Use muted styling, skeleton-like appearance, or "—" with tooltip explaining it's coming soon.
**Warning signs:** Empty column that looks like a bug rather than a deliberate placeholder.

### Pitfall 6: YouTube Duration Format
**What goes wrong:** YouTube API returns duration in ISO 8601 format (e.g., "PT1H2M10S") but UI needs "1:02:10" or "62 min".
**Why it happens:** YouTube Data API v3 uses ISO 8601 duration format.
**How to avoid:** Create a `parseYouTubeDuration` utility that converts ISO 8601 to human-readable format. The duration is stored in `metadata.youtube_duration` as the raw ISO 8601 string.
**Warning signs:** Raw "PT1H2M10S" strings displayed in UI.

## Code Examples

### Example 1: YouTube Video Row Component Structure
```typescript
// Source: Based on CONTEXT.md decisions + existing TranscriptTableRow pattern
interface YouTubeVideoRowProps {
  recording: VaultRecording;
  onVideoClick: (recording: VaultRecording) => void;
}

// Media row layout: [Thumbnail 120x68] [Title + Description] [Metadata columns] [Outlier]
// Thumbnail: 120x68px from source_metadata.youtube_thumbnail
// Title: Clickable, opens modal
// Description: One-line snippet, truncated
// Metadata: views/likes/comments | channel + subs | duration + published | category | outlier rank
```

### Example 2: Extending VaultType
```typescript
// src/types/bank.ts
export type VaultType = 'personal' | 'team' | 'coach' | 'community' | 'client' | 'youtube'
```

```sql
-- Migration: Add youtube to vault_type constraint
ALTER TABLE vaults DROP CONSTRAINT IF EXISTS vaults_vault_type_check;
ALTER TABLE vaults ADD CONSTRAINT vaults_vault_type_check
  CHECK (vault_type IN ('personal', 'team', 'coach', 'community', 'client', 'youtube'));
```

### Example 3: YouTube Metadata Type
```typescript
// src/types/youtube.ts
export interface YouTubeVideoMetadata {
  youtube_video_id: string;
  youtube_channel_id: string;
  youtube_channel_title: string;
  youtube_description: string;          // truncated to 1000 chars
  youtube_thumbnail: string;            // URL to high-res thumbnail
  youtube_duration: string;             // ISO 8601 format "PT1H2M10S"
  youtube_view_count: number;
  youtube_like_count: number;
  youtube_comment_count?: number;       // Not stored by current import
  youtube_category_id?: string;         // Not stored by current import
  youtube_subscriber_count?: number;    // Not stored by current import
  import_source: 'youtube-import';
  imported_at: string;                  // ISO date
}

// Helper to extract typed metadata from source_metadata JSONB
export function getYouTubeMetadata(
  sourceMetadata: Record<string, unknown> | null | undefined
): YouTubeVideoMetadata | null {
  if (!sourceMetadata?.youtube_video_id) return null;
  return sourceMetadata as unknown as YouTubeVideoMetadata;
}
```

### Example 4: Duration Parser
```typescript
// Parse YouTube ISO 8601 duration to seconds and display format
export function parseYouTubeDuration(iso8601: string): { seconds: number; display: string } {
  const match = iso8601.match(/PT(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)S)?/);
  if (!match) return { seconds: 0, display: '0:00' };
  
  const hours = parseInt(match[1] || '0');
  const minutes = parseInt(match[2] || '0');
  const secs = parseInt(match[3] || '0');
  const totalSeconds = hours * 3600 + minutes * 60 + secs;
  
  if (hours > 0) {
    return { seconds: totalSeconds, display: `${hours}:${String(minutes).padStart(2, '0')}:${String(secs).padStart(2, '0')}` };
  }
  return { seconds: totalSeconds, display: `${minutes}:${String(secs).padStart(2, '0')}` };
}
```

### Example 5: VAULT_TYPE_CONFIG Extension
```typescript
// Addition to VaultListPane.tsx VAULT_TYPE_CONFIG
youtube: {
  label: 'YouTube',
  icon: RiYoutubeLine,     // from @remixicon/react
  className: 'bg-red-500/10 text-red-600',
},
```

### Example 6: Chat Integration (Click-to-Start)
```typescript
// In YouTubeVideoDetailModal - chat section
// Reuses existing chat infrastructure:
// 1. Navigate to /chat with recording context
// 2. Or embed inline chat using useChat hook + chat-stream-v2 endpoint
// 
// Per CONTEXT.md: "Chat entry should be user-triggered via click-to-start pattern"
// Show a "Chat about this video" button that navigates to chat with vault_id context

const handleStartChat = () => {
  navigate('/chat', {
    state: {
      vault_id: vault.id,
      recording_ids: [recording.legacy_recording_id],
      // This matches ChatLocationState pattern used in Chat.tsx
    }
  });
};
```

## State of the Art

| Old Approach | Current Approach | When Changed | Impact |
|--------------|------------------|--------------|--------|
| YouTube data only in fathom_calls | recordings + vault_entries model | Phase 09 (Jan 2026) | YouTube recordings accessible through vault system |
| No vault scoping for chat | chat-stream-v2 accepts vault_id | Phase 10 (Jan 2026) | Chat can be scoped to YouTube vault |
| Single vault view (TranscriptTable) | Need conditional rendering per vault_type | Phase 10.3 (this phase) | YouTube vault gets custom list view |

**Current limitations:**
- `youtube-import` Edge Function creates `fathom_calls` record but vault_entry creation depends on migration function being triggered — timing gap may exist
- `fathom_calls.metadata` stores YouTube data, but `recordings.source_metadata` depends on migration copying it
- `youtube_comment_count`, `youtube_category_id`, `youtube_subscriber_count` are NOT stored by current youtube-import (only available from youtube-api video-details endpoint)
- YouTube API `video-details` returns `categoryId` (number), not category name — need a mapping table or second API call for display name

## Key Existing Infrastructure Summary

### Database Schema
| Table | Key YouTube Columns | Status |
|-------|-------------------|--------|
| `fathom_calls` | `source_platform='youtube'`, `metadata` JSONB with youtube_* fields, `recording_id` in 9000000000000+ range | ✅ Exists |
| `recordings` | `source_app='youtube'`, `source_metadata` JSONB (copied from fathom_calls.metadata during migration) | ✅ Exists |
| `vault_entries` | `vault_id` + `recording_id` (UUID) | ✅ Exists |
| `vaults` | `vault_type` CHECK constraint — ⚠️ Missing 'youtube' | ❌ Needs migration |

### Edge Functions
| Function | Purpose | Status |
|----------|---------|--------|
| `youtube-api` | Proxies YouTube Data API: search, channel-videos, video-details, transcript | ✅ Exists |
| `youtube-import` | Orchestrates import: validate URL → check dupe → fetch details → fetch transcript → create fathom_calls → create vault_entry | ✅ Exists |
| `chat-stream-v2` | AI chat with vault scoping via `sessionFilters.vault_id` | ✅ Exists |

### Frontend Components
| Component | Purpose | Status |
|-----------|---------|--------|
| `VaultsPage` | 3-pane layout: VaultListPane + VaultDetailPane + VaultMemberPanel | ✅ Exists |
| `VaultDetailPane` | Shows vault recordings via TranscriptTable | ✅ Exists, needs conditional layout |
| `VaultListPane` | Lists vaults, grouped by type | ✅ Exists, needs youtube type config |
| `VaultSelector` | Dropdown for choosing vault during import | ✅ Exists, needs youtube filtering |
| `TranscriptTable` | Compact transcript-style table | ✅ Exists (used for non-YouTube vaults) |
| `CallDetailDialog` | Modal for call details (tabs: overview, transcript, invitees, participants) | ✅ Exists (reference pattern for modal) |
| `YouTubeImportForm` | URL input + progress tracking | ✅ Exists |
| `CreateVaultDialog` | Dialog for creating new vaults with type selector | ✅ Exists, needs 'youtube' option |

### Hooks
| Hook | Purpose | Status |
|------|---------|--------|
| `useVaults` | Fetch vaults for bank | ✅ Exists |
| `useVaultDetail` | Fetch single vault with memberships | ✅ Exists |
| `useVaultRecordings` | Fetch recordings in vault (includes source_metadata) | ✅ Exists |
| `useVaultMutations` | Create/update/delete vault | ✅ Exists |
| `useRecordingSearch` | Client-side search/filter/sort for vault recordings | ✅ Exists, may need extension for YouTube sort fields |
| `useBankContext` | Active bank/vault context | ✅ Exists |
| `mapRecordingToMeeting` | Adapter: Recording → Meeting type for TranscriptTable | ✅ Exists (not needed for YouTube list) |

## Open Questions

1. **source_metadata Population Timing**
   - What we know: `youtube-import` creates `fathom_calls` with metadata. Migration function copies it to `recordings.source_metadata`. Vault entry creation in youtube-import depends on migration having run.
   - What's unclear: Is the migration triggered automatically after youtube-import? Or is there a timing gap where recordings exist without source_metadata?
   - Recommendation: Inspect the youtube-import vault_entry creation code more closely. Consider having youtube-import also write directly to recordings.source_metadata, or ensure migration runs synchronously.

2. **Missing YouTube Metadata Fields**
   - What we know: `youtube-import` stores `youtube_view_count`, `youtube_like_count`, `youtube_thumbnail`, `youtube_duration`, `youtube_channel_title`, `youtube_channel_id`, `youtube_description`, `youtube_video_id`.
   - What's missing from current import: `comment_count` (available from youtube-api), `category` name (youtube-api returns `categoryId` number), `channel_subscriber_count` (requires separate API call).
   - Recommendation: Extend youtube-import to store `commentCount` (already returned by video-details). For category and subscriber count, consider whether to fetch during import or display as "—" for now.

3. **Outlier Rank Data Source**
   - What we know: Outlier rank is a placeholder in this phase (deferred per CONTEXT.md).
   - What's unclear: Where will the rank data come from in future? `vault_entries.scores` JSONB? Or a dedicated column?
   - Recommendation: Use `vault_entries.scores.outlier_rank` as the future storage location. Display placeholder UI now.

4. **YouTube Category Name Mapping**
   - What we know: YouTube API returns `categoryId` (a number like "22" for "People & Blogs").
   - What's unclear: Whether to maintain a static mapping or fetch category list from YouTube API.
   - Recommendation: Use a static mapping — YouTube video categories are stable and there are only ~30 of them. This avoids an additional API call per video.

## Sources

### Primary (HIGH confidence)
- **Codebase files examined directly:**
  - `supabase/migrations/20260131000006_create_vaults_tables.sql` — vaults schema
  - `supabase/migrations/20260131000007_create_recordings_tables.sql` — recordings + vault_entries schema
  - `supabase/migrations/20260131162000_add_youtube_source_and_metadata.sql` — YouTube metadata migration
  - `supabase/functions/youtube-import/index.ts` — YouTube import orchestrator
  - `supabase/functions/youtube-api/index.ts` — YouTube Data API proxy
  - `supabase/functions/chat-stream-v2/index.ts` — Chat with vault scoping
  - `src/components/panes/VaultDetailPane.tsx` — Vault detail rendering
  - `src/components/panes/VaultListPane.tsx` — Vault list rendering
  - `src/components/vault/VaultSelector.tsx` — Vault selection dropdown
  - `src/hooks/useVaults.ts` — Vault data hooks + mapRecordingToMeeting
  - `src/hooks/useVaultMutations.ts` — Vault CRUD mutations
  - `src/hooks/useRecordingSearch.ts` — Client-side search/filter
  - `src/components/transcript-library/TranscriptTable.tsx` — Current table component
  - `src/components/transcript-library/TranscriptTableRow.tsx` — Row rendering
  - `src/components/import/YouTubeImportForm.tsx` — Import form with VaultSelector
  - `src/components/dialogs/CreateVaultDialog.tsx` — Vault creation dialog
  - `src/components/CallDetailDialog.tsx` — Call detail modal (reference pattern)
  - `src/pages/VaultsPage.tsx` — Vaults page layout
  - `src/pages/ManualImport.tsx` — Import page
  - `src/pages/Chat.tsx` — Chat page with vault context
  - `src/types/bank.ts` — VaultType, Recording, VaultEntry types
  - `src/types/meetings.ts` — Meeting type definition
  - `src/lib/query-config.ts` — Query key factory
  - `.planning/phases/10.3-youtube-specific-vaults-video-intelligence/10.3-CONTEXT.md` — Locked decisions

### Secondary (MEDIUM confidence)
- `tasks/prd-youtube-vault.md` — PRD with user stories (some decisions superseded by CONTEXT.md)

## Metadata

**Confidence breakdown:**
- Standard stack: HIGH — direct codebase examination, all dependencies verified
- Architecture: HIGH — clear extension points identified from existing code
- Database schema: HIGH — migrations read directly
- YouTube metadata structure: HIGH — import function read directly
- Chat integration: HIGH — chat-stream-v2 vault scoping code confirmed
- Pitfalls: HIGH — identified from concrete code examination
- Outlier rank approach: MEDIUM — placeholder design is clear, future data source uncertain

**Research date:** 2026-02-10
**Valid until:** 2026-03-10 (stable codebase, patterns well-established)
