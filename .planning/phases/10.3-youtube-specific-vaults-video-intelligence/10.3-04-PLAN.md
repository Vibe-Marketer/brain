---
phase: 10.3-youtube-specific-vaults-video-intelligence
plan: 04
type: execute
wave: 3
depends_on: ["10.3-02"]
files_modified:
  - src/components/youtube/YouTubeVideoDetailModal.tsx
  - src/components/youtube/YouTubeChatSection.tsx
  - src/components/youtube/YouTubeVideoList.tsx
  - src/components/panes/VaultDetailPane.tsx
autonomous: true

must_haves:
  truths:
    - "Clicking a video title/thumbnail opens a modal overlay with video details"
    - "Modal shows video summary above the fold: thumbnail, title, channel, stats"
    - "Description defaults to collapsed (3 lines) with expand/collapse toggle"
    - "Transcript section shows the full_transcript text"
    - "Chat section shows 'Chat about this video' button (click-to-start, not auto-start)"
    - "Clicking 'Chat about this video' navigates to /chat with vault context"
  artifacts:
    - path: "src/components/youtube/YouTubeVideoDetailModal.tsx"
      provides: "Full video detail modal with summary, description, transcript, chat sections"
      min_lines: 100
    - path: "src/components/youtube/YouTubeChatSection.tsx"
      provides: "Click-to-start chat section for video detail modal"
      min_lines: 30
  key_links:
    - from: "src/components/youtube/YouTubeVideoDetailModal.tsx"
      to: "Dialog from shadcn/ui"
      via: "uses Dialog + DialogContent for modal overlay"
      pattern: "Dialog.*DialogContent"
    - from: "src/components/youtube/YouTubeChatSection.tsx"
      to: "/chat route"
      via: "navigate('/chat') with vault_id and recording context"
      pattern: "navigate.*chat.*vault_id"
    - from: "src/components/panes/VaultDetailPane.tsx"
      to: "src/components/youtube/YouTubeVideoDetailModal.tsx"
      via: "opens modal when onVideoClick fires from YouTubeVideoList"
      pattern: "YouTubeVideoDetailModal.*open"
---

<objective>
Build the video detail modal that opens when clicking a video in the YouTube list, with summary, collapsible description, transcript, and click-to-start chat integration.

Purpose: Users need to see video details without leaving the vault page. The modal follows the existing CallDetailDialog pattern but is optimized for YouTube content — video summary first (thumbnail/title/channel/stats), then description and transcript, with chat as a user-triggered action.

Output: YouTubeVideoDetailModal component, YouTubeChatSection component, wiring in VaultDetailPane.
</objective>

<execution_context>
@~/.config/Claude/get-shit-done/workflows/execute-plan.md
@~/.config/Claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10.3-youtube-specific-vaults-video-intelligence/10.3-CONTEXT.md
@.planning/phases/10.3-youtube-specific-vaults-video-intelligence/10.3-RESEARCH.md
@.planning/phases/10.3-youtube-specific-vaults-video-intelligence/10.3-01-SUMMARY.md
@.planning/phases/10.3-youtube-specific-vaults-video-intelligence/10.3-02-SUMMARY.md

@src/components/panes/VaultDetailPane.tsx
@src/components/youtube/YouTubeVideoList.tsx
@src/components/CallDetailDialog.tsx
@src/types/youtube.ts
@src/lib/youtube-utils.ts
@src/hooks/useVaults.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: YouTubeVideoDetailModal + YouTubeChatSection components</name>
  <files>
    src/components/youtube/YouTubeVideoDetailModal.tsx
    src/components/youtube/YouTubeChatSection.tsx
  </files>
  <action>
    **YouTubeChatSection.tsx:**
    - Props: `vaultId: string`, `recordingId: string | number` (legacy_recording_id), `videoTitle: string`
    - Displays a "Chat about this video" CTA button and brief description
    - Layout:
      - Section wrapper with border-t border-border, py-4
      - RiChat3Line icon + "Chat about this video" heading (text-sm, font-medium)
      - Description text: "Ask questions about this video's content using AI" (text-xs, text-muted-foreground)
      - Button: "Start Chat" (variant="default", size="sm")
    - On click, uses `useNavigate` to go to `/chat` with state:
      ```
      navigate('/chat', {
        state: {
          vault_id: vaultId,
          recording_ids: [recordingId],
        }
      })
      ```
    - This matches the existing `ChatLocationState` pattern used in Chat.tsx
    - The button should close the parent dialog by calling an `onClose` prop

    **YouTubeVideoDetailModal.tsx:**
    - Props: `open: boolean`, `onOpenChange: (open: boolean) => void`, `recording: VaultRecording | null`, `vaultId: string`
    - Uses shadcn/ui `Dialog` + `DialogContent` (same pattern as CallDetailDialog)
    - DialogContent should be wider than default: `className="max-w-2xl max-h-[90vh]"`
    - Layout sections (vertically stacked in ScrollArea):

      1. **Video Summary (above the fold):**
         - Thumbnail: Large display (full width, aspect-video, rounded-lg, object-cover)
         - Below thumbnail: Title (text-lg, font-semibold), channel name (text-sm, text-muted-foreground)
         - Stats row: `<YouTubeVideoStats>` with views/likes/comments
         - Duration badge + published date (relative like "3 months ago")
         - Category badge (if available)

      2. **Description (collapsible):**
         - Default: collapsed to 3 lines (`line-clamp-3`)
         - "Show more" / "Show less" toggle button below
         - Use `useState` for `isDescriptionExpanded`
         - When expanded, show full description with whitespace-pre-line for line breaks
         - If no description, show "No description available" in muted text

      3. **Transcript:**
         - Section heading: "Transcript" (text-sm, font-semibold, uppercase tracking)
         - Show `recording.full_transcript` in a scrollable container (max-h-[300px])
         - Use monospace or normal text at text-xs/text-sm
         - If no transcript, show "No transcript available"

      4. **Chat:**
         - `<YouTubeChatSection>` with vaultId, recording's legacy_recording_id, and title
         - Pass `onClose={() => onOpenChange(false)}` so chat navigation closes modal

    - Extract metadata via `getYouTubeMetadata(recording?.source_metadata)`
    - Use `parseYouTubeDuration` for duration display
    - Use `formatCompactNumber` for stats
    - Use `YOUTUBE_CATEGORIES` for category name

    - If `recording` is null and `open` is true, show loading skeleton
    - Use Remix icons only: RiTimeLine for duration, RiCalendarLine for published date, RiPlayLine for video icon, RiChat3Line for chat
  </action>
  <verify>
    - `npx tsc --noEmit` passes for both new components
    - `grep "Dialog" src/components/youtube/YouTubeVideoDetailModal.tsx` shows Dialog usage
    - `grep "navigate.*chat" src/components/youtube/YouTubeChatSection.tsx` shows chat navigation
    - `grep "line-clamp-3" src/components/youtube/YouTubeVideoDetailModal.tsx` shows collapsed description
  </verify>
  <done>
    YouTubeVideoDetailModal renders a full video detail overlay with video summary (thumbnail, title, channel, stats), collapsible 3-line description, scrollable transcript, and click-to-start chat section. YouTubeChatSection provides "Start Chat" button that navigates to /chat with vault context.
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire modal into VaultDetailPane + update YouTubeVideoList click handler</name>
  <files>
    src/components/panes/VaultDetailPane.tsx
    src/components/youtube/YouTubeVideoList.tsx
  </files>
  <action>
    1. In `VaultDetailPane.tsx`:
       - Import `YouTubeVideoDetailModal` from `@/components/youtube/YouTubeVideoDetailModal`
       - Import `VaultRecording` type from `@/hooks/useVaults` (if not already)
       - Add state for modal:
         ```typescript
         const [videoModalOpen, setVideoModalOpen] = useState(false)
         const [selectedVideo, setSelectedVideo] = useState<VaultRecording | null>(null)
         ```
       - Replace the temporary `onVideoClick` handler (from Plan 02 which navigated to call detail page) with:
         ```typescript
         const handleVideoClick = useCallback((recording: VaultRecording) => {
           setSelectedVideo(recording)
           setVideoModalOpen(true)
         }, [])
         ```
       - Pass `handleVideoClick` as `onVideoClick` to `<YouTubeVideoList>`
       - Render the modal after the ScrollArea (outside of it, at the end of the component before closing `</div>`):
         ```tsx
         {isYouTubeVault && (
           <YouTubeVideoDetailModal
             open={videoModalOpen}
             onOpenChange={setVideoModalOpen}
             recording={selectedVideo}
             vaultId={vaultId!}
           />
         )}
         ```

    2. In `YouTubeVideoList.tsx`:
       - Ensure `onVideoClick` prop is passed through to each `<YouTubeVideoRow>` correctly
       - No other changes needed — the row click handler is already wired from Plan 02
       - Verify that clicking thumbnail AND title both fire `onVideoClick`
  </action>
  <verify>
    - `npx tsc --noEmit` passes
    - `grep "YouTubeVideoDetailModal" src/components/panes/VaultDetailPane.tsx` shows modal import
    - `grep "setVideoModalOpen" src/components/panes/VaultDetailPane.tsx` shows state management
    - `grep "handleVideoClick" src/components/panes/VaultDetailPane.tsx` shows callback wiring
  </verify>
  <done>
    Clicking a video title or thumbnail in the YouTube list opens YouTubeVideoDetailModal with the selected video's details. Modal can be closed via Dialog close button or by starting a chat (which navigates to /chat). VaultDetailPane manages modal open/close state and selected video.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` — no new type errors
2. Clicking video thumbnail opens modal with video summary
3. Description shows 3 lines with "Show more" toggle
4. Transcript section shows full_transcript text
5. "Start Chat" navigates to /chat with vault_id context
6. Modal closes cleanly on X button and chat navigation
7. Non-YouTube vault behavior unchanged
</verification>

<success_criteria>
- Video detail modal displays above-the-fold summary (thumbnail, title, channel, stats)
- Description is collapsible at 3 lines per CONTEXT.md
- Chat is user-triggered (click-to-start) per CONTEXT.md — no auto-start
- Chat reuses existing chat-stream-v2 infrastructure via vault_id scoping
- Modal uses shadcn/ui Dialog pattern (consistent with CallDetailDialog)
</success_criteria>

<output>
After completion, create `.planning/phases/10.3-youtube-specific-vaults-video-intelligence/10.3-04-SUMMARY.md`
</output>
